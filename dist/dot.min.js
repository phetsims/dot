function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}!function(){if(window.phet=window.phet||{},!window.hasOwnProperty("_"))throw new Error("Underscore/Lodash not found: _");window.assertions=window.assertions||{},window.assertions.assertFunction=window.assertions.assertFunction||function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];if(!t){i=i.filter(t=>!!i),window.navigator&&"Microsoft Internet Explorer"===window.navigator.appName&&i.push("stack=\n"+(new Error).stack);const t=i.length>0?"Assertion failed: ":"Assertion failed";throw console&&console.log&&console.log(t,...i),window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters.debugger,new Error(t+i.join("\n "))}},window.assert=window.assert||null,window.assertSlow=window.assertSlow||null,window.assertions.enableAssert=function(){window.assert=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assert")},window.assertions.disableAssert=function(){window.assert=null,window.console&&window.console.log&&window.console.log("disabling assert")},window.assertions.enableAssertSlow=function(){window.assertSlow=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assertSlow")},window.assertions.disableAssertSlow=function(){window.assertSlow=null,window.console&&window.console.log&&window.console.log("disabling assertSlow")},function(){window.phetio=window.phetio||{};window.phetio.PhetioIDUtils={append:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return i.forEach(e=>{t+="."+e}),t},getComponentName:function(t){const e=t.lastIndexOf(".");return-1===e?t:t.substring(e+1,t.length)},getParentID:function(t){const e=t.lastIndexOf(".");return-1===e?null:t.substring(0,e)},getDOMElementID:function(t){return"phetioID:"+t},getScreenID:function(t){const e=[],i=t.split(".");for(let s=0;s<i.length;s++){const t=i[s];e.push(t);const r=t.indexOf("Screen");if(r>0&&r+"Screen".length===t.length)return e.join(".")}return null},getGroupElementIndex:function(t){return Number(t.split(window.phetio.PhetioIDUtils.GROUP_SEPARATOR)[1])},isAncestor:function(t,e){const i=t.split("."),s=e.split(".");for(let r=0;r<i.length;r++)if(i[r]!==s[r])return!1;return e!==t},SEPARATOR:".",GROUP_SEPARATOR:"_",INTER_TERM_SEPARATOR:"-",GENERAL_COMPONENT_NAME:"general",GLOBAL_COMPONENT_NAME:"global",HOME_SCREEN_COMPONENT_NAME:"homeScreen",MODEL_COMPONENT_NAME:"model",VIEW_COMPONENT_NAME:"view",CONTROLLER_COMPONENT_NAME:"controller",COLORS_COMPONENT_NAME:"colors"}}(),(()=>{"use strict";var t={897:(t,e,i)=>{let s;i.d(e,{Z:()=>r}),t=i.hmd(t);try{s=t&&t.hot}catch(n){s=!1}const r=s}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={id:s,loaded:!1,exports:{}};return t[s](n,n.exports,i),n.loaded=!0,n.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{let t;var e=i(897);const s=class{constructor(t){if(this.name=t,window.phet){if("chipper"===t)return window.phet.chipper.name="chipper",window.phet.chipper.register=this.register.bind(window.phet.chipper),window.phet.chipper;_.hasIn(window,"phet.chipper.brand");window.phet[t]=this}}register(t,i){if(t.indexOf(".")<0)e.Z,this[t]=i;else{const s=t.split(".");let r=this;for(let t=0;t<s.length-1;t++)e.Z,r=r[s[t]];const n=s[s.length-1];e.Z,r[n]=i}return i}},r=new s("axon");_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.shuffleListeners;class n{constructor(t){t&&(this.onBeforeNotify=t),this.listeners=new Set,this.emitContexts=[]}dispose(){this.removeAllListeners()}emit(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(this.onBeforeNotify&&this.onBeforeNotify.apply(null,e),this.listeners.size>0){const t={index:0};this.emitContexts.push(t);for(const i of this.listeners)if(i(...e),t.index++,t.listenerArray)break;if(t.listenerArray)for(let i=t.index;i<t.listenerArray.length;i++)t.listenerArray[i](...e);this.emitContexts.pop()}}addListener(t){this.guardListeners(),this.listeners.add(t),this.changeCount&&this.changeCount(1)}removeListener(t){this.guardListeners(),this.listeners.delete(t),this.changeCount&&this.changeCount(-1)}removeAllListeners(){const t=this.listeners.size;this.guardListeners(),this.listeners.clear(),this.changeCount&&this.changeCount(-t)}guardListeners(){for(let t=this.emitContexts.length-1;t>=0&&!this.emitContexts[t].listenerArray;t--)this.emitContexts[t].listenerArray=Array.from(this.listeners)}hasListener(t){return this.listeners.has(t)}hasListeners(){return this.listeners.size>0}getListenerCount(){return this.listeners.size}forEachListener(t){this.listeners.forEach(t)}}r.register("TinyEmitter",n);class h extends n{setTimeout(t,e){let i=0;const s=r=>{i+=r,1e3*i>=e&&this.hasListener(s)&&(t(),this.removeListener(s))};return this.addListener(s),s}clearTimeout(t){this.hasListener(t)&&this.removeListener(t)}setInterval(t,e){let i=0;const s=r=>{for(i+=r;1e3*i>=e&&this.hasListener(s);)t(),i-=e/1e3};return this.addListener(s),s}clearInterval(t){this.hasListener(t)&&this.removeListener(t)}runOnNextTick(t){this.setTimeout(t,0)}}r.register("Timer",h);const a=new h;r.register("animationFrameTimer",a);const o=new s("phetCore");o.register("Namespace",s);const m=o;function l(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return _.each(i,e=>{if(e)for(const i in e)if(e.hasOwnProperty(i)&&void 0!==e[i]){const s=e[i];_.endsWith(i,"Options")&&"Options"!==i?t[i]=l(t[i]||{},s):t[i]=s}}),t}m.register("merge",l);const u=l,d=(t,e,i,s)=>u(t,e,i,s);function c(){return d}m.register("optionize",c);const p=new s("tandem"),g={},y=t=>{window.phet&&window.phet.chipper&&window.phet.chipper.queryParameters&&phet.chipper.queryParameters.deprecationWarnings&&(g.hasOwnProperty(t)||(g[t]=!0,console.warn("Deprecation warning: "+t)))};m.register("deprecationWarning",y);const f=y;class x{constructor(t){f("EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples.");t.keys,t.map;const e=t.keys||Object.keys(t.map),i=t.map||{};t=u({phetioDocumentation:null,beforeFreeze:null},t),this.phetioDocumentation=t.phetioDocumentation,this.KEYS=e,this.VALUES=[],e.forEach(t=>{const e=i[t]||{};e.name=t,e.toString=()=>t,this[t]=e,this.VALUES.push(e)}),t.beforeFreeze&&t.beforeFreeze(this)}toString(){return this.KEYS.join(", ")}includes(t){return _.includes(this.VALUES,t)}getValue(t){return this[t]}getKey(t){return t.name}get values(){return this.VALUES}get keys(){return this.KEYS}get enumeration(){return this}static byKeys(t,e){return new x(u({keys:t},e))}static byMap(t,e){return new x(u({map:t},e))}}m.register("EnumerationDeprecated",x);const w=x,v=["string","number","boolean","function"],E=["valueType","validValues","valueComparisonStrategy","isValidValue","phetioType","validators"];class M{static getValidatorValidationError(t){if(!(t instanceof Object))return"validator must be an Object";if(!(t.hasOwnProperty("isValidValue")||t.hasOwnProperty("valueType")||t.hasOwnProperty("validValues")||t.hasOwnProperty("valueComparisonStrategy")||t.hasOwnProperty("phetioType")||t.hasOwnProperty("validators")))return this.combineErrorMessages("validator must have at least one of: "+E.join(","),t.validationMessage);if(t.hasOwnProperty("valueType")){const e=M.getValueOrElementTypeValidationError(t.valueType);if(e)return this.combineErrorMessages(`Invalid valueType: ${t.valueType}, error: ${e}`,t.validationMessage)}if(t.hasOwnProperty("isValidValue")&&"function"!=typeof t.isValidValue&&null!==t.isValidValue&&void 0!==t.isValidValue)return this.combineErrorMessages("isValidValue must be a function: "+t.isValidValue,t.validationMessage);if(t.hasOwnProperty("valueComparisonStrategy")&&"reference"!==t.valueComparisonStrategy&&"lodashDeep"!==t.valueComparisonStrategy&&"equalsFunction"!==t.valueComparisonStrategy&&"function"!=typeof t.isValidValue)return this.combineErrorMessages('valueComparisonStrategy must be "reference", "lodashDeep", \n        "equalsFunction", or a comparison function: '+t.valueComparisonStrategy,t.validationMessage);if(void 0!==t.validValues&&null!==t.validValues){if(!Array.isArray(t.validValues))return this.combineErrorMessages("validValues must be an array: "+t.validValues,t.validationMessage);const e=_.omit(t,"validValues");if(M.containsValidatorKey(e))for(let i=0;i<t.validValues.length;i++){const s=t.validValues[i],r=M.getValidationError(s,e);if(r)return this.combineErrorMessages(`Item not valid in validValues: ${s}, error: ${r}`,t.validationMessage)}}if(t.hasOwnProperty("phetioType")){if(!t.phetioType)return this.combineErrorMessages("falsey phetioType provided",t.validationMessage);if(!t.phetioType.validator)return this.combineErrorMessages("validator needed for phetioType: "+t.phetioType.typeName,t.validationMessage);const e=M.getValidatorValidationError(t.phetioType.validator);if(e)return this.combineErrorMessages(e,t.validationMessage)}if(t.hasOwnProperty("validators")){const e=t.validators;for(let i=0;i<e.length;i++){const s=e[i],r=M.getValidatorValidationError(s);if(r)return this.combineErrorMessages(`validators[${i}] invalid: ${r}`,t.validationMessage)}}return null}static getValueTypeValidatorValidationError(t){return"function"==typeof t||"string"==typeof t||t instanceof w||null==t?"string"!=typeof t||_.includes(v,t)?null:"valueType not a supported primitive types: "+t:"valueType must be {function|string|EnumerationDeprecated|null|undefined}, valueType="+t}static validateValidator(t){0}static containsValidatorKey(t){if(!(t instanceof Object))return!1;for(let e=0;e<E.length;e++)if(t.hasOwnProperty(E[e]))return!0;return!1}static combineErrorMessages(t,e){return e&&(t=`${e}: ${t}`),t}static isValueValid(t,e,i){return null===this.getValidationError(t,e,i)}static getValidationError(t,e,i){const s=c()({validateValidator:!0},i);if(s.validateValidator){const t=M.getValidatorValidationError(e);if(t)return t}if(e.hasOwnProperty("valueType")){const i=e.valueType;if(Array.isArray(i)){if(!_.some(i.map(i=>!M.getValueTypeValidationError(t,i,e.validationMessage))))return this.combineErrorMessages(`value not valid for any valueType in ${i.toString().substring(0,100)}, value: ${t}`,e.validationMessage)}else if(i){const s=M.getValueTypeValidationError(t,i,e.validationMessage);if(s)return s}}if(e.validValues){const i=e.valueComparisonStrategy||"reference";if(!e.validValues.some(e=>{if("reference"===i)return e===t;if("equalsFunction"===i){const i=e;return i.equals(t)}return"lodashDeep"===i?_.isEqual(e,t):i(e,t)}))return this.combineErrorMessages("value not in validValues: "+t,e.validationMessage)}if(e.hasOwnProperty("isValidValue")&&!e.isValidValue(t))return this.combineErrorMessages("value failed isValidValue: "+t,e.validationMessage);if(e.hasOwnProperty("phetioType")){const i=M.getValidationError(t,e.phetioType.validator,s);if(i)return this.combineErrorMessages(`value failed phetioType validator: ${t}, error: ${i}`,e.validationMessage)}if(e.hasOwnProperty("validators")){const i=e.validators;for(let r=0;r<i.length;r++){const n=i[r],h=M.getValidationError(t,n,s);if(h)return this.combineErrorMessages(`Failed validation for validators[${r}]: ${h}`,e.validationMessage)}}return null}static getValueTypeValidationError(t,e,i){return"string"==typeof e&&typeof t!==e?this.combineErrorMessages(`value should have typeof ${e}, value=${t}`,i):e!==Array||Array.isArray(t)?e instanceof w&&!e.includes(t)?this.combineErrorMessages("value is not a member of EnumerationDeprecated "+e,i):"function"!=typeof e||t instanceof e?null===e&&null!==t?this.combineErrorMessages("value should be null, value="+t,i):null:this.combineErrorMessages(`value should be instanceof ${e.name}, value=${t}`,i):this.combineErrorMessages("value should have been an array, value="+t,i)}static getValueOrElementTypeValidationError(t){if(Array.isArray(t))for(let e=0;e<t.length;e++){const i=t[e],s=M.getValueTypeValidatorValidationError(i);if(s)return"Array value invalid: "+s}else if(t){const e=M.getValueTypeValidatorValidationError(t);if(e)return"Value type invalid: "+e}return null}}_defineProperty(M,"VALIDATOR_KEYS",E),_defineProperty(M,"STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR",{valueType:"string",isValidValue:t=>!/\{\{\w*\}\}/.test(t)}),r.register("Validation",M);const T=(t,e,i)=>{0};r.register("validate",T);const b=T,I={IO_TYPE_SUFFIX:"IO"};p.register("PhetioConstants",I);const P=I,O={OBJECT_IO_TYPE_NAME:"ObjectIO",EVENT_TYPE_MODEL:"MODEL",PHET_IO_OBJECT_METADATA_DEFAULTS:{phetioTypeName:"ObjectIO",phetioDocumentation:"",phetioState:!0,phetioReadOnly:!1,phetioEventType:"MODEL",phetioHighFrequency:!1,phetioPlayback:!1,phetioDynamicElement:!1,phetioIsArchetype:!1,phetioFeatured:!1,phetioDesigned:!1,phetioArchetypePhetioID:null},METADATA_KEY_NAME:"_metadata",DATA_KEY_NAME:"_data"};p.register("TandemConstants",O);const V=O,S=function(t){};m.register("assertMutuallyExclusiveOptions",S);const A=S;class N{constructor(t){const e=c()({displayString:"",validator:null,compositeSchema:null},t);this.displayString=e.displayString,this.validator=e.validator,this.compositeSchema=e.compositeSchema}validateStateSchema(t){0}defaultApplyState(t,e){const i=(e,s)=>{for(const r in e)if(e.hasOwnProperty(r))if("_private"===r)i(e._private,s._private);else{const i=e[r];"fromStateObject"===i.defaultDeserializationMethod?t[r]=e[r].fromStateObject(s[r]):e[r].applyState(t[r],s[r])}};i(this.compositeSchema,e)}defaultToStateObject(t){const e=i=>{const s={};for(const r in i)i.hasOwnProperty(r)&&("_private"===r?s._private=e(i._private):s[r]=i[r].toStateObject(t[r]));return s};return e(this.compositeSchema)}isComposite(){return!!this.compositeSchema}checkStateObjectValid(t,e,i,s){if(this.isComposite()){const e=t,r=this.compositeSchema;let n=null;const h=(t,e,i,s)=>{e?Object.keys(t).filter(t=>t!==s).forEach(s=>{const r=e.hasOwnProperty(s);r||(n=!1),t[s].validateStateObject(e[s]),i.push(s)}):n=!1};return h(r,e,i,"_private"),r._private&&h(r._private,e._private,s,null),n}{const i=t;return e&&b(i,this.validator),M.isValueValid(i,this.validator)}}getRelatedTypes(){const t=[],e=e=>{Object.keys(e).forEach(i=>{e[i]instanceof X&&t.push(e[i])})};return this.compositeSchema&&(e(this.compositeSchema),this.compositeSchema._private&&e(this.compositeSchema._private)),t}getStateSchemaAPI(){if(this.isComposite()){const t=_.mapValues(this.compositeSchema,t=>t.typeName);return this.compositeSchema._private&&(t._private=_.mapValues(this.compositeSchema._private,t=>t.typeName)),t}return this.displayString}static asValue(t,e){return new N({validator:e,displayString:t})}}p.register("StateSchema",N);const D={validateValidator:!1},Y=t=>{const e=t.indexOf(P.IO_TYPE_SUFFIX);return t.substring(0,e)};class X{constructor(t,e){this.typeName=t;const i=e.supertype||X.ObjectIO,s=!!e.toStateObject,r=!!e.applyState,n=!!e.stateSchema,h=c()({supertype:X.ObjectIO,methods:{},events:[],metadataDefaults:{},dataDefaults:{},methodOrder:[],parameterTypes:[],documentation:"IO Type for "+Y(t),isFunctionType:!1,toStateObject:i&&i.toStateObject,fromStateObject:i&&i.fromStateObject,stateObjectToCreateElementArguments:i&&i.stateObjectToCreateElementArguments,applyState:i&&i.applyState,stateSchema:null,defaultDeserializationMethod:"fromStateObject",addChildElement:i&&i.addChildElement},e);if(this.supertype=i,this.documentation=h.documentation,this.methods=h.methods,this.events=h.events,this.metadataDefaults=h.metadataDefaults,this.dataDefaults=h.dataDefaults,this.methodOrder=h.methodOrder,this.parameterTypes=h.parameterTypes,this.validator=_.pick(h,M.VALIDATOR_KEYS),this.validator.validationMessage=this.validator.validationMessage||"Validation failed IOType Validator: "+this.typeName,this.defaultDeserializationMethod=h.defaultDeserializationMethod,null===h.stateSchema||h.stateSchema instanceof N)this.stateSchema=h.stateSchema;else{const t="function"==typeof h.stateSchema?h.stateSchema(this):h.stateSchema;this.stateSchema=new N({compositeSchema:t})}this.toStateObject=t=>{let e;return b(t,this.validator,D),e=!s&&n&&this.stateSchema&&this.stateSchema.isComposite()?this.stateSchema.defaultToStateObject(t):h.toStateObject(t),e},this.fromStateObject=h.fromStateObject,this.stateObjectToCreateElementArguments=h.stateObjectToCreateElementArguments,this.applyState=(t,e)=>{b(t,this.validator,D),!r&&n&&this.stateSchema&&this.stateSchema.isComposite()?this.stateSchema.defaultApplyState(t,e):h.applyState(t,e)},this.isFunctionType=h.isFunctionType,this.addChildElement=h.addChildElement}getTypeHierarchy(){const t=[];let e=this;for(;e;)t.push(e),e=e.supertype;return t}extends(t){return this.getTypeHierarchy().includes(t)}getAllMetadataDefaults(){return _.merge({},this.supertype?this.supertype.getAllMetadataDefaults():{},this.metadataDefaults)}getAllDataDefaults(){return _.merge({},this.supertype?this.supertype.getAllDataDefaults():{},this.dataDefaults)}isStateObjectValid(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=!0;if(this.stateSchema){const r=this.stateSchema.checkStateObjectValid(t,e,i,s);if(null!==r)return r}if(this.supertype)return r&&this.supertype.isStateObjectValid(t,e,i,s);if(!this.supertype&&t&&"string"!=typeof t&&!Array.isArray(t)){const e=(t,e)=>{const n=("public"===t?i:s).includes(e);n||(r=!1)};return Object.keys(t).filter(t=>"_private"!==t).forEach(t=>e("public",t)),t._private&&Object.keys(t._private).forEach(t=>e("private",t)),r}return!0}validateStateObject(t){this.isStateObjectValid(t,!0)}toString(){return this.typeName}}X.ObjectIO=new X(V.OBJECT_IO_TYPE_NAME,{isValidValue:()=>!0,supertype:null,documentation:"The root of the IO Type hierarchy",toStateObject:t=>(phet&&phet.tandem&&phet.tandem.Tandem.VALIDATION,null),fromStateObject:()=>{throw new Error("ObjectIO.fromStateObject should not be called")},stateObjectToCreateElementArguments:t=>[],applyState:_.noop,metadataDefaults:V.PHET_IO_OBJECT_METADATA_DEFAULTS,dataDefaults:{initialState:null},stateSchema:null}),p.register("IOType",X);const z=new X("ValueIO",{isValidValue:_.stubTrue,supertype:X.ObjectIO,toStateObject:t=>t,fromStateObject:t=>t,stateSchema:N.asValue("*",{isValidValue:_.stubTrue})});p.register("ValueIO",z);const F=z,R=new X("BooleanIO",{supertype:F,valueType:"boolean",documentation:"IO Type for Javascript's boolean primitive type",stateSchema:N.asValue("boolean",{valueType:"boolean"}),toStateObject:_.identity});p.register("BooleanIO",R);const L=R;function C(t,e){const i=_.indexOf(t,e);t.splice(i,1)}m.register("arrayRemove",C);const Z=C;class j{toString(){return this.name}isEnumerationValue(){return!0}constructor(){this.constructor;this._name=null,this._enumeration=null}set name(t){this._name=t}get name(){return this._name}set enumeration(t){this._enumeration=t}get enumeration(){return this._enumeration}}_defineProperty(j,"sealedCache",new Set),m.register("EnumerationValue",j);const q=j;function k(t){const e=[t];let i=t.prototype;for(;i&&(i=Object.getPrototypeOf(i));)i.constructor&&e.push(i.constructor);return e}m.register("inheritance",k);const B=k;class ${constructor(t,e){const i=c()({phetioDocumentation:"",instanceType:t},e);this.phetioDocumentation=i.phetioDocumentation;const s=i.instanceType,r=_.reverse(B(t));this.keys=[],this.values=[],r.forEach(e=>{Object.keys(e).forEach(i=>{const r=e[i];r instanceof s&&(this.keys.push(i),this.values.push(r),r instanceof t&&(r.name=i,r.enumeration=this))})}),this.Enumeration=t,q.sealedCache.add(t)}getKey(t){return t.name}getValue(t){return this.Enumeration[t]}includes(t){return this.values.includes(t)}}m.register("Enumeration",$);const H=$,U=new Map,G=t=>t.join("|"),W=t=>{const e=t.enumeration;if(!U.has(e)){const t=e.phetioDocumentation?" "+e.phetioDocumentation:"",i=e.keys,s=e.values,r=`EnumerationIO(${G(i)})`;U.set(e,new X(r,{validValues:s,documentation:`Possible values: ${i.join(", ")}.${t}`,toStateObject:t=>e.getKey(t),fromStateObject:t=>e.getValue(t),stateSchema:N.asValue(""+G(i),{isValidValue:t=>i.includes(t)})}))}return U.get(e)};p.register("EnumerationIO",W);const K=W;t=V.EVENT_TYPE_MODEL;class Q extends q{}_defineProperty(Q,"USER",new Q),_defineProperty(Q,t,new Q),_defineProperty(Q,"WRAPPER",new Q),_defineProperty(Q,"OPT_OUT",new Q),_defineProperty(Q,"enumeration",new H(Q)),_defineProperty(Q,"phetioType",K(Q)),p.register("EventType",Q);const J=Q,tt=_.hasIn(window,"phet.chipper.packageObject")?phet.chipper.packageObject:{name:"placeholder"},et=_.hasIn(window,"phet.preloads.phetio"),it=et&&phet.preloads.phetio.queryParameters.phetioPrintMissingTandems,st=!_.hasIn(tt,"phet.phet-io.validation")||!!tt.phet["phet-io"].validation,rt=window.QueryStringMachine&&QueryStringMachine.containsKey("phetioValidation"),nt=et&&rt?!!phet.preloads.phetio.queryParameters.phetioValidation:et&&st,ht=et&&nt&&!it,at=phetio.PhetioIDUtils.INTER_TERM_SEPARATOR,ot={required:[],optional:[]},mt=[],lt=[];class ut{constructor(t,e,i){_defineProperty(this,"children",{}),_defineProperty(this,"isDisposed",!1),this.parentTandem=t,this.name=e,this.phetioID=this.parentTandem?window.phetio.PhetioIDUtils.append(this.parentTandem.phetioID,this.name):this.name;const s=c()({required:!0,supplied:!0,isValidTandemName:t=>/^[a-zA-Z0-9[\],]+$/.test(t)},i);this.children={},this.parentTandem&&this.parentTandem.addChild(e,this),this.required=s.required,this.supplied=s.supplied}static onMissingTandem(t){if(it&&!t.supplied){const e=(new Error).stack;t.required?ot.required.push({phetioID:t.phetioID,stack:e}):e.includes("Font")||ot.optional.push({phetioID:t.phetioID,stack:e})}}addPhetioObject(t){if(et){if(!this.required&&!this.supplied)return;if(ut.launched)for(let e=0;e<mt.length;e++)mt[e].addPhetioObject(t);else ut.bufferedPhetioObjects.push(t)}}hasAncestor(t){return this.parentTandem===t||!(!this.parentTandem||!this.parentTandem.hasAncestor(t))}removePhetioObject(t){if(this.required||this.supplied){if(et)if(ut.launched)for(let e=0;e<mt.length;e++)mt[e].removePhetioObject(t);else Z(ut.bufferedPhetioObjects,t);t.tandem.dispose()}}getExtendedOptions(t){return u({supplied:this.supplied,required:this.required},t)}createTandem(t,e){if(e=this.getExtendedOptions(e),this.hasChild(t)){const e=this.children[t];return e}return new ut(this,t,e)}hasChild(t){return this.children.hasOwnProperty(t)}addChild(t,e){this.children[t]=e}iterateDescendants(t){for(const e in this.children)this.children.hasOwnProperty(e)&&(t(this.children[e]),this.children[e].iterateDescendants(t))}removeChild(t){delete this.children[t]}dispose(){this.parentTandem.removeChild(this.name),this.parentTandem=null,this.isDisposed=!0}getArchetypalPhetioID(){const t=this.parentTandem?window.phetio.PhetioIDUtils.append(this.parentTandem.getArchetypalPhetioID(),this.name):this.phetioID;if(t.includes("_")){return t.split(at).map(t=>t.includes("_")?"archetype":t).join(at)}return t}createGroupTandem(t){return this.children[t]?this.children[t]:new pt(this,t)}equals(t){return this.phetioID===t.phetioID}static addPhetioObjectListener(t){mt.push(t)}static launch(){for(ut.launched=!0;lt.length>0;)lt.shift()()}static unlaunch(){ut.launched=!1,ut.bufferedPhetioObjects.length=0,lt.length=0}static addLaunchListener(t){lt.push(t)}createTandemFromPhetioID(t){return this.createTandem(t.split(window.phetio.PhetioIDUtils.SEPARATOR).join(at),{isValidTandemName:t=>/^[a-zA-Z0-9[\],-_]+$/.test(t)})}}_defineProperty(ut,"SCREEN_TANDEM_NAME_SUFFIX","Screen"),_defineProperty(ut,"missingTandems",ot),_defineProperty(ut,"PHET_IO_ENABLED",et),_defineProperty(ut,"API_GENERATION",ut.PHET_IO_ENABLED&&(phet.preloads.phetio.queryParameters.phetioPrintAPI||phet.preloads.phetio.queryParameters.phetioCompareAPI)),_defineProperty(ut,"VALIDATION",ht),_defineProperty(ut,"METADATA_KEY","_metadata"),_defineProperty(ut,"DATA_KEY","_data"),_defineProperty(ut,"launched",!1),_defineProperty(ut,"bufferedPhetioObjects",[]),ut.addLaunchListener(()=>{for(;ut.bufferedPhetioObjects.length>0;){const t=ut.bufferedPhetioObjects.shift();t.tandem.addPhetioObject(t)}});ut.ROOT=new class extends ut{createTandem(t,e){if(ut.VALIDATION){t===window.phetio.PhetioIDUtils.GLOBAL_COMPONENT_NAME||"requiredTandem"===t||"optionalTandem"===t||"test"===t||t===window.phetio.PhetioIDUtils.GENERAL_COMPONENT_NAME||_.endsWith(t,ut.SCREEN_TANDEM_NAME_SUFFIX)}return super.createTandem(t,e)}}(null,_.camelCase(tt.name));const dt=ut.ROOT.createTandem(window.phetio.PhetioIDUtils.GENERAL_COMPONENT_NAME);ut.ROOT_TEST=ut.ROOT.createTandem("test"),ut.GENERAL_MODEL=dt.createTandem(window.phetio.PhetioIDUtils.MODEL_COMPONENT_NAME),ut.GENERAL_VIEW=dt.createTandem(window.phetio.PhetioIDUtils.VIEW_COMPONENT_NAME),ut.GENERAL_CONTROLLER=dt.createTandem(window.phetio.PhetioIDUtils.CONTROLLER_COMPONENT_NAME);const ct=ut.ROOT.createTandem(window.phetio.PhetioIDUtils.GLOBAL_COMPONENT_NAME);ut.GLOBAL_MODEL=ct.createTandem(window.phetio.PhetioIDUtils.MODEL_COMPONENT_NAME),ut.GLOBAL_VIEW=ct.createTandem(window.phetio.PhetioIDUtils.VIEW_COMPONENT_NAME),ut.COLORS=ut.GLOBAL_VIEW.createTandem(window.phetio.PhetioIDUtils.COLORS_COMPONENT_NAME),ut.OPTIONAL=ut.ROOT.createTandem("optionalTandem",{required:!1,supplied:!1}),ut.OPT_OUT=ut.OPTIONAL,ut.REQUIRED=ut.ROOT.createTandem("requiredTandem",{required:ht||it,supplied:!1}),ut.PREFERENCES=ut.GLOBAL_MODEL.createTandem("preferences");class pt extends ut{constructor(t,e){super(t,e),this.groupName=e,this.groupMemberIndex=0}createNextTandem(){const t=this.parentTandem.createTandem(`${this.groupName}${this.groupMemberIndex}`);return this.groupMemberIndex++,t}}p.register("Tandem",ut);const gt=ut,yt=new X("StringIO",{supertype:F,valueType:"string",documentation:"IO Type for Javascript's string primitive type",stateSchema:N.asValue("string",{valueType:"string"}),toStateObject:_.identity});p.register("StringIO",yt);const ft=yt,xt=new X("LinkedElementIO",{isValidValue:()=>!0,documentation:"A LinkedElement",toStateObject:t=>({elementID:t.element.tandem.phetioID}),applyState:_.noop,stateSchema:{elementID:ft}});p.register("LinkedElementIO",xt);const wt=xt,vt=["phetioDynamicElement","phetioEventType","phetioIsArchetype","phetioPlayback","phetioReadOnly","phetioState","phetioTypeName"];const Et=new class{constructor(){_defineProperty(this,"apiMismatches",[]),_defineProperty(this,"simHasStarted",!1),_defineProperty(this,"enabled",!1),_defineProperty(this,"everyPhetioType",{})}onSimStarted(){this.enabled&&phet.joist.sim.allScreensCreated&&(this.validateOverridesFile(),this.validatePreferencesModel()),phet.preloads.phetio.queryParameters.phetioPrintAPIProblems&&this.apiMismatches&&console.log("PhET-iO api problems detected: ",this.apiMismatches),this.simHasStarted=!0}validatePreferencesModel(){Object.keys(phet.phetio.phetioEngine.phetioObjectMap).filter(t=>t.includes(".preferencesModel.")).forEach(t=>{let e=phet.phetio.phetioEngine.phetioObjectMap[t];for(;e instanceof St;)e=e.element})}onPhetioObjectRemoved(t){if(!this.enabled)return;const e=t.tandem.phetioID;t.phetioDynamicElement||this.assertAPIError({phetioID:e,ruleInViolation:"2. Any static, registered PhetioObject can never be deregistered."})}onPhetioObjectAdded(t){if(!this.enabled)return;const e=t.phetioType;this.everyPhetioType[e.typeName]||(this.everyPhetioType[e.typeName]=e),this.simHasStarted&&phet.axon.animationFrameTimer.runOnNextTick(()=>{if(t.phetioDynamicElement){if(phet.preloads.phetio.createArchetypes&&!t.isDisposed){const e=t.tandem.getArchetypalPhetioID(),i=phet.phetio.phetioEngine.getPhetioObject(e).getMetadata();this.checkDynamicInstanceAgainstArchetype(t,i,"simulation archetype")}}else this.assertAPIError({phetioID:t.tandem.phetioID,ruleInViolation:"1. After startup, only dynamic instances prescribed by the baseline file can be registered."})})}validateOverridesFile(){const t=phet.phetio.phetioEngine.getPhetioElementsBaseline();for(const e in window.phet.preloads.phetio.phetioElementsOverrides){e.includes("archetype");if(phet.preloads.phetio.createArchetypes||t.hasOwnProperty(e))if(t.hasOwnProperty(e)){const i=window.phet.preloads.phetio.phetioElementsOverrides[e],s=t[e];0===Object.keys(i).length&&this.assertAPIError({phetioID:e,ruleInViolation:"4. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"no metadata keys found for this override."});for(const t in i)s.hasOwnProperty(t)||this.assertAPIError({phetioID:e,ruleInViolation:"8. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"phetioID metadata key not found in the baseline: "+t}),i[t]===s[t]&&this.assertAPIError({phetioID:e,ruleInViolation:"8. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"phetioID metadata override value is the same as the corresponding metadata value in the baseline."})}else this.assertAPIError({phetioID:e,ruleInViolation:"3. Any schema entries in the overrides file must exist in the baseline file.",message:"phetioID expected in the baseline file but does not exist"});else;}}assertAPIError(t){t.phetioID?(t.phetioID,t.ruleInViolation):t.ruleInViolation;this.apiMismatches.push(t),this.simHasStarted||phet.preloads.phetio.queryParameters.phetioPrintAPIProblems}checkDynamicInstanceAgainstArchetype(t,e,i){const s=t.getMetadata();vt.forEach(r=>{"phetioDynamicElement"!==r&&"phetioArchetypePhetioID"!==r&&"phetioIsArchetype"!==r&&e[r]!==s[r]&&t.tandem&&this.assertAPIError({phetioID:t.tandem.phetioID,ruleInViolation:"5. Dynamic element metadata should match the archetype in the API.",source:i,message:"mismatched metadata: "+r})})}};p.register("phetioAPIValidation",Et);const Mt=Et;class Tt{constructor(t){_defineProperty(this,"_disposeEmitter",new n),_defineProperty(this,"isDisposed",!1),_defineProperty(this,"_disposer",null),_defineProperty(this,"boundOnDisposer",null),t&&t.disposer&&(this.disposer=t.disposer),t&&t.disposeEmitter&&(this.disposeEmitter=t.disposeEmitter)}onDisposer(){!this.isDisposed&&this.dispose(),this.clearDisposer()}getDisposer(){return this._disposer}get disposer(){return this.getDisposer()}set disposer(t){this.setDisposer(t)}setDisposer(t){t!==this._disposer&&(this.ensureBoundOnDisposer(),this.clearDisposer(),this._disposer=t,this._disposer&&this.getDisposerEmitter().addListener(this.boundOnDisposer))}getDisposeEmitter(){return this._disposeEmitter}get disposeEmitter(){return this.getDisposeEmitter()}set disposeEmitter(t){this.setDisposeEmitter(t)}setDisposeEmitter(t){this._disposeEmitter.addListener(t.emit.bind(t))}ensureBoundOnDisposer(){this.boundOnDisposer=this.boundOnDisposer||this.onDisposer.bind(this)}getDisposerEmitter(){return this._disposer instanceof Tt?this._disposer._disposeEmitter:this._disposer}clearDisposer(){this._disposer&&(this.ensureBoundOnDisposer(),this.getDisposerEmitter().removeListener(this.boundOnDisposer),this._disposer=null)}dispose(){this._disposeEmitter.emit(),this.isDisposed=!0}}r.register("Disposable",Tt);const bt=Tt,It=gt.PHET_IO_ENABLED,Pt=t=>t.tandem.phetioID,Ot={tandem:gt.OPTIONAL,phetioType:X.ObjectIO,phetioDocumentation:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDocumentation,phetioState:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioState,phetioReadOnly:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioReadOnly,phetioEventType:J.MODEL,phetioHighFrequency:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioHighFrequency,phetioPlayback:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioPlayback,phetioFeatured:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioFeatured,phetioDynamicElement:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDynamicElement,phetioDesigned:V.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDesigned,phetioEventMetadata:null,tandemNameSuffix:null};class Vt extends bt{constructor(t){super(t),this.tandem=Ot.tandem,this.phetioID=this.tandem.phetioID,this.phetioObjectInitialized=!1,t&&this.initializePhetioObject({},t)}initializePhetioObject(t,e){if(e.tandem&&gt.onMissingTandem(e.tandem),gt.VALIDATION&&e.tandem&&e.tandem.required,!(It&&e.tandem&&e.tandem.supplied))return void(e.tandem&&(this.tandem=e.tandem,this.phetioID=this.tandem.phetioID));const i=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return d(t,...i)}({},Ot,t);let s=c()(i,e);this.phetioIsArchetype=!1,this.phetioBaselineMetadata=Mt.enabled||phet.preloads.phetio.queryParameters.phetioEmitAPIBaseline?this.getMetadata(u({phetioIsArchetype:this.phetioIsArchetype,phetioArchetypePhetioID:this.phetioArchetypePhetioID},s)):null;const r=s.tandem.getArchetypalPhetioID();if(window.phet.preloads.phetio.phetioElementsOverrides){const t=window.phet.preloads.phetio.phetioElementsOverrides[r];t&&(s=c()(s,t))}this.tandem=s.tandem,this.phetioID=this.tandem.phetioID,this._phetioType=s.phetioType,this._phetioState=s.phetioState,this._phetioReadOnly=s.phetioReadOnly,this._phetioDocumentation=s.phetioDocumentation,this._phetioEventType=s.phetioEventType,this._phetioHighFrequency=s.phetioHighFrequency,this._phetioPlayback=s.phetioPlayback,this._phetioDynamicElement=s.phetioDynamicElement,this._phetioFeatured=s.phetioFeatured,this._phetioEventMetadata=s.phetioEventMetadata,this._phetioDesigned=s.phetioDesigned,this.phetioArchetypePhetioID=null,this.linkedElements=[],this.phetioNotifiedObjectCreated=!1,this.phetioMessageStack=[],this._phetioPlayback&&(this._phetioEventMetadata=this._phetioEventMetadata||{},this._phetioEventMetadata.playback=!0),this.tandem.addPhetioObject(this),this.phetioObjectInitialized=!0}static swapCaseOfFirstCharacter(t){const e=t[0];return(e===e.toLowerCase()?e.toUpperCase():e.toLowerCase())+t.substring(1)}get phetioType(){return this._phetioType}get phetioState(){return this._phetioState}get phetioReadOnly(){return this._phetioReadOnly}get phetioDocumentation(){return this._phetioDocumentation}get phetioEventType(){return this._phetioEventType}get phetioHighFrequency(){return this._phetioHighFrequency}get phetioPlayback(){return this._phetioPlayback}get phetioDynamicElement(){return this._phetioDynamicElement}get phetioFeatured(){return this._phetioFeatured}get phetioEventMetadata(){return this._phetioEventMetadata}get phetioDesigned(){return this._phetioDesigned}phetioStartEvent(t,e){if(It&&this.isPhetioInstrumented()){const i=c()({data:null,getData:null},e);if(!_.hasIn(window,"phet.phetio.dataStream"))return void this.phetioMessageStack.push(-1);const s=this.phetioHighFrequency&&_.hasIn(window,"phet.preloads.phetio.queryParameters")&&!window.phet.preloads.phetio.queryParameters.phetioEmitHighFrequencyEvents&&!phet.phetio.dataStream.isEmittingLowFrequencyEvent(),r=!_.hasIn(window,"phet.phetio.dataStream");if(s||this.phetioEventType===J.OPT_OUT||r)return void this.phetioMessageStack.push(-1);const n=i.getData?i.getData():i.data;this.phetioMessageStack.push(phet.phetio.dataStream.start(this.phetioEventType,this.tandem.phetioID,this.phetioType,t,n,this.phetioEventMetadata,this.phetioHighFrequency)),this.phetioPlayback&&phet.phetio.dataStream.pushNonPlaybackable()}}phetioEndEvent(){if(It&&this.isPhetioInstrumented()){const t=this.phetioMessageStack.pop();if(-1===t)return;this.phetioPlayback&&phet.phetio.dataStream.popNonPlaybackable(),phet.phetio.dataStream.end(t)}}propagateDynamicFlagsToDescendants(){const t=phet.phetio.phetioEngine,e=gt.launched?[]:gt.bufferedPhetioObjects.map(Pt);this.tandem.iterateDescendants(i=>{const s=i.phetioID;if(t.hasPhetioObject(s)||!gt.launched&&e.includes(s)){const i=t.hasPhetioObject(s)?t.getPhetioObject(s):gt.bufferedPhetioObjects[e.indexOf(s)];i.phetioIsArchetype=this.phetioIsArchetype,i.setPhetioDynamicElement(this.phetioDynamicElement),i.phetioBaselineMetadata&&(i.phetioBaselineMetadata.phetioIsArchetype=this.phetioIsArchetype)}})}setPhetioDynamicElement(t){this._phetioDynamicElement=!this.phetioIsArchetype&&t,this.phetioArchetypePhetioID=t?this.tandem.getArchetypalPhetioID():null,this.phetioBaselineMetadata&&(this.phetioBaselineMetadata.phetioDynamicElement=this.phetioDynamicElement)}markDynamicElementArchetype(){this.phetioIsArchetype=!0,this.setPhetioDynamicElement(!1),this.phetioBaselineMetadata&&(this.phetioBaselineMetadata.phetioIsArchetype=this.phetioIsArchetype),gt.PHET_IO_ENABLED&&this.propagateDynamicFlagsToDescendants()}isPhetioInstrumented(){return this.tandem&&this.tandem.supplied}addLinkedElement(t,e){this.isPhetioInstrumented()?It&&t.isPhetioInstrumented()&&this.linkedElements.push(new St(t,e)):this.linkedElements=null}removeLinkedElements(t){if(this.isPhetioInstrumented()&&this.linkedElements){this.linkedElements.filter(e=>e.element===t).forEach(t=>{t.dispose(),Z(this.linkedElements,t)})}}onSimulationConstructionCompleted(){this.phetioBaselineMetadata=null}dispose(){const t=[];if(gt.PHET_IO_ENABLED&&this.tandem.supplied){const e=phet.phetio.phetioEngine;this.tandem.iterateDescendants(i=>{e.hasPhetioObject(i.phetioID)&&t.push(e.getPhetioObject(i.phetioID))})}this.tandem.removePhetioObject(this),this.linkedElements&&(this.linkedElements.forEach(t=>t.dispose()),this.linkedElements.length=0),super.dispose()}getMetadata(t){const e={phetioTypeName:(t=t||this).phetioType.typeName,phetioDocumentation:t.phetioDocumentation,phetioState:t.phetioState,phetioReadOnly:t.phetioReadOnly,phetioEventType:J.phetioType.toStateObject(t.phetioEventType),phetioHighFrequency:t.phetioHighFrequency,phetioPlayback:t.phetioPlayback,phetioDynamicElement:t.phetioDynamicElement,phetioIsArchetype:t.phetioIsArchetype,phetioFeatured:t.phetioFeatured,phetioDesigned:t.phetioDesigned};return t.phetioArchetypePhetioID&&(e.phetioArchetypePhetioID=t.phetioArchetypePhetioID),e}static create(t){return new Vt(t)}}_defineProperty(Vt,"DEFAULT_OPTIONS",Ot);class St extends Vt{constructor(t,e){const i=c()({phetioType:wt,phetioState:!0},e);i.phetioReadOnly=!0,i.phetioFeatured=t.phetioFeatured,super(i),this.element=t}getMetadata(t){const e=super.getMetadata(t);return delete e.phetioFeatured,e}}p.register("PhetioObject",Vt);const At=new Map,Nt=t=>(At.has(t)||At.set(t,new X(`ArrayIO<${t.typeName}>`,{valueType:Array,isValidValue:e=>_.every(e,e=>M.isValueValid(e,t.validator)),parameterTypes:[t],toStateObject:e=>e.map(t.toStateObject),fromStateObject:e=>e.map(t.fromStateObject),documentation:"IO Type for the built-in JS array type, with the element type specified.",stateSchema:N.asValue(`Array<${t.typeName}>`,{isValidValue:e=>_.every(e,e=>t.isStateObjectValid(e))})})),At.get(t));p.register("ArrayIO",Nt);const Dt=Nt,Yt=new Map,_t=(t,e)=>{for(let s=0;s<e.length;s++);const i=`${t.typeName}.${e.map(t=>t.typeName).join(",")}`;if(!Yt.has(i)){let s=e.map(t=>t.typeName).join(", ");""===s&&(s="none");const r=e.map(t=>t.typeName).join(",");Yt.set(i,new X(`FunctionIO(${r})=>${t.typeName}`,{valueType:"function",isFunctionType:!0,parameterTypes:e.concat([t]),documentation:`Wrapper for the built-in JS function type.<br><strong>Arguments:</strong> ${s}<br><strong>Return Type:</strong> `+t.typeName}))}return Yt.get(i)};p.register("FunctionIO",_t);const Xt=_t,zt=new Map,Ft=t=>(zt.has(t)||zt.set(t,new X(`NullableIO<${t.typeName}>`,{documentation:"An IOType adding support for null in addition to the behavior of its parameter.",isValidValue:e=>null===e||M.isValueValid(e,t.validator),parameterTypes:[t],toStateObject:e=>null===e?null:t.toStateObject(e),fromStateObject:e=>null===e?null:t.fromStateObject(e),stateSchema:N.asValue(`null|<${t.typeName}>`,{isValidValue:e=>null===e||t.isStateObjectValid(e)})})),zt.get(t));p.register("NullableIO",Ft);const Rt=Ft,Lt=new X("VoidIO",{isValidValue:()=>!0,documentation:"Type for which there is no instance, usually to mark functions without a return value",toStateObject:()=>{}});p.register("VoidIO",Lt);const Ct=Lt;class Zt extends q{}_defineProperty(Zt,"UNDEFER",new Zt),_defineProperty(Zt,"NOTIFY",new Zt),_defineProperty(Zt,"enumeration",new H(Zt)),r.register("PropertyStatePhase",Zt);const jt=Zt;class qt{constructor(){_defineProperty(this,"initialized",!1),this.phaseCallbackSets=new $t,this.undeferBeforeUndeferMapPair=new Bt(jt.UNDEFER,jt.UNDEFER),this.undeferBeforeNotifyMapPair=new Bt(jt.UNDEFER,jt.NOTIFY),this.notifyBeforeUndeferMapPair=new Bt(jt.NOTIFY,jt.UNDEFER),this.notifyBeforeNotifyMapPair=new Bt(jt.NOTIFY,jt.NOTIFY),this.mapPairs=[this.undeferBeforeUndeferMapPair,this.undeferBeforeNotifyMapPair,this.notifyBeforeUndeferMapPair,this.notifyBeforeNotifyMapPair]}initialize(t){t.onBeforeApplyStateEmitter.addListener(t=>{if(t instanceof te&&!t.isDeferred){t.setDeferred(!0);const e=t.tandem.phetioID,i=()=>{const i=t.setDeferred(!1);this.phaseCallbackSets.addNotifyPhaseCallback(new kt(e,jt.NOTIFY,i||_.noop))};this.phaseCallbackSets.addUndeferPhaseCallback(new kt(e,jt.UNDEFER,i))}}),t.stateSetEmitter.addListener(t=>{this.undeferAndNotifyProperties(new Set(Object.keys(t)))}),t.isSettingStateProperty.lazyLink(t=>{}),this.initialized=!0}static validateInstrumentedProperty(t){}validatePropertyPhasePair(t,e){qt.validateInstrumentedProperty(t)}getMapPairFromPhases(t,e){const i=this.mapPairs.filter(i=>t===i.beforePhase&&e===i.afterPhase);return i[0]}registerPhetioOrderDependency(t,e,i,s){if(gt.PHET_IO_ENABLED){this.validatePropertyPhasePair(t,e),this.validatePropertyPhasePair(i,s),this.getMapPairFromPhases(e,s).addOrderDependency(t.tandem.phetioID,i.tandem.phetioID)}}propertyInAnOrderDependency(t){return qt.validateInstrumentedProperty(t),_.some(this.mapPairs,e=>e.usesPhetioID(t.tandem.phetioID))}unregisterOrderDependenciesForProperty(t){gt.PHET_IO_ENABLED&&(qt.validateInstrumentedProperty(t),this.propertyInAnOrderDependency(t)&&this.mapPairs.forEach(e=>e.unregisterOrderDependenciesForProperty(t)))}undeferAndNotifyProperties(t){const e={};let i=0;for(;this.phaseCallbackSets.size>0;)i++,i>5e3&&this.errorInUndeferAndNotifyStep(e),this.attemptToApplyPhases(jt.UNDEFER,e,t),this.attemptToApplyPhases(jt.NOTIFY,e,t)}errorInUndeferAndNotifyStep(t){const e=[];this.phaseCallbackSets.forEach(t=>e.push(t.getTerm()));const i=[];this.mapPairs.forEach(t=>{const s=t.beforeMap;for(const[r,n]of s)n.forEach(t=>{const n=r+s.beforePhase,h=t+s.afterPhase;(e.includes(n)||e.includes(h))&&i.push({beforeTerm:n,afterTerm:h})})});let s="";console.log("still to be undeferred",this.phaseCallbackSets.undeferSet),console.log("still to be notified",this.phaseCallbackSets.notifySet),console.log("order dependencies that apply to the still todos",i),i.forEach(t=>{s+=`${t.beforeTerm}\t${t.afterTerm}\n`}),console.log("\n\nin graphable form:\n\n",s);const r="Impossible set state: from undeferAndNotifyProperties; ordering constraints cannot be satisfied";throw new Error(r)}getNumberOfOrderDependencies(){let t=0;return this.mapPairs.forEach(e=>{e.afterMap.forEach(e=>{t+=e.size})}),t}attemptToApplyPhases(t,e,i){const s=this.phaseCallbackSets.getSetFromPhase(t);for(const r of s)this.phetioIDCanApplyPhase(r.phetioID,t,e,i)&&(r.listener(),s.delete(r),e[r.getTerm()]=!0)}phetioIDCanApplyPhase(t,e,i,s){if(e===jt.NOTIFY&&!i[t+jt.UNDEFER])return!1;const r=[];this.mapPairs.forEach(t=>{t.afterPhase===e&&r.push(t.afterMap)});for(let n=0;n<r.length;n++){const e=r[n];if(!e.has(t))return!0;const h=e.get(t);for(const r of h)if(!i[r+e.beforePhase]&&s.has(r)&&s.has(t))return!1}return!0}}class kt{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.noop;this.phetioID=t,this.phase=e,this.listener=i}getTerm(){return this.phetioID+this.phase}}class Bt{constructor(t,e){this.beforeMap=new Map,this.beforeMap.beforePhase=t,this.beforeMap.afterPhase=e,this.afterMap=new Map,this.afterMap.beforePhase=t,this.afterMap.afterPhase=e,this.beforeMap.otherMap=this.afterMap,this.afterMap.otherMap=this.beforeMap,this.beforePhase=t,this.afterPhase=e}addOrderDependency(t,e){this.beforeMap.has(t)||this.beforeMap.set(t,new Set),this.beforeMap.get(t).add(e),this.afterMap.has(e)||this.afterMap.set(e,new Set),this.afterMap.get(e).add(t)}unregisterOrderDependenciesForProperty(t){const e=t.tandem.phetioID;[this.beforeMap,this.afterMap].forEach(t=>{t.has(e)&&t.get(e).forEach(i=>{const s=t.otherMap.get(i);s&&s.delete(e),0===s.size&&t.otherMap.delete(i)}),t.delete(e)})}usesPhetioID(t){return this.beforeMap.has(t)||this.afterMap.has(t)}}class $t{constructor(){_defineProperty(this,"undeferSet",new Set),_defineProperty(this,"notifySet",new Set)}get size(){return this.undeferSet.size+this.notifySet.size}forEach(t){this.undeferSet.forEach(t),this.notifySet.forEach(t)}addUndeferPhaseCallback(t){this.undeferSet.add(t)}addNotifyPhaseCallback(t){this.notifySet.add(t)}getSetFromPhase(t){return t===jt.NOTIFY?this.notifySet:this.undeferSet}}r.register("PropertyStateHandler",qt);const Ht=new qt;r.register("propertyStateHandlerSingleton",Ht);const Ut=Ht;class Gt extends n{constructor(t,e){super(e),this._value=t}get(){return this._value}get value(){return this.get()}set value(t){this.set(t)}set(t){if(!this.equalsValue(t)){const e=this._value;this.setPropertyValue(t),this.notifyListeners(e)}}setPropertyValue(t){this._value=t}equalsValue(t){return this.areValuesEqual(t,this._value)}areValuesEqual(t,e){if(this.useDeepEquality){const i=t,s=e;if(i&&s&&i.constructor===s.constructor)return i.equals(s)}return t===e}notifyListeners(t){this.emit(this._value,t,this)}link(t){this.addListener(t),t(this._value,null,this)}lazyLink(t){this.addListener(t)}unlink(t){this.removeListener(t)}unlinkAll(){this.removeAllListeners()}linkAttribute(t,e){const i=i=>{t[e]=i};return this.link(i),i}isSettable(){return!0}dispose(){this.unlinkAll(),super.dispose()}}r.register("TinyProperty",Gt);const Wt={values:["1/(cm*M)","%","A","AMU","atm","cm","cm^2","C","°","°C","F","g","Hz","J","K","kg","kg/m^3","kg·m/s","kPa","L","L/s","m","m^3","m/s","m/s/s","m/s^2","mA","mm","mol","mol/L","mol/s","M","N","N/m","nm","nm/ps","N·s/m","Ω","Ω·cm","Pa·s","particles/ps","pm","pm/ps","pm/s","pm/s^2","pm^3","ps","radians","radians/s","s","V","view-coordinates/s","W"],isValidUnits:function(t){return _.includes(Wt.values,t)}};r.register("units",Wt);const Kt={validateValidator:!1};let Qt=0;const Jt=new Map;class te extends Vt{constructor(t,e){const i=c()({units:null,reentrant:!1,tandem:gt.OPTIONAL,phetioOuterType:te.PropertyIO,phetioValueType:X.ObjectIO},e);M.containsValidatorKey(i)||(i.isValidValue=()=>!0),i.units&&(i.phetioEventMetadata=i.phetioEventMetadata||{},i.phetioEventMetadata.units=i.units),i.phetioOuterType&&i.phetioValueType&&(i.phetioType=i.phetioOuterType(i.phetioValueType)),super(i),this.id=Qt++,this.units=i.units,gt.VALIDATION&&this.isPhetioInstrumented(),this.validValues=i.validValues,this.tinyProperty=new Gt(t),this.tinyProperty.useDeepEquality=i.valueComparisonStrategy&&"equalsFunction"===i.valueComparisonStrategy,this.notifying=!1,this.reentrant=i.reentrant,this.isDeferred=!1,this.deferredValue=null,this.hasDeferredValue=!1,this.valueValidator=_.pick(i,M.VALIDATOR_KEYS),this.valueValidator.validationMessage=this.valueValidator.validationMessage||"Property value not valid",this.valueValidator.phetioType&&(this.valueValidator.phetioType=this.valueValidator.phetioType.parameterTypes[0])}isSettable(){return!1}get(){return this.tinyProperty.get()}set(t){_.hasIn(window,"phet.joist.sim.isSettingPhetioStateProperty")&&phet.joist.sim.isSettingPhetioStateProperty.value&&_.hasIn(window,"phet.joist.sim.isClearingPhetioDynamicElementsProperty")&&!phet.joist.sim.isClearingPhetioDynamicElementsProperty.value&&this.isPhetioInstrumented()&&this.phetioState&&this.isSettable()||this.unguardedSet(t)}unguardedSet(t){if(!this.isDisposed)if(this.isDeferred)this.deferredValue=t,this.hasDeferredValue=!0;else if(!this.equalsValue(t)){const e=this.get();this.setPropertyValue(t),this._notifyListeners(e)}}setPropertyValue(t){this.tinyProperty.setPropertyValue(t)}equalsValue(t){return this.areValuesEqual(t,this.get())}areValuesEqual(t,e){return this.tinyProperty.areValuesEqual(t,e)}_notifyListeners(t){const e=this.get();gt.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent(te.CHANGED_EVENT_NAME,{getData:()=>{const i=this.phetioType.parameterTypes[0];return{oldValue:Rt(i).toStateObject(t),newValue:i.toStateObject(e)}}}),this.notifying=!0,this.tinyProperty.emit(e,t,this),this.notifying=!1,gt.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}notifyListenersStatic(){this._notifyListeners(null)}setDeferred(t){if(t)this.isDeferred=!0;else{this.isDeferred=!1;const t=this.get();if(this.hasDeferredValue&&(this.setPropertyValue(this.deferredValue),this.hasDeferredValue=!1,this.deferredValue=null),!this.equalsValue(t))return()=>!this.isDisposed&&this._notifyListeners(t)}return null}get value(){return this.get()}set value(t){this.set(t)}addPhetioStateDependencies(t){for(let e=0;e<t.length;e++){const i=t[e];i instanceof te&&i.isPhetioInstrumented()&&this.isPhetioInstrumented()&&Ut.registerPhetioOrderDependency(i,jt.UNDEFER,this,jt.NOTIFY)}}link(t,e){e&&e.phetioDependencies&&this.addPhetioStateDependencies(e.phetioDependencies),this.tinyProperty.addListener(t),t(this.get(),null,this)}lazyLink(t,e){e&&e.phetioDependencies&&this.addPhetioStateDependencies(e.phetioDependencies),this.tinyProperty.lazyLink(t)}unlink(t){this.tinyProperty.unlink(t)}unlinkAll(){this.tinyProperty.unlinkAll()}linkAttribute(t,e){const i=i=>{t[e]=i};return this.link(i),i}toString(){return`Property#${this.id}{${this.get()}}`}debug(t){const e=e=>console.log(t,e);return this.link(e),e}isValueValid(t){return null===this.getValidationError(t)}getValidationError(t){return M.getValidationError(t,this.valueValidator,Kt)}dispose(){this.isPhetioInstrumented()&&Ut.unregisterOrderDependenciesForProperty(this),super.dispose(),this.tinyProperty.dispose()}hasListener(t){return this.tinyProperty.hasListener(t)}getListenerCount(){return this.tinyProperty.getListenerCount()}forEachListener(t){this.tinyProperty.forEachListener(t)}hasListeners(){return this.tinyProperty.hasListeners()}static PropertyIO(t){return Jt.has(t)||Jt.set(t,new X(`PropertyIO<${t.typeName}>`,{valueType:te,documentation:"Observable values that send out notifications when the value changes. This differs from the traditional listener pattern in that added listeners also receive a callback with the current value when the listeners are registered. This is a widely-used pattern in PhET-iO simulations.",methodOrder:["link","lazyLink"],events:[te.CHANGED_EVENT_NAME],parameterTypes:[t],toStateObject:e=>({value:t.toStateObject(e.value),validValues:e.validValues?e.validValues.map(e=>t.toStateObject(e)):null,units:Rt(ft).toStateObject(e.units)}),applyState:(e,i)=>{Rt(ft).fromStateObject(i.units);e.unguardedSet(t.fromStateObject(i.value)),i.validValues&&(e.validValues=i.validValues.map(e=>t.fromStateObject(e)))},stateSchema:{value:t,validValues:Rt(Dt(t)),units:Rt(ft)},methods:{getValue:{returnType:t,parameterTypes:[],implementation:te.prototype.get,documentation:"Gets the current value."},getValidationError:{returnType:Rt(ft),parameterTypes:[t],implementation:te.prototype.getValidationError,documentation:"Checks to see if a proposed value is valid. Returns the first validation error, or null if the value is valid."},setValue:{returnType:Ct,parameterTypes:[t],implementation:function(t){const e=M.getValidationError(t,this.valueValidator,Kt);if(e)throw new Error("Validation error: "+e);this.set(t)},documentation:"Sets the value of the Property. If the value differs from the previous value, listeners are notified with the new value.",invocableForReadOnlyElements:!1},link:{returnType:Ct,parameterTypes:[Xt(Ct,[t,Rt(t)])],implementation:te.prototype.link,documentation:"Adds a listener which will be called when the value changes. On registration, the listener is also called with the current value. The listener takes two arguments, the new value and the previous value."},lazyLink:{returnType:Ct,parameterTypes:[Xt(Ct,[t,Rt(t)])],implementation:te.prototype.lazyLink,documentation:'Adds a listener which will be called when the value changes. This method is like "link", but without the current-value callback on registration. The listener takes two arguments, the new value and the previous value.'},unlink:{returnType:Ct,parameterTypes:[Xt(Ct,[t])],implementation:te.prototype.unlink,documentation:"Removes a listener."}}})),Jt.get(t)}}_defineProperty(te,"TANDEM_NAME_SUFFIX","Property"),_defineProperty(te,"CHANGED_EVENT_NAME","changed"),r.register("ReadOnlyProperty",te);class ee extends te{constructor(t,e){super(t,e),this._initialValue=t}getInitialValue(){return this._initialValue}get initialValue(){return this.getInitialValue()}setInitialValue(t){this._initialValue=t}get value(){return super.value}set value(t){super.set(t)}reset(){this.set(this._initialValue)}set(t){super.set(t)}isSettable(){return!0}}r.register("Property",ee);r.register("BooleanProperty",class extends ee{constructor(t,e){super(t,c()({valueType:"boolean",phetioValueType:L},e))}toggle(){this.value=!this.value}});const ie=new h;r.register("stepTimer",ie);const se=ie;r.register("CallbackTimer",class{constructor(t){const e=c()({delay:400,interval:100},t);this.delay=e.delay,this.interval=e.interval,this.callbacks=[],e.callback&&this.callbacks.push(e.callback),this.delayID=null,this.intervalID=null,this.fired=!1}isRunning(){return null!==this.delayID||null!==this.intervalID}start(){this.isRunning()||(this.fired=!1,this.delayID=se.setTimeout(()=>{this.delayID=null,this.intervalID=se.setInterval(()=>this.fire(),this.interval),this.fire()},this.delay))}stop(t){this.isRunning()&&(this.delayID&&(se.clearTimeout(this.delayID),this.delayID=null),this.intervalID&&(se.clearInterval(this.intervalID),this.intervalID=null),t&&!this.fired&&this.fire())}addCallback(t){this.callbacks.includes(t)||this.callbacks.push(t)}removeCallback(t){const e=this.callbacks.indexOf(t);-1!==e&&this.callbacks.splice(e,1)}fire(){const t=this.callbacks.slice(0);for(let e=0;e<t.length;e++)t[e]();this.fired=!0}dispose(){this.stop(!1),this.callbacks.length=0}});const re={validateValidator:!1},ne=[],he=(["name","phetioType","phetioDocumentation","phetioPrivate"].concat(M.VALIDATOR_KEYS),t=>t.phetioType),ae=t=>t.name;class oe extends Vt{constructor(t){const e=c()({parameters:ne,tandem:gt.OPTIONAL,phetioPlayback:Vt.DEFAULT_OPTIONS.phetioPlayback,phetioEventMetadata:Vt.DEFAULT_OPTIONS.phetioEventMetadata,phetioDocumentation:""},t),i=e.parameters.filter(he);e.phetioType=e.phetioOuterType(i.map(he)),e.phetioPlayback&&(e.phetioEventMetadata=e.phetioEventMetadata||{},e.phetioEventMetadata.dataKeys=e.parameters.map(ae)),e.phetioDocumentation=oe.getPhetioDocumentation(e.phetioDocumentation,i),super(e),this.parameters=e.parameters}static validateParameters(t,e){b(t,{valueType:Array});let i=!1;for(let s=0;s<t.length;s++){const e=t[s];i=i||e.phetioPrivate;for(const t in e);M.validateValidator(e)}}validateArguments(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let s=0;s<this.parameters.length;s++){const t=this.parameters[s];t.phetioType&&t.valueType}}getValidationErrors(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const s=[];for(let r=0;r<this.parameters.length;r++){const t=this.parameters[r];let i=M.getValidationError(e[r],t,re);null!==i&&s.push(i),t.phetioType&&!t.valueType&&(i=M.getValidationError(e[r],t.phetioType.validator,re),null!==i&&s.push(i))}return s}getPhetioData(){let t=null;if(this.parameters.length>0){t={};for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];for(let e=0;e<this.parameters.length;e++){const s=this.parameters[e];s.phetioPrivate||(t[s.name]=s.phetioType.toStateObject(i[e]))}}return t}static getPhetioDocumentation(t,e){return t+(0===e.length?"<br>No parameters.":`<br>The parameters are:<br/><ol>${e.map(t=>{const e=t.phetioDocumentation?" - "+t.phetioDocumentation:"";return`<li>${t.name}: ${t.phetioType.typeName}${e}</li>`}).join("<br/>")}</ol>`)}}r.register("PhetioDataHandler",oe);const me=oe;class le extends me{constructor(t){super(c()({phetioOuterType:le.EmitterIO,phetioState:!1},t)),this.tinyEmitter=new n}emit(){gt.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",{data:this.getPhetioData(...arguments)}),this.tinyEmitter.emit(...arguments),gt.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}dispose(){this.tinyEmitter.dispose(),super.dispose()}addListener(t){this.tinyEmitter.addListener(t)}removeListener(t){this.tinyEmitter.removeListener(t)}removeAllListeners(){this.tinyEmitter.removeAllListeners()}hasListener(t){return this.tinyEmitter.hasListener(t)}hasListeners(){return this.tinyEmitter.hasListeners()}getListenerCount(){return this.tinyEmitter.getListenerCount()}debug(t){const e=function(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return console.log(t,...i)};return this.addListener(e),e}}_defineProperty(le,"EmitterIO",t=>{const e=t.map(ue).join(",");return de.has(e)||de.set(e,new X(`EmitterIO<${t.map(ue).join(", ")}>`,{valueType:le,documentation:"Emits when an event occurs and calls added listeners.",parameterTypes:t,events:["emitted"],metadataDefaults:{phetioState:!1},methods:{addListener:{returnType:Ct,parameterTypes:[Xt(Ct,t)],implementation:le.prototype.addListener,documentation:"Adds a listener which will be called when the emitter emits."},removeListener:{returnType:Ct,parameterTypes:[Xt(Ct,t)],implementation:le.prototype.removeListener,documentation:"Remove a listener."},emit:{returnType:Ct,parameterTypes:t,implementation:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const s=this.getValidationErrors(...e);if(s.length>0)throw new Error("Validation errors: "+s.join(", "));this.emit(e)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyElements:!1}}})),de.get(e)});const ue=t=>t.typeName,de=new Map;r.register("Emitter",le);const ce=new X("InfiniteNumberIO",{valueType:"number",documentation:"IO Type for Javascript's number primitive type",toStateObject:t=>t===Number.POSITIVE_INFINITY?"POSITIVE_INFINITY":t===Number.NEGATIVE_INFINITY?"NEGATIVE_INFINITY":t,fromStateObject:t=>"POSITIVE_INFINITY"===t?Number.POSITIVE_INFINITY:"NEGATIVE_INFINITY"===t?Number.NEGATIVE_INFINITY:t,stateSchema:N.asValue("'POSITIVE_INFINITY'|'NEGATIVE_INFINITY'|number",{isValidValue:t=>"POSITIVE_INFINITY"===t||"NEGATIVE_INFINITY"===t||"number"==typeof t&&!isNaN(t)})});p.register("InfiniteNumberIO",ce);const pe=ce,ge=new s("dot");ge.register("FastArray",window.Float64Array?window.Float64Array:window.Array);const ye=ge;class fe{constructor(t,e){this._min=t,this._max=e}getMin(){return this._min}get min(){return this.getMin()}set min(t){this.setMin(t)}setMin(t){this._min=t}getMax(){return this._max}get max(){return this.getMax()}set max(t){this.setMax(t)}setMax(t){this._max=t}setMinMax(t,e){return this._min=t,this._max=e,this}copy(){return new fe(this._min,this._max)}getLength(){return this._max-this._min}getCenter(){return(this._max+this._min)/2}contains(t){return t>=this._min&&t<=this._max}containsRange(t){return this._min<=t.min&&this._max>=t.max}intersects(t){return this._max>=t.min&&t.max>=this._min}intersectsExclusive(t){return this._max>t.min&&t.max>this._min}union(t){return new fe(Math.min(this.min,t.min),Math.max(this.max,t.max))}intersection(t){return new fe(Math.max(this.min,t.min),Math.min(this.max,t.max))}includeRange(t){return this.setMinMax(Math.min(this.min,t.min),Math.max(this.max,t.max))}constrainRange(t){return this.setMinMax(Math.max(this.min,t.min),Math.min(this.max,t.max))}shifted(t){return new fe(this.min+t,this.max+t)}toString(){return`[Range (min:${this._min} max:${this._max})]`}constrainValue(t){return Math.min(Math.max(t,this._min),this._max)}equals(t){return this.constructor===t.constructor&&this._min===t.min&&this._max===t.max}getNormalizedValue(t){return(t-this.min)/this.getLength()}expandNormalizedValue(t){return t*this.getLength()+this.min}get defaultValue(){throw new Error("defaultValue is undefined, did you mean to use RangeWithValue?")}}_defineProperty(fe,"RangeIO",new X("RangeIO",{valueType:fe,documentation:'A range with "min" and a "max" members.',toStateObject:t=>({min:pe.toStateObject(t.min),max:pe.toStateObject(t.max)}),fromStateObject:t=>new fe(pe.fromStateObject(t.min),pe.fromStateObject(t.max)),stateSchema:{min:pe,max:pe}})),_defineProperty(fe,"EVERYTHING",new fe(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)),_defineProperty(fe,"NOTHING",new fe(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)),ye.register("Range",fe);const xe=fe,we=new X("NumberIO",{valueType:"number",documentation:"IO Type for Javascript's number primitive type",toStateObject:_.identity,fromStateObject:t=>t,stateSchema:N.asValue("number",{isValidValue:t=>"number"==typeof t&&!isNaN(t)&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY})});p.register("NumberIO",we);const ve=we,Ee={valueType:"number",isValidValue:t=>t%1==0,validationMessage:"Should be a valid integer"},Me={isValidValue:t=>!isNaN(t),validationMessage:"Should not be NaN"},Te=xe.EVERYTHING,be=ee.PropertyIO(ve);class Ie extends ee{constructor(t,e){const i=c()({numberType:"FloatingPoint",range:Te,validators:[],tandem:gt.OPTIONAL},e);i.rangePropertyOptions=c()({phetioDocumentation:"provides the range of possible values for the parent NumberProperty",phetioValueType:xe.RangeIO,phetioReadOnly:!0,tandem:i.range!==Te?i.tandem.createTandem("rangeProperty"):gt.OPT_OUT},i.rangePropertyOptions),i.valueType="number",i.phetioOuterType=()=>Ie.NumberPropertyIO,i.phetioValueType=ve;const s=!(i.range&&i.range instanceof te),r=i.range instanceof te?i.range:new ee(i.range,i.rangePropertyOptions);i.validators.push(Me),"Integer"===i.numberType&&i.validators.push(Ee),i.validators.push({isValidValue:t=>r.value.contains(t),validationMessage:"Number must be within rangeProperty value."}),super(t,i),this.numberType=i.numberType,this.rangeProperty=r;if(this.rangeProperty.addPhetioStateDependencies([this]),this.addPhetioStateDependencies([this.rangeProperty]),i.validValues&&this.validateNumberAndRangeProperty)for(let n=0;n<i.validValues.length;n++){const t=i.validValues[n];this.validateNumberAndRangeProperty(t)}this.disposeNumberProperty=()=>{s&&this.rangeProperty.dispose()},this.resetNumberProperty=()=>{s&&this.rangeProperty.reset()}}get range(){return this.rangeProperty.value}set range(t){this.rangeProperty.value=t}reset(){this.resetValueAndRange(),super.reset()}dispose(){this.disposeNumberProperty(),super.dispose()}setValueAndRange(t,e){this.setDeferred(!0),this.rangeProperty.setDeferred(!0),this.set(t),this.rangeProperty.set(e);const i=this.setDeferred(!1),s=this.rangeProperty.setDeferred(!1);i&&i(),s&&s()}resetValueAndRange(){this.setValueAndRange(this.initialValue,this.rangeProperty.initialValue)}toStateObject(){const t=be.toStateObject(this);t.numberType=this.numberType,t.range=xe.RangeIO.toStateObject(this.rangeProperty.value);const e=this.rangeProperty&&this.rangeProperty.isPhetioInstrumented();return t.rangePhetioID=e?this.rangeProperty.tandem.phetioID:null,t}}_defineProperty(Ie,"NumberPropertyIO",new X("NumberPropertyIO",{valueType:Ie,supertype:be,parameterTypes:[ve],documentation:`Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${["FloatingPoint","Integer"].join("' | '")}' )`,toStateObject:t=>t.toStateObject(),applyState:(t,e)=>{be.applyState(t,e)},stateSchema:{numberType:ft,range:xe.RangeIO,rangePhetioID:Rt(ft),value:ve}})),r.register("NumberProperty",Ie);const Pe=t=>{A(t,["length"],["elements"]);const e=c()({length:0,elements:[],tandem:gt.OPTIONAL,phetioFeatured:!1},t);let i=null;if(e.phetioType)i={name:"value",phetioType:e.phetioType.parameterTypes[0]};else if(M.getValidatorValidationError(e))i=u({name:"value"},{isValidValue:_.stubTrue});else{const t=_.pick(e,M.VALIDATOR_KEYS);i=u({name:"value"},t)}const s=new le({tandem:e.tandem.createTandem("elementAddedEmitter"),parameters:[i],phetioReadOnly:!0,phetioFeatured:e.phetioFeatured}),r=new le({tandem:e.tandem.createTandem("elementRemovedEmitter"),parameters:[i],phetioReadOnly:!0,phetioFeatured:e.phetioFeatured}),n=new Ie(0,{numberType:"Integer",tandem:e.tandem.createTandem("lengthProperty"),phetioReadOnly:!0,phetioFeatured:e.phetioFeatured}),h=[],a=new Proxy(h,{get:function(t,e,i){return Ve.hasOwnProperty(e)?Ve[e]:Reflect.get(t,e,i)},set:function(t,e,i){const h=t[e];let a=null;"length"===e&&(a=t.slice(i));const o=Reflect.set(t,e,i),m=Number(e);return Number.isInteger(m)&&m>=0&&h!==i?(n.value=t.length,void 0!==h&&r.emit(t[e]),void 0!==i&&s.emit(i)):"length"===e&&(n.value=i,a&&a.forEach(t=>r.emit(t))),o},deleteProperty:function(t,e){const i=Number(e);let s;Number.isInteger(i)&&i>=0&&(s=t[e]);const n=Reflect.deleteProperty(t,e);return void 0!==s&&r.emit(s),n}});a.targetArray=h,a.elementAddedEmitter=s,a.elementRemovedEmitter=r,a.lengthProperty=n;const o=()=>{e.length>=0&&(a.length=e.length),e.elements.length>0&&Array.prototype.push.apply(a,e.elements)};return o(),a.reset=()=>{a.length=0,o()},e.tandem.supplied&&(a.phetioElementType=e.phetioType.parameterTypes[0],a._observableArrayPhetioObject=new Oe(a,e)),a};class Oe extends Vt{constructor(t,e){super(e),this.observableArray=t}}const Ve={pop(){const t=this.targetArray.length;for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];const r=Array.prototype.pop.apply(this.targetArray,i);return this.lengthProperty.value=this.length,t>0&&this.elementRemovedEmitter.emit(r),r},shift(){const t=this.targetArray.length;for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];const r=Array.prototype.shift.apply(this.targetArray,i);return this.lengthProperty.value=this.length,t>0&&this.elementRemovedEmitter.emit(r),r},push(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const s=this,r=Array.prototype.push.apply(s.targetArray,e);s.lengthProperty.value=s.length;for(let n=0;n<arguments.length;n++)s.elementAddedEmitter.emit(e[n]);return r},unshift(){const t=this;for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];const r=Array.prototype.unshift.apply(t.targetArray,i);t.lengthProperty.value=t.length;for(let n=0;n<i.length;n++)t.elementAddedEmitter.emit(i[n]);return r},splice(){const t=this;for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];const r=Array.prototype.splice.apply(t.targetArray,i);t.lengthProperty.value=t.length;const n=r;for(let h=2;h<i.length;h++)t.elementAddedEmitter.emit(i[h]);return n.forEach(e=>t.elementRemovedEmitter.emit(e)),r},copyWithin(){const t=this.targetArray.slice();for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];const r=Array.prototype.copyWithin.apply(this.targetArray,i);return Se(t,this),r},fill(){const t=this.targetArray.slice();for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];const r=Array.prototype.fill.apply(this.targetArray,i);return Se(t,this),r},get:function(t){return this[t]},addItemAddedListener:function(t){this.elementAddedEmitter.addListener(t)},removeItemAddedListener:function(t){this.elementAddedEmitter.removeListener(t)},addItemRemovedListener:function(t){this.elementRemovedEmitter.addListener(t)},removeItemRemovedListener:function(t){this.elementRemovedEmitter.removeListener(t)},add:function(t){this.push(t)},addAll:function(t){this.push(...t)},remove:function(t){Z(this,t)},removeAll:function(t){t.forEach(t=>Z(this,t))},clear:function(){for(;this.length>0;)this.pop()},count:function(t){let e=0;for(let i=0;i<this.length;i++)t(this[i])&&e++;return e},find:function(t,e){return _.find(this,t,e)},shuffle:function(t){const e=t.shuffle(this);this.targetArray.length=0,Array.prototype.push.apply(this.targetArray,e)},getArrayCopy:function(){return this.slice()},dispose:function(){this.elementAddedEmitter.dispose(),this.elementRemovedEmitter.dispose(),this.lengthProperty.dispose(),this._observableArrayPhetioObject&&this._observableArrayPhetioObject.dispose()},toStateObject:function(){return{array:this.map(t=>this.phetioElementType.toStateObject(t))}},applyState:function(t){this.length=0;const e=t.array.map(t=>this.phetioElementType.fromStateObject(t));this.push(...e)}},Se=(t,e)=>{const i=t,s=e.targetArray.slice();for(let r=0;r<i.length;r++){const t=i[r],e=s.indexOf(t);e>=0&&(i.splice(r,1),s.splice(e,1),r--)}i.forEach(t=>e.elementRemovedEmitter.emit(t)),s.forEach(t=>e.elementAddedEmitter.emit(t))},Ae=new Map;Pe.ObservableArrayIO=t=>(Ae.has(t)||Ae.set(t,new X(`ObservableArrayIO<${t.typeName}>`,{valueType:Oe,parameterTypes:[t],toStateObject:t=>t.observableArray.toStateObject(),applyState:(t,e)=>t.observableArray.applyState(e),stateSchema:{array:Dt(t)}})),Ae.get(t)),r.register("createObservableArray",Pe);function Ne(t,e){return t(...e.map(t=>t.get()))}class De extends te{constructor(t,e,i){const s=c()({tandem:gt.OPTIONAL,phetioReadOnly:!0,phetioOuterType:De.DerivedPropertyIO,phetioLinkDependencies:!0},i);super(Ne(e,t),s),gt.VALIDATION&&this.isPhetioInstrumented(),this.dependencies=t,this.derivation=e,this.derivedPropertyListener=this.getDerivedPropertyListener.bind(this),t.forEach(t=>{if(t.lazyLink(this.derivedPropertyListener),this.isPhetioInstrumented()&&t instanceof Vt&&t.isPhetioInstrumented()&&(t instanceof te&&Ut.registerPhetioOrderDependency(t,jt.UNDEFER,this,jt.UNDEFER),s.phetioLinkDependencies)){const e=s.tandem.createTandem("dependencies");this.addLinkedElement(t,{tandem:e.createTandemFromPhetioID(t.tandem.phetioID)})}})}hasDependency(t){return this.definedDependencies.includes(t)}get definedDependencies(){return this.dependencies}getDerivedPropertyListener(){this.isDeferred?this.hasDeferredValue=!0:super.set(Ne(this.derivation,this.definedDependencies))}recomputeDerivation(){this.getDerivedPropertyListener()}dispose(){const t=this.definedDependencies;for(let e=0;e<t.length;e++){const i=t[e];i.hasListener(this.derivedPropertyListener)&&i.unlink(this.derivedPropertyListener)}this.dependencies=null,super.dispose()}setDeferred(t){return this.isDeferred&&!t&&(this.deferredValue=Ne(this.derivation,this.definedDependencies)),super.setDeferred(t)}static valueEquals(t,e,i){return new De([t,e],(t,e)=>t===e,i)}static and(t,e){return De.deriveAny(t,()=>_.reduce(t,Ye,!0),e)}static or(t,e){return De.deriveAny(t,()=>_.reduce(t,_e,!1),e)}static not(t,e){return new De([t],t=>!t,e)}static deriveAny(t,e,i){return new De(t,e,i)}}const Ye=(t,e)=>t&&e.value,_e=(t,e)=>t||e.value,Xe=new Map;De.DerivedPropertyIO=t=>(Xe.has(t)||Xe.set(t,new X(`DerivedPropertyIO<${t.typeName}>`,{valueType:De,parameterTypes:[t],supertype:ee.PropertyIO(t),documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",applyState:_.noop,methods:{setValue:{returnType:Ct,parameterTypes:[t],implementation:De.prototype.set,documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyElements:!1}}})),Xe.get(t));r.register("DerivedProperty",De);class ze extends te{constructor(t,e){const i=c()({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},e),s=i.derive,r=i.map,n=i.inverseMap,h="function"==typeof s?s:t=>t[s],a="function"==typeof r?r:t=>t[r],o="function"==typeof n?n:t=>t[n];super(null===t.value?a(i.defaultValue):a(h(t.value).value),i),this.defaultValue=i.defaultValue,this.derive=h,this.map=a,this.inverseMap=o,this.bidirectional=i.bidirectional,this.valuePropertyProperty=t,this.isExternallyChanging=!1,this.propertyPropertyListener=this.onPropertyPropertyChange.bind(this),this.propertyListener=this.onPropertyChange.bind(this),t.link(this.propertyListener),i.bidirectional&&this.lazyLink(this.onSelfChange.bind(this))}onPropertyPropertyChange(t,e,i){if(this.bidirectional&&null!==this.valuePropertyProperty.value&&i){if(this.derive(this.valuePropertyProperty.value)===i&&i.areValuesEqual(this.inverseMap(this.value),i.get()))return}super.set(this.map(t))}onPropertyChange(t,e){e&&this.derive(e).unlink(this.propertyPropertyListener),t?this.derive(t).link(this.propertyPropertyListener):this.onPropertyPropertyChange(this.defaultValue,null,null)}onSelfChange(t){if(null!==this.valuePropertyProperty.value){const e=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(t,this.map(e.value))||(e.value=this.inverseMap(t))}}dispose(){this.valuePropertyProperty.unlink(this.propertyListener),null!==this.valuePropertyProperty.value&&this.derive(this.valuePropertyProperty.value).unlink(this.propertyPropertyListener),super.dispose()}reset(){if(null!==this.valuePropertyProperty.value){this.derive(this.valuePropertyProperty.value).reset()}}set(t){this.isExternallyChanging=!0,super.set(t),this.isExternallyChanging=!1}get value(){return super.value}set value(t){this.set(t)}isSettable(){return super.isSettable()||this.bidirectional}}r.register("DynamicProperty",ze);class Fe extends ee{constructor(t,e,i){f("Use EnumerationProperty. EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples."),super(e,i=u({valueType:t,phetioValueType:K(t),validValues:t.VALUES},i)),this.enumeration=t}}r.register("EnumerationDeprecatedProperty",Fe);class Re extends ze{constructor(t,e){super(new Gt(t),e)}}r.register("MappedProperty",Re);class Le{constructor(t,e,i){if(this.dependencies=t,this.dependencyListeners=new Map,t.forEach(i=>{const s=()=>{if(!this.isDisposed){const i=t.map(t=>t.get());e(...i)}};this.dependencyListeners.set(i,s),i.lazyLink(s,{phetioDependencies:_.without(t,i)})}),!i){const i=t.map(t=>t.get());e(...i)}this.isDisposed=!1}get definedDependencies(){return this.dependencies}dispose(){const t=this.definedDependencies;for(let e=0;e<t.length;e++){const i=t[e],s=this.dependencyListeners.get(i);i.hasListener(s)&&i.unlink(s)}this.dependencies=null,this.dependencyListeners.clear(),this.isDisposed=!0}static multilink(t,e){return new Le(t,e,!1)}static multilinkAny(t,e){return new Le(t,e)}static lazyMultilink(t,e){return new Le(t,e,!0)}static unmultilink(t){t.dispose()}}r.register("Multilink",Le);class Ce{constructor(t,e){_defineProperty(this,"objects",[]);const i=c()({defaultArguments:[],initialize:t.prototype.initialize,maxSize:100,initialSize:0,useDefaultConstruction:!1},e);for(this._maxPoolSize=i.maxSize,this.partialConstructor=Function.prototype.bind.bind(t,t),this.DefaultConstructor=this.partialConstructor(...i.defaultArguments),this.initialize=i.initialize,this.useDefaultConstruction=i.useDefaultConstruction;this.objects.length<i.initialSize;)this.objects.push(this.createDefaultObject())}createDefaultObject(){return new this.DefaultConstructor}fetch(){return this.objects.length?this.objects.pop():this.createDefaultObject()}create(){let t;for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return this.objects.length?(t=this.objects.pop(),this.initialize.apply(t,i)):this.useDefaultConstruction?(t=this.createDefaultObject(),this.initialize.apply(t,i)):t=new(this.partialConstructor(...i)),t}get poolSize(){return this.objects.length}set maxPoolSize(t){this._maxPoolSize=t}get maxPoolSize(){return this._maxPoolSize}freeToPool(t){this.objects.length<this.maxPoolSize&&this.objects.push(t)}forEach(t){this.objects.forEach(t)}}m.register("Pool",Ce);class Ze{constructor(t,e,i,s){this.x=t,this.y=e,this.z=i,this.w=s}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.dot(this)}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(t){return this.minus(t).magnitude}distanceXYZW(t,e,i,s){const r=this.x-t,n=this.y-e,h=this.z-i,a=this.w-s;return Math.sqrt(r*r+n*n+h*h+a*a)}distanceSquared(t){return this.minus(t).magnitudeSquared}distanceSquaredXYZW(t,e,i,s){const r=this.x-t,n=this.y-e,h=this.z-i,a=this.w-s;return r*r+n*n+h*h+a*a}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}dotXYZW(t,e,i,s){return this.x*t+this.y*e+this.z*i+this.w*s}angleBetween(t){return Math.acos(ye.clamp(this.normalized().dot(t.normalized()),-1,1))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}equalsEpsilon(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)<=e}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)}copy(t){return t?t.set(this):je(this.x,this.y,this.z,this.w)}normalized(){const t=this.magnitude;return this.dividedScalar(t)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(t){return this.copy().setMagnitude(t)}timesScalar(t){return je(this.x*t,this.y*t,this.z*t,this.w*t)}times(t){return this.timesScalar(t)}componentTimes(t){return je(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}plus(t){return je(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}plusXYZW(t,e,i,s){return je(this.x+t,this.y+e,this.z+i,this.w+s)}plusScalar(t){return je(this.x+t,this.y+t,this.z+t,this.w+t)}minus(t){return je(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}minusXYZW(t,e,i,s){return je(this.x-t,this.y-e,this.z-i,this.w-s)}minusScalar(t){return je(this.x-t,this.y-t,this.z-t,this.w-t)}dividedScalar(t){return je(this.x/t,this.y/t,this.z/t,this.w/t)}negated(){return je(-this.x,-this.y,-this.z,-this.w)}blend(t,e){return this.plus(t.minus(this).times(e))}average(t){return this.blend(t,.5)}toString(){return`Vector4(${this.x}, ${this.y}, ${this.z}, ${this.w})`}toVector3(){return new Be(this.x,this.y,this.z)}setXYZW(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}set(t){return this.setXYZW(t.x,t.y,t.z,t.w)}setMagnitude(t){const e=t/this.magnitude;return this.multiplyScalar(e)}add(t){return this.setXYZW(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}addXYZW(t,e,i,s){return this.setXYZW(this.x+t,this.y+e,this.z+i,this.w+s)}addScalar(t){return this.setXYZW(this.x+t,this.y+t,this.z+t,this.w+t)}subtract(t){return this.setXYZW(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}subtractXYZW(t,e,i,s){return this.setXYZW(this.x-t,this.y-e,this.z-i,this.w-s)}subtractScalar(t){return this.setXYZW(this.x-t,this.y-t,this.z-t,this.w-t)}multiplyScalar(t){return this.setXYZW(this.x*t,this.y*t,this.z*t,this.w*t)}multiply(t){return this.multiplyScalar(t)}componentMultiply(t){return this.setXYZW(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}divideScalar(t){return this.setXYZW(this.x/t,this.y/t,this.z/t,this.w/t)}negate(){return this.setXYZW(-this.x,-this.y,-this.z,-this.w)}normalize(){const t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}roundSymmetric(){return this.setXYZW(ri.roundSymmetric(this.x),ri.roundSymmetric(this.y),ri.roundSymmetric(this.z),ri.roundSymmetric(this.w))}freeToPool(){Ze.pool.freeToPool(this)}}_defineProperty(Ze,"pool",new Ce(Ze,{maxSize:1e3,initialize:Ze.prototype.setXYZW,defaultArguments:[0,0,0,0]})),Ze.prototype.isVector4=!0,Ze.prototype.dimension=4,ye.register("Vector4",Ze);const je=Ze.pool.create.bind(Ze.pool);ye.register("v4",je);class qe extends Ze{static mutableOverrideHelper(t){qe.prototype[t]=()=>{throw new Error(`Cannot call mutable method '${t}' on immutable Vector3`)}}}qe.mutableOverrideHelper("setXYZW"),qe.mutableOverrideHelper("setX"),qe.mutableOverrideHelper("setY"),qe.mutableOverrideHelper("setZ"),qe.mutableOverrideHelper("setW"),Ze.ZERO=new Ze(0,0,0,0),Ze.X_UNIT=new Ze(1,0,0,0),Ze.Y_UNIT=new Ze(0,1,0,0),Ze.Z_UNIT=new Ze(0,0,1,0),Ze.W_UNIT=new Ze(0,0,0,1);const ke=(t,e)=>t.add(e);class Be{constructor(t,e,i){this.x=t,this.y=e,this.z=i}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.dot(this)}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceXYZ(t,e,i){const s=this.x-t,r=this.y-e,n=this.z-i;return Math.sqrt(s*s+r*r+n*n)}distanceSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}distanceSquaredXYZ(t,e,i){const s=this.x-t,r=this.y-e,n=this.z-i;return s*s+r*r+n*n}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}dotXYZ(t,e,i){return this.x*t+this.y*e+this.z*i}angleBetween(t){return Math.acos(ri.clamp(this.normalized().dot(t.normalized()),-1,1))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}equalsEpsilon(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)<=e}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)}copy(t){return t?t.set(this):$e(this.x,this.y,this.z)}cross(t){return $e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}normalized(){const t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return $e(this.x/t,this.y/t,this.z/t)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(t){return this.copy().setMagnitude(t)}timesScalar(t){return $e(this.x*t,this.y*t,this.z*t)}times(t){return this.timesScalar(t)}componentTimes(t){return $e(this.x*t.x,this.y*t.y,this.z*t.z)}plus(t){return $e(this.x+t.x,this.y+t.y,this.z+t.z)}plusXYZ(t,e,i){return $e(this.x+t,this.y+e,this.z+i)}plusScalar(t){return $e(this.x+t,this.y+t,this.z+t)}minus(t){return $e(this.x-t.x,this.y-t.y,this.z-t.z)}minusXYZ(t,e,i){return $e(this.x-t,this.y-e,this.z-i)}minusScalar(t){return $e(this.x-t,this.y-t,this.z-t)}dividedScalar(t){return $e(this.x/t,this.y/t,this.z/t)}negated(){return $e(-this.x,-this.y,-this.z)}blend(t,e){return this.plus(t.minus(this).times(e))}average(t){return this.blend(t,.5)}static average(t){return _.reduce(t,ke,new Be(0,0,0)).divideScalar(t.length)}toString(){return`Vector3(${this.x}, ${this.y}, ${this.z})`}toVector2(){return We(this.x,this.y)}toVector4(){return je(this.x,this.y,this.z,1)}setXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}set(t){return this.setXYZ(t.x,t.y,t.z)}setMagnitude(t){const e=t/this.magnitude;return this.multiplyScalar(e)}add(t){return this.setXYZ(this.x+t.x,this.y+t.y,this.z+t.z)}addXYZ(t,e,i){return this.setXYZ(this.x+t,this.y+e,this.z+i)}addScalar(t){return this.setXYZ(this.x+t,this.y+t,this.z+t)}subtract(t){return this.setXYZ(this.x-t.x,this.y-t.y,this.z-t.z)}subtractXYZ(t,e,i){return this.setXYZ(this.x-t,this.y-e,this.z-i)}subtractScalar(t){return this.setXYZ(this.x-t,this.y-t,this.z-t)}multiplyScalar(t){return this.setXYZ(this.x*t,this.y*t,this.z*t)}multiply(t){return this.multiplyScalar(t)}componentMultiply(t){return this.setXYZ(this.x*t.x,this.y*t.y,this.z*t.z)}divideScalar(t){return this.setXYZ(this.x/t,this.y/t,this.z/t)}negate(){return this.setXYZ(-this.x,-this.y,-this.z)}setCross(t){return this.setXYZ(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}normalize(){const t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}roundSymmetric(){return this.setXYZ(ri.roundSymmetric(this.x),ri.roundSymmetric(this.y),ri.roundSymmetric(this.z))}toStateObject(){return{x:this.x,y:this.y,z:this.z}}freeToPool(){Be.pool.freeToPool(this)}static slerp(t,e,i){return ye.Quaternion.slerp(new ye.Quaternion,ye.Quaternion.getRotationQuaternion(t,e),i).timesVector3(t)}static fromStateObject(t){return $e(t.x,t.y,t.z)}}_defineProperty(Be,"pool",new Ce(Be,{maxSize:1e3,initialize:Be.prototype.setXYZ,defaultArguments:[0,0,0]})),Be.prototype.isVector3=!0,Be.prototype.dimension=3,ye.register("Vector3",Be);const $e=Be.pool.create.bind(Be.pool);ye.register("v3",$e);class He extends Be{static mutableOverrideHelper(t){He.prototype[t]=()=>{throw new Error(`Cannot call mutable method '${t}' on immutable Vector3`)}}}He.mutableOverrideHelper("setXYZ"),He.mutableOverrideHelper("setX"),He.mutableOverrideHelper("setY"),He.mutableOverrideHelper("setZ"),Be.ZERO=new Be(0,0,0),Be.X_UNIT=new Be(1,0,0),Be.Y_UNIT=new Be(0,1,0),Be.Z_UNIT=new Be(0,0,1),Be.Vector3IO=new X("Vector3IO",{valueType:Be,documentation:"Basic 3-dimensional vector, represented as (x,y,z)",toStateObject:t=>t.toStateObject(),fromStateObject:Be.fromStateObject,stateSchema:{x:ve,y:ve,z:ve}});const Ue=(t,e)=>t.add(e);class Ge{constructor(t,e){this.x=t,this.y=e}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceXY(t,e){const i=this.x-t,s=this.y-e;return Math.sqrt(i*i+s*s)}distanceSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}distanceSquaredXY(t,e){const i=this.x-t,s=this.y-e;return i*i+s*s}dot(t){return this.x*t.x+this.y*t.y}dotXY(t,e){return this.x*t+this.y*e}getAngle(){return Math.atan2(this.y,this.x)}get angle(){return this.getAngle()}angleBetween(t){const e=this.magnitude,i=t.magnitude;return Math.acos(ye.clamp((this.x*t.x+this.y*t.y)/(e*i),-1,1))}equals(t){return this.x===t.x&&this.y===t.y}equalsEpsilon(t,e){return e||(e=0),Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))<=e}isFinite(){return isFinite(this.x)&&isFinite(this.y)}copy(t){return t?t.set(this):We(this.x,this.y)}crossScalar(t){return this.x*t.y-this.y*t.x}normalized(){const t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return We(this.x/t,this.y/t)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(t){return this.copy().setMagnitude(t)}timesScalar(t){return We(this.x*t,this.y*t)}times(t){return this.timesScalar(t)}componentTimes(t){return We(this.x*t.x,this.y*t.y)}plus(t){return We(this.x+t.x,this.y+t.y)}plusXY(t,e){return We(this.x+t,this.y+e)}plusScalar(t){return We(this.x+t,this.y+t)}minus(t){return We(this.x-t.x,this.y-t.y)}minusXY(t,e){return We(this.x-t,this.y-e)}minusScalar(t){return We(this.x-t,this.y-t)}dividedScalar(t){return We(this.x/t,this.y/t)}negated(){return We(-this.x,-this.y)}getPerpendicular(){return We(this.y,-this.x)}get perpendicular(){return this.getPerpendicular()}rotated(t){const e=this.angle+t,i=this.magnitude;return We(i*Math.cos(e),i*Math.sin(e))}rotateAboutXY(t,e,i){const s=this.x-t,r=this.y-e,n=Math.cos(i),h=Math.sin(i);return this.x=t+s*n-r*h,this.y=e+s*h+r*n,this}rotateAboutPoint(t,e){return this.rotateAboutXY(t.x,t.y,e)}rotatedAboutXY(t,e,i){return We(this.x,this.y).rotateAboutXY(t,e,i)}rotatedAboutPoint(t,e){return this.rotatedAboutXY(t.x,t.y,e)}blend(t,e){return We(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}average(t){return this.blend(t,.5)}static average(t){return _.reduce(t,Ue,new Ge(0,0)).divideScalar(t.length)}toString(){return`Vector2(${this.x}, ${this.y})`}toVector3(){return new Be(this.x,this.y,0)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}set(t){return this.setXY(t.x,t.y)}setMagnitude(t){const e=t/this.magnitude;return this.multiplyScalar(e)}add(t){return this.setXY(this.x+t.x,this.y+t.y)}addXY(t,e){return this.setXY(this.x+t,this.y+e)}addScalar(t){return this.setXY(this.x+t,this.y+t)}subtract(t){return this.setXY(this.x-t.x,this.y-t.y)}subtractXY(t,e){return this.setXY(this.x-t,this.y-e)}subtractScalar(t){return this.setXY(this.x-t,this.y-t)}multiplyScalar(t){return this.setXY(this.x*t,this.y*t)}multiply(t){return this.multiplyScalar(t)}componentMultiply(t){return this.setXY(this.x*t.x,this.y*t.y)}divideScalar(t){return this.setXY(this.x/t,this.y/t)}negate(){return this.setXY(-this.x,-this.y)}normalize(){const t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}roundSymmetric(){return this.setXY(ri.roundSymmetric(this.x),ri.roundSymmetric(this.y))}rotate(t){const e=this.angle+t,i=this.magnitude;return this.setXY(i*Math.cos(e),i*Math.sin(e))}setPolar(t,e){return this.setXY(t*Math.cos(e),t*Math.sin(e))}toStateObject(){return{x:this.x,y:this.y}}freeToPool(){Ge.pool.freeToPool(this)}static createPolar(t,e){return new Ge(0,0).setPolar(t,e)}static fromStateObject(t){return We(t.x,t.y)}static getAngleBetweenVectors(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.atan2(s,i)}static getDistanceBetweenVectors(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}}_defineProperty(Ge,"pool",new Ce(Ge,{maxSize:1e3,initialize:Ge.prototype.setXY,defaultArguments:[0,0]})),Ge.prototype.isVector2=!0,Ge.prototype.dimension=2,ye.register("Vector2",Ge);const We=Ge.pool.create.bind(Ge.pool);ye.register("v2",We);class Ke extends Ge{static mutableOverrideHelper(t){Ke.prototype[t]=()=>{throw new Error(`Cannot call mutable method '${t}' on immutable Vector2`)}}}Ke.mutableOverrideHelper("setXY"),Ke.mutableOverrideHelper("setX"),Ke.mutableOverrideHelper("setY"),Ge.ZERO=new Ge(0,0),Ge.X_UNIT=new Ge(1,0),Ge.Y_UNIT=new Ge(0,1),Ge.Vector2IO=new X("Vector2IO",{valueType:Ge,stateSchema:{x:ve,y:ve},toStateObject:t=>t.toStateObject(),fromStateObject:t=>Ge.fromStateObject(t),documentation:"A numerical object with x and y properties, like {x:3,y:4}"});const Qe=Number.MIN_VALUE,Je=2*Math.PI;let ti,ei,ii;const si={clamp:(t,e,i)=>t<e?e:t>i?i:t,moduloBetweenDown(t,e,i){const s=i-e;let r=(t-e)%s;return r<0&&(r+=s),r+e},moduloBetweenUp:(t,e,i)=>-si.moduloBetweenDown(-t,-i,-e),rangeInclusive(t,e){if(e<t)return[];const i=new Array(e-t+1);for(let s=t;s<=e;s++)i[s-t]=s;return i},rangeExclusive:(t,e)=>si.rangeInclusive(t+1,e-1),toRadians:t=>Math.PI*t/180,toDegrees:t=>180*t/Math.PI,mod:(t,e)=>t/e%1==0?0:t%e,gcd(t,e){return Math.abs(0===e?t:this.gcd(e,si.mod(t,e)))},lcm:(t,e)=>si.roundSymmetric(Math.abs(t*e)/si.gcd(t,e)),lineLineIntersection(t,e,i,s){if(t.equals(e)||i.equals(s))return null;const r=t.x-e.x,n=i.x-s.x,h=t.y-e.y,a=i.y-s.y,o=r*a-h*n;if(Math.abs(o)<1e-10)return null;const m=t.x*e.y-t.y*e.x,l=i.x*s.y-i.y*s.x;return new Ge((m*n-r*l)/o,(m*a-h*l)/o)},circleCenterFromPoints(t,e,i){const s=new Ge((t.x+e.x)/2,(t.y+e.y)/2),r=new Ge((e.x+i.x)/2,(e.y+i.y)/2),n=new Ge(s.x+(e.y-t.y),s.y-(e.x-t.x)),h=new Ge(r.x+(i.y-e.y),r.y-(i.x-e.x));return si.lineLineIntersection(s,n,r,h)},pointInCircleFromPoints(t,e,i,s){const r=t.x-s.x,n=t.y-s.y,h=(t.x-s.x)*(t.x-s.x)+(t.y-s.y)*(t.y-s.y),a=e.x-s.x,o=e.y-s.y,m=(e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y),l=i.x-s.x,u=i.y-s.y,d=(i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y);return r*o*d+n*m*l+h*a*u-h*o*l-n*a*d-r*m*u>0},sphereRayIntersection(t,e,i){i=void 0===i?1e-5:i;const s=new Be(0,0,0),r=e.direction,n=e.position,h=n.minus(s),a=r.dot(h),o=4*a*a-4*(h.magnitudeSquared-t*t);if(o<i)return null;const m=r.dot(s)-r.dot(n),l=Math.sqrt(o)/2,u=m-l,d=m+l;if(d<i)return null;const c=e.pointAtDistance(d),p=c.minus(s).normalized();if(u<i)return{distance:d,hitPoint:c,normal:p.negated(),fromOutside:!1};{const t=e.pointAtDistance(u),i=t.minus(s).normalized();return{distance:u,hitPoint:t,normal:i,fromOutside:!0}}},solveLinearRootsReal:(t,e)=>0===t?0===e?null:[]:[-e/t],solveQuadraticRootsReal(t,e,i){if(0===t||Math.abs(e/t)>1e7||Math.abs(i/t)>1e7)return si.solveLinearRootsReal(e,i);const s=e*e-4*t*i;if(s<0)return[];const r=Math.sqrt(s);return[(-e-r)/(2*t),(-e+r)/(2*t)]},solveCubicRootsReal(t,e,i,s){let r,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e-7;if(0===t)r=si.solveQuadraticRootsReal(e,i,s);else{const h=1e7;if(0===t||Math.abs(e/t)>h||Math.abs(i/t)>h||Math.abs(s/t)>h)r=si.solveQuadraticRootsReal(e,i,s);else if(0===s||Math.abs(t/s)>h||Math.abs(e/s)>h||Math.abs(i/s)>h)r=[0].concat(si.solveQuadraticRootsReal(t,e,i));else{const h=(3*(i/=t)-(e/=t)*e)/9,a=(-27*(s/=t)+e*(9*i-e*e*2))/54,o=h*h*h+a*a,m=e/3;if(o>n){const t=Math.sqrt(o);r=[si.cubeRoot(a+t)+si.cubeRoot(a-t)-m]}else if(o>-n){const t=si.cubeRoot(a),e=-m-t;r=[2*t-m,e,e]}else{let t=-h*h*h;t=Math.acos(a/Math.sqrt(t));const e=2*Math.sqrt(-h);r=[-m+e*Math.cos(t/3),-m+e*Math.cos((t+2*Math.PI)/3),-m+e*Math.cos((t+4*Math.PI)/3)]}}}return r},cubeRoot:t=>t>=0?Math.pow(t,1/3):-Math.pow(-t,1/3),linear:(t,e,i,s,r)=>(s-i)/(e-t)*(r-t)+i,roundSymmetric:t=>(t<0?-1:1)*Math.round(Math.abs(t)),toFixed(t,e){const i=Math.pow(10,e);return(si.roundSymmetric(t*i)/i).toFixed(e)},toFixedNumber:(t,e)=>parseFloat(si.toFixed(t,e)),equalsEpsilon:(t,e,i)=>Math.abs(t-e)<=i,lineSegmentIntersection(t,e,i,s,r,n,h,a){const o=(t,e,i,s,r,n)=>(n-e)*(i-t)-(s-e)*(r-t);if(o(t,e,r,n,h,a)*o(i,s,r,n,h,a)>0||o(r,n,t,e,i,s)*o(h,a,t,e,i,s)>0)return null;const m=(t-i)*(n-a)-(e-s)*(r-h);return Math.abs(m)<1e-10?null:t===r&&e===n||t===h&&e===a?new Ge(t,e):i===r&&s===n||i===h&&s===a?new Ge(i,s):new Ge(((t*s-e*i)*(r-h)-(t-i)*(r*a-n*h))/m,((t*s-e*i)*(n-a)-(e-s)*(r*a-n*h))/m)},distToSegmentSquared(t,e,i){const s=e.distanceSquared(i);if(0===s)return t.distanceSquared(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/s;let n;return n=r<0?t.distanceSquared(e):r>1?t.distanceSquared(i):t.distanceSquared(new Ge(e.x+r*(i.x-e.x),e.y+r*(i.y-e.y))),n},distToSegment(t,e,i){return Math.sqrt(this.distToSegmentSquared(t,e,i))},arePointsCollinear:(t,e,i,s)=>(void 0===s&&(s=0),si.triangleArea(t,e,i)<=s),triangleArea:(t,e,i)=>Math.abs(si.triangleAreaSigned(t,e,i)),triangleAreaSigned:(t,e,i)=>t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y),centroidOfPolygon(t){const e=new Ge(0,0);let i=0;return t.forEach((s,r)=>{const n=t[(r+1)%t.length],h=s.x*n.y-n.x*s.y;i+=h/2,e.addXY((s.x+n.x)*h,(s.y+n.y)*h)}),e.divideScalar(6*i),e},cosh:t=>(Math.exp(t)+Math.exp(-t))/2,sinh:t=>(Math.exp(t)-Math.exp(-t))/2,log10:t=>Math.log(t)/Math.LN10,boxMullerTransform(t,e,i){if(ti=!ti,!ti)return ii*e+t;let s,r;do{s=i.nextDouble(),r=i.nextDouble()}while(s<=Qe);return ei=Math.sqrt(-2*Math.log(s))*Math.cos(Je*r),ii=Math.sqrt(-2*Math.log(s))*Math.sin(Je*r),ei*e+t},numberOfDecimalPlaces(t){if(Math.floor(t)===t)return 0;{const e=t.toString();if(e.includes("e")){const t=e.split("e"),i=t[0],s=Number(t[1]),r=i.includes(".")?i.split(".")[1].length:0;return Math.max(r-s,0)}return e.split(".")[1].length}},roundToInterval:(t,e)=>si.toFixedNumber(si.roundSymmetric(t/e)*e,si.numberOfDecimalPlaces(e))};ye.register("Utils",si),ye.clamp=si.clamp,ye.moduloBetweenDown=si.moduloBetweenDown,ye.moduloBetweenUp=si.moduloBetweenUp,ye.rangeInclusive=si.rangeInclusive,ye.rangeExclusive=si.rangeExclusive,ye.toRadians=si.toRadians,ye.toDegrees=si.toDegrees,ye.lineLineIntersection=si.lineLineIntersection,ye.lineSegmentIntersection=si.lineSegmentIntersection,ye.sphereRayIntersection=si.sphereRayIntersection,ye.solveQuadraticRootsReal=si.solveQuadraticRootsReal,ye.solveCubicRootsReal=si.solveCubicRootsReal,ye.cubeRoot=si.cubeRoot,ye.linear=si.linear,ye.boxMullerTransform=si.boxMullerTransform;const ri=si,ni=t=>""+t;r.register("PatternStringProperty",class extends De{constructor(t,e,i){const s=c()({formatNames:[],decimalPlaces:null,phetioValueType:ft},i),r=[t],n={},h=Object.keys(e);h.forEach(t=>{const i=e[t];(i instanceof te||i instanceof Gt)&&r.push(i);let h=ni;if(null!==s.decimalPlaces&&("number"==typeof s.decimalPlaces||null!==s.decimalPlaces[t])){const e="number"==typeof s.decimalPlaces||null===s.decimalPlaces?s.decimalPlaces:s.decimalPlaces[t];h=t=>ni("number"==typeof t?ri.toFixed(t,e):t)}s.maps&&s.maps.hasOwnProperty(t)?n[t]=e=>h(s.maps[t](e)):n[t]=h}),super(r,(function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];const m=t=>{const e=r.indexOf(t);return e>=0?a[e]:t};let l=""+m(t);s.formatNames.forEach((t,e)=>{l=l.replace(new RegExp(`\\{${e}\\}`,"g"),`{{${t}}}`)});const u=l.match(/\{\{[^{}]+\}\}/g)||[];for(let t=0;t<u.length;t++){const i=u[t],s=i.replace("{{","").replace("}}","");if(h.includes(s)){let t=m(e[s]);n[s]&&(t=n[s](t)),l=l.replace(i,""+t)}}return l}),s)}});r.register("StringProperty",class extends ee{constructor(t,e){super(t,c()({valueType:"string",phetioValueType:ft},e))}});r.register("TinyForwardingProperty",class extends Gt{constructor(t,e,i){super(t,i),e&&(this.targetPropertyInstrumented=e)}setValueOrTargetProperty(t,e,i){if((s=i)instanceof te||s instanceof Gt)this.setTargetProperty(t,e,i);else{const t=this.get();this.clearTargetProperty(),this.setPropertyValue(i),this.areValuesEqual(t,i)||this.notifyListeners(t)}var s}setTargetProperty(t,e,i){if(this.targetProperty===i)return t;this.targetProperty&&this.targetProperty instanceof te&&this.targetProperty.isPhetioInstrumented();const s=this.targetProperty;this.ownedPhetioProperty&&i!==this.ownedPhetioProperty&&this.disposeOwnedPhetioProperty(),t&&null!==e&&t.updateLinkedElementForProperty(e,s,i);const r=this.get();return this.clearTargetProperty(),this.targetProperty=i,this.targetProperty?(this.targetProperty.lazyLink(this.forwardingListener),this.setPropertyValue(this.targetProperty.value)):this.setPropertyValue(r),this.areValuesEqual(r,this.get())||this.notifyListeners(r),t}clearTargetProperty(){this.forwardingListener=this.forwardingListener||this.onTargetPropertyChange.bind(this),this.targetProperty&&this.targetProperty.unlink(this.forwardingListener),this.targetProperty=null}onTargetPropertyChange(t){super.set(t)}set(t){return this.targetProperty?this.targetProperty.set(t):super.set(t),this}setTargetPropertyInstrumented(t,e){return this.targetPropertyInstrumented=t,e}getTargetPropertyInstrumented(){return this.targetPropertyInstrumented||!1}initializePhetio(t,e,i){!this.targetProperty&&this.targetPropertyInstrumented?(this.ownedPhetioProperty=i(),this.setTargetProperty(t,e,this.ownedPhetioProperty)):this.targetProperty&&this.targetProperty instanceof te&&this.targetProperty.isPhetioInstrumented()&&t.updateLinkedElementForProperty(e,null,this.targetProperty)}disposeOwnedPhetioProperty(){this.ownedPhetioProperty&&(this.ownedPhetioProperty.dispose(),delete this.ownedPhetioProperty)}dispose(){this.clearTargetProperty(),this.disposeOwnedPhetioProperty(),super.dispose()}});r.register("TinyOverrideProperty",class extends Gt{constructor(t){super(t.value),_defineProperty(this,"isOverridden",!1),this._targetProperty=t,this._targetListener=this.onTargetPropertyChange.bind(this),this._targetProperty.lazyLink(this._targetListener)}set targetProperty(t){this.setTargetProperty(t)}setTargetProperty(t){if(this.targetProperty===t)return;const e=this.value;this.isOverridden||this._targetProperty.unlink(this._targetListener),this._targetProperty=t,this.isOverridden||(this._targetProperty.lazyLink(this._targetListener),this.equalsValue(e)||this.notifyListeners(e))}clearOverride(){if(this.isOverridden){const t=this.value;this.isOverridden=!1,this._targetProperty.lazyLink(this._targetListener),this.equalsValue(t)||this.notifyListeners(t)}}get(){return this.isOverridden?this._value:this._targetProperty.value}set(t){this.isOverridden||(this._value=this._targetProperty.value),super.set(t)}setPropertyValue(t){this.isOverridden||(this.isOverridden=!0,this._targetProperty.unlink(this._targetListener)),super.setPropertyValue(t)}equalsValue(t){return this.areValuesEqual(t,this.value)}onTargetPropertyChange(t,e){this.isOverridden||this.notifyListeners(e)}notifyListeners(t){this.emit(this.value,t,this)}dispose(){this.isOverridden||this._targetProperty.unlink(this._targetListener),super.dispose()}});function hi(t){return(t instanceof te||t instanceof Gt)&&t.isSettable()&&!!t.range&&!!t.rangeProperty}r.register("TinyStaticProperty",class extends Gt{constructor(t,e){super(t),this.onAccessAttempt=e}get(){return this.onAccessAttempt(),super.get()}set(t){throw new Error("Cannot set a TinyStaticProperty value")}isSettable(){return!1}notifyListeners(t){this.emit(this.get(),t,this)}link(t){this.addListener(t),t(this.get(),null,this)}equalsValue(t){return this.areValuesEqual(t,this.get())}});r.register("UnitConversionProperty",class extends Re{constructor(t,e){const i=t=>t*e.factor;super(t,c()({bidirectional:!0,map:i,inverseMap:t=>t/e.factor},e)),this._property=t,this.rangeProperty=new ee(Te),hi(t)&&(this._rangeListener=t=>{const e=i(t.min),s=i(t.max);this.rangeProperty.value=new xe(Math.min(e,s),Math.max(e,s))},t.rangeProperty.link(this._rangeListener))}get range(){return this.rangeProperty.value}set range(t){this.rangeProperty.value=t}dispose(){hi(this._property)&&this._property.rangeProperty.unlink(this._rangeListener),this.rangeProperty.dispose()}});function ai(t,e,i,s,r){i=i||[],s=s||[],r=r||[],Array.prototype.push.apply(i,t),Array.prototype.push.apply(s,e);t:for(let n=0;n<i.length;n++){const t=i[n];for(let e=0;e<s.length;e++){if(t===s[e]){if(r.push(t),i.splice(n,1),s.splice(e,1),e=0,n===i.length)break t;n-=1}}}return i}m.register("arrayDifference",ai);function oi(t){if(t){for(;t.length;)t.pop();return t}return[]}m.register("cleanArray",oi);function mi(t){const e=[];return t(t=>{e.push(t)}),e}m.register("collect",mi);function li(t,e){return void 0!==t[e]?e:void 0!==t["moz"+(e=e.charAt(0).toUpperCase()+e.slice(1))]?"moz"+e:void 0!==t["Moz"+e]?"Moz"+e:void 0!==t["webkit"+e]?"webkit"+e:void 0!==t["ms"+e]?"ms"+e:void 0!==t["o"+e]?"o"+e:void 0}m.register("detectPrefix",li);function ui(t,e,i){return void 0!==t["on"+e]?e:void 0!==t["onmoz"+e]?"moz"+e:void 0!==t["onMoz"+e]?"Moz"+e:void 0!==t["onwebkit"+e]?"webkit"+e:void 0!==t["onms"+e]?"ms"+e:void 0!==t["ono"+e]?"o"+e:void 0}m.register("detectPrefixEvent",ui);function di(t,e,i){const s=[];return function t(e,r){return r.forEach((r,n)=>{s.push(n),1===e?i(...[r].concat(s)):t(e-1,r),s.pop()})}(t,e)}m.register("dimensionForEach",di);function ci(t,e,i){const s=[];return function t(e,r){return r.map((r,n)=>{s.push(n);const h=1===e?i(...[r].concat(s)):t(e-1,r);return s.pop(),h})}(t,e)}m.register("dimensionMap",ci);class pi{constructor(t,e){_defineProperty(this,"_map",new Map),this._enumeration=t,this._values=t.enumeration.values,this._values.forEach(t=>{this._map.set(t,e(t))})}get(t){return this._map.get(t)}set(t,e){this._map.set(t,e)}map(t){return new pi(this._enumeration,e=>t(this.get(e),e))}forEach(t){this._values.forEach(e=>t(this.get(e),e))}values(){return this._values.map(t=>this.get(t))}}m.register("EnumerationMap",pi);const gi=pi;function yi(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}m.register("escapeHTML",yi);class fi{constructor(t,e){this.eventModel=t,this.eventCallback=e,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period}step(t){for(;t>=this.timeBeforeNextEvent;)t-=this.timeBeforeNextEvent,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period,this.eventCallback(t);this.timeBeforeNextEvent-=t}getRatio(){return(this.period-this.timeBeforeNextEvent)/this.period}}function xi(t){return _.each(Array.prototype.slice.call(arguments,1),e=>{if(e)for(const i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t}_defineProperty(fi,"ConstantEventModel",class{constructor(t){this.rate=t}getPeriodBeforeNextEvent(){return 1/this.rate}}),_defineProperty(fi,"UniformEventModel",class{constructor(t,e){this.rate=t,this.pseudoRandomNumberSource=e}getPeriodBeforeNextEvent(){const t=this.pseudoRandomNumberSource();return 2*t/this.rate}}),_defineProperty(fi,"PoissonEventModel",class{constructor(t,e){this.rate=t,this.pseudoRandomNumberSource=e}getPeriodBeforeNextEvent(){const t=this.pseudoRandomNumberSource();return-Math.log(t)/this.rate}}),m.register("EventTimer",fi),m.register("extend",xi);const wi=xi;function vi(t){return _.each(Array.prototype.slice.call(arguments,1),e=>{if(e)for(const i in e){const s=Object.getOwnPropertyDescriptor(e,i);!s||"function"!=typeof s.get&&void 0===e[i]||Object.defineProperty(t,i,s)}}),t}m.register("extendDefined",vi);function Ei(t,e){const i=[],s=2*t.length-1;for(let r=0;r<s;r++)r%2==0?i.push(t[r/2]):i.push(e((r-1)/2));return i}m.register("interleave",Ei);function Mi(t){return"[object Array]"===Object.prototype.toString.call(t)}m.register("isArray",Mi);const Ti=Mi;function bi(t){"string"==typeof t&&(t={src:t});const e=t.src,i=t.callback,s=void 0===t.async||t.async,r=void 0!==t.cacheBust&&t.cacheBust;let n=!1;const h=document.createElement("script");h.type="text/javascript",h.async=s,h.onload=h.onreadystatechange=function(){const t=this.readyState;t&&"complete"!==t&&"loaded"!==t||n||(n=!0,i&&i())},h.src=e+(r?"?random="+Math.random().toFixed(10):"");const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(h,a)}m.register("loadScript",bi);function Ii(t){const e=new Map;return i=>{if(e.has(i))return e.get(i);{const s=t(i);return e.set(i,s),s}}}m.register("memoize",Ii);function Pi(t,e,i){i&&_.each(e,e=>{void 0!==i[e]&&(t[e]=i[e])})}m.register("mutate",Pi);class Oi extends q{static fromLayoutOrientation(t){return"horizontal"===t?Oi.HORIZONTAL:Oi.VERTICAL}constructor(t,e,i,s,r,n,h,a,o,m,l,u,d,c,p,g,y,f,x){super(),this.coordinate=t,this.centerCoordinate=e,this.minCoordinate=i,this.maxCoordinate=s,this.minSide=r,this.maxSide=n,this.minSize=h,this.maxSize=a,this.rectCoordinate=o,this.rectSize=m,this.flowBoxOrientation=l,this.size=u,this.line=d,this.preferredSize=c,this.localPreferredSize=p,this.sizable=g,this.ariaOrientation=l,this.modelToView=y,this.viewToModel=f,this.toVector=x}}_defineProperty(Oi,"HORIZONTAL",new Oi("x","centerX","minX","maxX","left","right","minWidth","maxWidth","rectX","rectWidth","horizontal","width","column","preferredWidth","localPreferredWidth","widthSizable",(t,e)=>t.modelToViewX(e),(t,e)=>t.viewToModelX(e),(t,e,i)=>new i(t,e,0,0))),_defineProperty(Oi,"VERTICAL",new Oi("y","centerY","minY","maxY","top","bottom","minHeight","maxHeight","rectY","rectHeight","vertical","height","row","preferredHeight","localPreferredHeight","heightSizable",(t,e)=>t.modelToViewY(e),(t,e)=>t.viewToModelY(e),(t,e,i)=>new i(e,t,0,0))),_defineProperty(Oi,"enumeration",new H(Oi,{phetioDocumentation:"Horizontal or vertical orientation"})),Oi.HORIZONTAL.opposite=Oi.VERTICAL,Oi.VERTICAL.opposite=Oi.HORIZONTAL,m.register("Orientation",Oi);const Vi=Oi;class Si extends gi{constructor(t,e){super(Vi,i=>i===Vi.HORIZONTAL?t:e)}get horizontal(){return this.get(Vi.HORIZONTAL)}set horizontal(t){this.set(Vi.HORIZONTAL,t)}get vertical(){return this.get(Vi.VERTICAL)}set vertical(t){this.set(Vi.VERTICAL,t)}static create(t){return new Si(t(Vi.HORIZONTAL),t(Vi.VERTICAL))}}m.register("OrientationPair",Si);function Ai(t){const e=[],i=t.length;if(i>1)for(let s=0;s<i-1;s++){const r=t[s];for(let n=s+1;n<i;n++)e.push([r,t[n]])}return e}m.register("pairs",Ai);function Ni(t,e){const i=[],s=[],r=t.length;for(let n=0;n<r;n++)e(t[n])?i.push(t[n]):s.push(t[n]);return[i,s]}m.register("partition",Ni);const Di=navigator.userAgent;function Yi(t){return Xi()===t}function _i(){return!!(window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters["phet-app"]||(Di.match(/(iPod|iPhone|iPad)/)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>=2)&&Di.match(/AppleWebKit/))}function Xi(){let t=-1,e=null;return"Microsoft Internet Explorer"===navigator.appName?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==e.exec(Di)&&(t=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==e.exec(Di)&&(t=parseFloat(RegExp.$1))),t}const zi={firefox:Di.toLowerCase().indexOf("firefox")>-1,mobileSafari:_i(),safari5:!!(Di.match(/Version\/5\./)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),safari6:!!(Di.match(/Version\/6\./)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),safari7:!!(Di.match(/Version\/7\./)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),safari10:!!(Di.match(/Version\/10\./)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),safari11:!!(Di.match(/Version\/11\./)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),safari9:!!(Di.match(/Version\/9\./)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),safari:_i()||!!(Di.match(/Version\//)&&Di.match(/Safari\//)&&Di.match(/AppleWebKit/)),ie:-1!==Xi(),ie9:Yi(9),ie10:Yi(10),ie11:Yi(11),android:Di.indexOf("Android")>0,edge:!!Di.match(/Edge\//),chromium:/chrom(e|ium)/.test(Di.toLowerCase())&&!Di.match(/Edge\//),mac:navigator.platform.includes("Mac")};m.register("platform",zi);const Fi={mixInto(t,e){const i=c()({defaultArguments:[],initialize:t.prototype.initialize,maxSize:100,initialSize:0,useDefaultConstruction:!1},e),s=[];let r=i.maxSize;const n=Function.prototype.bind.bind(t,t),h=n(...i.defaultArguments),a=i.initialize,o=i.useDefaultConstruction,m=t.prototype;for(wi(t,{pool:s,dirtyFromPool:()=>s.length?s.pop():new h,createFromPool(){let t;for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return s.length?(t=s.pop(),a.apply(t,i)):o?(t=new h,a.apply(t,i)):t=new(n(...i)),t},get poolSize(){return s.length},set maxPoolSize(t){r=t},get maxPoolSize(){return r}}),wi(m,{freeToPool(){s.length<r&&s.push(this)}});s.length<i.initialSize;)s.push(new h);return t}};m.register("Poolable",Fi);const Ri=Fi,Li=new Ge(0,0);class Ci{constructor(t,e,i,s){this.minX=t,this.minY=e,this.maxX=i,this.maxY=s}getWidth(){return this.maxX-this.minX}get width(){return this.getWidth()}getHeight(){return this.maxY-this.minY}get height(){return this.getHeight()}getX(){return this.minX}get x(){return this.getX()}getY(){return this.minY}get y(){return this.getY()}getMinX(){return this.minX}getMinY(){return this.minY}getMaxX(){return this.maxX}getMaxY(){return this.maxY}getLeft(){return this.minX}get left(){return this.minX}getTop(){return this.minY}get top(){return this.minY}getRight(){return this.maxX}get right(){return this.maxX}getBottom(){return this.maxY}get bottom(){return this.maxY}getCenterX(){return(this.maxX+this.minX)/2}get centerX(){return this.getCenterX()}getCenterY(){return(this.maxY+this.minY)/2}get centerY(){return this.getCenterY()}getLeftTop(){return new Ge(this.minX,this.minY)}get leftTop(){return this.getLeftTop()}getCenterTop(){return new Ge(this.getCenterX(),this.minY)}get centerTop(){return this.getCenterTop()}getRightTop(){return new Ge(this.maxX,this.minY)}get rightTop(){return this.getRightTop()}getLeftCenter(){return new Ge(this.minX,this.getCenterY())}get leftCenter(){return this.getLeftCenter()}getCenter(){return new Ge(this.getCenterX(),this.getCenterY())}get center(){return this.getCenter()}getRightCenter(){return new Ge(this.maxX,this.getCenterY())}get rightCenter(){return this.getRightCenter()}getLeftBottom(){return new Ge(this.minX,this.maxY)}get leftBottom(){return this.getLeftBottom()}getCenterBottom(){return new Ge(this.getCenterX(),this.maxY)}get centerBottom(){return this.getCenterBottom()}getRightBottom(){return new Ge(this.maxX,this.maxY)}get rightBottom(){return this.getRightBottom()}isEmpty(){return this.getWidth()<0||this.getHeight()<0}isFinite(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)}hasNonzeroArea(){return this.getWidth()>0&&this.getHeight()>0}isValid(){return!this.isEmpty()&&this.isFinite()}closestPointTo(t){if(this.containsCoordinates(t.x,t.y))return t;{const e=Math.max(Math.min(t.x,this.maxX),this.x),i=Math.max(Math.min(t.y,this.maxY),this.y);return new Ge(e,i)}}containsCoordinates(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}containsPoint(t){return this.containsCoordinates(t.x,t.y)}containsBounds(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY}intersectsBounds(t){const e=Math.max(this.minX,t.minX),i=Math.max(this.minY,t.minY),s=Math.min(this.maxX,t.maxX),r=Math.min(this.maxY,t.maxY);return s-e>=0&&r-i>=0}minimumDistanceToPointSquared(t){const e=t.x<this.minX?this.minX:t.x>this.maxX?this.maxX:null,i=t.y<this.minY?this.minY:t.y>this.maxY?this.maxY:null;let s;if(null===e&&null===i)return 0;if(null===e)return s=i-t.y,s*s;if(null===i)return s=e-t.x,s*s;{const s=e-t.x,r=i-t.y;return s*s+r*r}}maximumDistanceToPointSquared(t){let e=t.x>this.getCenterX()?this.minX:this.maxX,i=t.y>this.getCenterY()?this.minY:this.maxY;return e-=t.x,i-=t.y,e*e+i*i}toString(){return`[x:(${this.minX},${this.maxX}),y:(${this.minY},${this.maxY})]`}equals(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY}equalsEpsilon(t,e){e=void 0!==e?e:0;const i=this.isFinite(),s=t.isFinite();return i&&s?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e:i===s&&(this===t||(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY))}copy(t){return t?t.set(this):Zi(this.minX,this.minY,this.maxX,this.maxY)}union(t){return Zi(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))}intersection(t){return Zi(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))}withCoordinates(t,e){return Zi(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))}withPoint(t){return this.withCoordinates(t.x,t.y)}withX(t){return this.copy().addX(t)}withY(t){return this.copy().addY(t)}withMinX(t){return Zi(t,this.minY,this.maxX,this.maxY)}withMinY(t){return Zi(this.minX,t,this.maxX,this.maxY)}withMaxX(t){return Zi(this.minX,this.minY,t,this.maxY)}withMaxY(t){return Zi(this.minX,this.minY,this.maxX,t)}roundedOut(){return Zi(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))}roundedIn(){return Zi(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))}transformed(t){return this.copy().transform(t)}dilated(t){return this.dilatedXY(t,t)}dilatedX(t){return Zi(this.minX-t,this.minY,this.maxX+t,this.maxY)}dilatedY(t){return Zi(this.minX,this.minY-t,this.maxX,this.maxY+t)}dilatedXY(t,e){return Zi(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)}eroded(t){return this.dilated(-t)}erodedX(t){return this.dilatedX(-t)}erodedY(t){return this.dilatedY(-t)}erodedXY(t,e){return this.dilatedXY(-t,-e)}withOffsets(t,e,i,s){return Zi(this.minX-t,this.minY-e,this.maxX+i,this.maxY+s)}shiftedX(t){return Zi(this.minX+t,this.minY,this.maxX+t,this.maxY)}shiftedY(t){return Zi(this.minX,this.minY+t,this.maxX,this.maxY+t)}shiftedXY(t,e){return Zi(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)}shifted(t){return this.shiftedXY(t.x,t.y)}blend(t,e){const i=1-e;return Zi(i*this.minX+e*t.minX,i*this.minY+e*t.minY,i*this.maxX+e*t.maxX,i*this.maxY+e*t.maxY)}setMinMax(t,e,i,s){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=s,this}setMinX(t){return this.minX=t,this}setMinY(t){return this.minY=t,this}setMaxX(t){return this.maxX=t,this}setMaxY(t){return this.maxY=t,this}set(t){return this.setMinMax(t.minX,t.minY,t.maxX,t.maxY)}includeBounds(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))}constrainBounds(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))}addCoordinates(t,e){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))}addPoint(t){return this.addCoordinates(t.x,t.y)}addX(t){return this.minX=Math.min(t,this.minX),this.maxX=Math.max(t,this.maxX),this}addY(t){return this.minY=Math.min(t,this.minY),this.maxY=Math.max(t,this.maxY),this}roundOut(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))}roundIn(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))}transform(t){if(this.isEmpty())return this;if(t.isIdentity())return this;const e=this.minX,i=this.minY,s=this.maxX,r=this.maxY;return this.set(Ci.NOTHING),this.addPoint(t.multiplyVector2(Li.setXY(e,i))),this.addPoint(t.multiplyVector2(Li.setXY(e,r))),this.addPoint(t.multiplyVector2(Li.setXY(s,i))),this.addPoint(t.multiplyVector2(Li.setXY(s,r))),this}dilate(t){return this.dilateXY(t,t)}dilateX(t){return this.setMinMax(this.minX-t,this.minY,this.maxX+t,this.maxY)}dilateY(t){return this.setMinMax(this.minX,this.minY-t,this.maxX,this.maxY+t)}dilateXY(t,e){return this.setMinMax(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)}erode(t){return this.dilate(-t)}erodeX(t){return this.dilateX(-t)}erodeY(t){return this.dilateY(-t)}erodeXY(t,e){return this.dilateXY(-t,-e)}offset(t,e,i,s){return Zi(this.minX-t,this.minY-e,this.maxX+i,this.maxY+s)}shiftX(t){return this.setMinMax(this.minX+t,this.minY,this.maxX+t,this.maxY)}shiftY(t){return this.setMinMax(this.minX,this.minY+t,this.maxX,this.maxY+t)}shiftXY(t,e){return this.setMinMax(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)}shift(t){return this.shiftXY(t.x,t.y)}getXRange(){return new xe(this.minX,this.maxX)}setXRange(t){return this.setMinMax(t.min,this.minY,t.max,this.maxY)}get xRange(){return this.getXRange()}set xRange(t){this.setXRange(t)}getYRange(){return new xe(this.minY,this.maxY)}setYRange(t){return this.setMinMax(this.minX,t.min,this.maxX,t.max)}get yRange(){return this.getYRange()}set yRange(t){this.setYRange(t)}getClosestPoint(t,e,i){return i?i.setXY(t,e):i=new Ge(t,e),i.x<this.minX&&(i.x=this.minX),i.x>this.maxX&&(i.x=this.maxX),i.y<this.minY&&(i.y=this.minY),i.y>this.maxY&&(i.y=this.maxY),i}freeToPool(){Ci.pool.freeToPool(this)}static rect(t,e,i,s){return Zi(t,e,t+i,e+s)}static oriented(t,e,i,s,r){return t===Vi.HORIZONTAL?new Ci(e,i,s,r):new Ci(i,e,r,s)}static point(t,e){if(t instanceof Ge){const e=t;return Zi(e.x,e.y,e.x,e.y)}return Zi(t,e,t,e)}}_defineProperty(Ci,"pool",new Ce(Ci,{initialize:Ci.prototype.setMinMax,defaultArguments:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]})),_defineProperty(Ci,"NOTHING",new Ci(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)),_defineProperty(Ci,"EVERYTHING",new Ci(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)),_defineProperty(Ci,"Bounds2IO",new X("Bounds2IO",{valueType:Ci,documentation:"a 2-dimensional bounds rectangle",toStateObject:t=>({minX:t.minX,minY:t.minY,maxX:t.maxX,maxY:t.maxY}),fromStateObject:t=>new Ci(pe.fromStateObject(t.minX),pe.fromStateObject(t.minY),pe.fromStateObject(t.maxX),pe.fromStateObject(t.maxY)),stateSchema:{minX:pe,maxX:pe,minY:pe,maxY:pe}})),ye.register("Bounds2",Ci);const Zi=Ci.pool.create.bind(Ci.pool);ye.register("b2",Zi),Ci.prototype.isBounds=!0,Ci.prototype.dimension=2;class ji{constructor(t){this.rootBin=new qi(t,null)}allocate(t,e){const i=this.rootBin.findAvailableBin(t,e);if(i){const s=i.split(t,e);return s.use(),s}return null}deallocate(t){t.unuse()}toString(){let t="",e="";return function i(s){t+=e+s.toString()+"\n",e+="  ",_.each(s.children,i),e=e.substring(2)}(this.rootBin),t}}ye.register("BinPacker",ji);class qi{constructor(t,e){this.bounds=t,this.parent=e,this.isSplit=!1,this.isUsed=!1,this.children=[]}findAvailableBin(t,e){if(this.isUsed)return null;if(this.bounds.width<t||this.bounds.height<e)return null;if(this.isSplit){for(let i=0;i<this.children.length;i++){const s=this.children[i].findAvailableBin(t,e);if(s)return s}return null}return this}split(t,e){if(t===this.bounds.width&&e===this.bounds.height)return this;this.isSplit=!0;const i=this.bounds.minX+t,s=this.bounds.minY+e,r=new Ci(this.bounds.minX,this.bounds.minY,i,s),n=new Ci(i,this.bounds.minY,this.bounds.maxX,s),h=new Ci(this.bounds.minX,s,this.bounds.maxX,this.bounds.maxY),a=new qi(r,this);return this.children.push(a),n.hasNonzeroArea()&&this.children.push(new qi(n,this)),h.hasNonzeroArea()&&this.children.push(new qi(h,this)),a}use(){this.isUsed=!0}unuse(){this.isUsed=!1,this.parent&&this.parent.attemptToCollapse()}attemptToCollapse(){for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isSplit||e.isUsed)return}this.children=[],this.isSplit=!1,this.parent&&this.parent.attemptToCollapse()}toString(){return this.bounds.toString()+(this.isUsed?" used":"")}}ji.Bin=qi;class ki{constructor(t,e,i,s,r,n){this.minX=t,this.minY=e,this.minZ=i,this.maxX=s,this.maxY=r,this.maxZ=n}getWidth(){return this.maxX-this.minX}get width(){return this.getWidth()}getHeight(){return this.maxY-this.minY}get height(){return this.getHeight()}getDepth(){return this.maxZ-this.minZ}get depth(){return this.getDepth()}getX(){return this.minX}get x(){return this.getX()}getY(){return this.minY}get y(){return this.getY()}getZ(){return this.minZ}get z(){return this.getZ()}getMinX(){return this.minX}getMinY(){return this.minY}getMinZ(){return this.minZ}getMaxX(){return this.maxX}getMaxY(){return this.maxY}getMaxZ(){return this.maxZ}getLeft(){return this.minX}get left(){return this.minX}getTop(){return this.minY}get top(){return this.minY}getBack(){return this.minZ}get back(){return this.minZ}getRight(){return this.maxX}get right(){return this.maxX}getBottom(){return this.maxY}get bottom(){return this.maxY}getFront(){return this.maxZ}get front(){return this.maxZ}getCenterX(){return(this.maxX+this.minX)/2}get centerX(){return this.getCenterX()}getCenterY(){return(this.maxY+this.minY)/2}get centerY(){return this.getCenterY()}getCenterZ(){return(this.maxZ+this.minZ)/2}get centerZ(){return this.getCenterZ()}getCenter(){return new Be(this.getCenterX(),this.getCenterY(),this.getCenterZ())}get center(){return this.getCenter()}isEmpty(){return this.getWidth()<0||this.getHeight()<0||this.getDepth()<0}isFinite(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)}hasNonzeroArea(){return this.getWidth()>0&&this.getHeight()>0&&this.getDepth()>0}isValid(){return!this.isEmpty()&&this.isFinite()}containsCoordinates(t,e,i){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY&&this.minZ<=i&&i<=this.maxZ}containsPoint(t){return this.containsCoordinates(t.x,t.y,t.z)}containsBounds(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY&&this.minZ<=t.minZ&&this.maxZ>=t.maxZ}intersectsBounds(t){return!this.intersection(t).isEmpty()}toString(){return`[x:(${this.minX},${this.maxX}),y:(${this.minY},${this.maxY}),z:(${this.minZ},${this.maxZ})]`}equals(t){return this.minX===t.minX&&this.minY===t.minY&&this.minZ===t.minZ&&this.maxX===t.maxX&&this.maxY===t.maxY&&this.maxZ===t.maxZ}equalsEpsilon(t,e){e=void 0!==e?e:0;const i=this.isFinite(),s=t.isFinite();return i&&s?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.minZ-t.minZ)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e&&Math.abs(this.maxZ-t.maxZ)<e:i===s&&(this===t||(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.minZ+t.minZ)?Math.abs(this.minZ-t.minZ)<e:this.minZ===t.minZ)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY)&&(isFinite(this.maxZ+t.maxZ)?Math.abs(this.maxZ-t.maxZ)<e:this.maxZ===t.maxZ))}copy(t){return t?t.set(this):new ki(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}union(t){return new ki(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))}intersection(t){return new ki(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))}withCoordinates(t,e,i){return new ki(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,i),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,i))}withPoint(t){return this.withCoordinates(t.x,t.y,t.z)}withMinX(t){return new ki(t,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}withMinY(t){return new ki(this.minX,t,this.minZ,this.maxX,this.maxY,this.maxZ)}withMinZ(t){return new ki(this.minX,this.minY,t,this.maxX,this.maxY,this.maxZ)}withMaxX(t){return new ki(this.minX,this.minY,this.minZ,t,this.maxY,this.maxZ)}withMaxY(t){return new ki(this.minX,this.minY,this.minZ,this.maxX,t,this.maxZ)}withMaxZ(t){return new ki(this.minX,this.minY,this.minZ,this.maxX,this.maxY,t)}roundedOut(){return new ki(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))}roundedIn(){return new ki(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))}transformed(t){return this.copy().transform(t)}dilated(t){return this.dilatedXYZ(t,t,t)}dilatedX(t){return new ki(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}dilatedY(t){return new ki(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}dilatedZ(t){return new ki(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)}dilatedXYZ(t,e,i){return new ki(this.minX-t,this.minY-e,this.minZ-i,this.maxX+t,this.maxY+e,this.maxZ+i)}eroded(t){return this.dilated(-t)}erodedX(t){return this.dilatedX(-t)}erodedY(t){return this.dilatedY(-t)}erodedZ(t){return this.dilatedZ(-t)}erodedXYZ(t,e,i){return this.dilatedXYZ(-t,-e,-i)}shiftedX(t){return new ki(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}shiftedY(t){return new ki(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}shiftedZ(t){return new ki(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)}shiftedXYZ(t,e,i){return new ki(this.minX+t,this.minY+e,this.minZ+i,this.maxX+t,this.maxY+e,this.maxZ+i)}shifted(t){return this.shiftedXYZ(t.x,t.y,t.z)}setMinMax(t,e,i,s,r,n){return this.minX=t,this.minY=e,this.minZ=i,this.maxX=s,this.maxY=r,this.maxZ=n,this}setMinX(t){return this.minX=t,this}setMinY(t){return this.minY=t,this}setMinZ(t){return this.minZ=t,this}setMaxX(t){return this.maxX=t,this}setMaxY(t){return this.maxY=t,this}setMaxZ(t){return this.maxZ=t,this}set(t){return this.setMinMax(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)}includeBounds(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))}constrainBounds(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))}addCoordinates(t,e,i){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,i),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,i))}addPoint(t){return this.addCoordinates(t.x,t.y,t.z)}roundOut(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))}roundIn(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))}transform(t){if(this.isEmpty())return this;if(t.isIdentity())return this;let e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;const a=new Be(0,0,0);function o(t){e=Math.min(e,t.x),i=Math.min(i,t.y),s=Math.min(s,t.z),r=Math.max(r,t.x),n=Math.max(n,t.y),h=Math.max(h,t.z)}return o(t.multiplyVector3(a.setXYZ(this.minX,this.minY,this.minZ))),o(t.multiplyVector3(a.setXYZ(this.minX,this.maxY,this.minZ))),o(t.multiplyVector3(a.setXYZ(this.maxX,this.minY,this.minZ))),o(t.multiplyVector3(a.setXYZ(this.maxX,this.maxY,this.minZ))),o(t.multiplyVector3(a.setXYZ(this.minX,this.minY,this.maxZ))),o(t.multiplyVector3(a.setXYZ(this.minX,this.maxY,this.maxZ))),o(t.multiplyVector3(a.setXYZ(this.maxX,this.minY,this.maxZ))),o(t.multiplyVector3(a.setXYZ(this.maxX,this.maxY,this.maxZ))),this.setMinMax(e,i,s,r,n,h)}dilate(t){return this.dilateXYZ(t,t,t)}dilateX(t){return this.setMinMax(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}dilateY(t){return this.setMinMax(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}dilateZ(t){return this.setMinMax(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)}dilateXYZ(t,e,i){return this.setMinMax(this.minX-t,this.minY-e,this.minZ-i,this.maxX+t,this.maxY+e,this.maxZ+i)}erode(t){return this.dilate(-t)}erodeX(t){return this.dilateX(-t)}erodeY(t){return this.dilateY(-t)}erodeZ(t){return this.dilateZ(-t)}erodeXYZ(t,e,i){return this.dilateXYZ(-t,-e,-i)}shiftX(t){return this.setMinMax(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}shiftY(t){return this.setMinMax(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}shiftZ(t){return this.setMinMax(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)}shiftXYZ(t,e,i){return this.setMinMax(this.minX+t,this.minY+e,this.minZ+i,this.maxX+t,this.maxY+e,this.maxZ+i)}shift(t){return this.shiftXYZ(t.x,t.y,t.z)}static cuboid(t,e,i,s,r,n){return new ki(t,e,i,t+s,e+r,i+n)}static point(t,e,i){return new ki(t,e,i,t,e,i)}}ki.prototype.isBounds=!0,ki.prototype.dimension=3,ye.register("Bounds3",ki),Ri.mixInto(ki,{initialize:ki.prototype.setMinMax}),ki.NOTHING=new ki(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),ki.EVERYTHING=new ki(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ki.Bounds3IO=new X("Bounds3IO",{valueType:ki,documentation:"a 3-dimensional bounds (bounding box)",stateSchema:{minX:ve,minY:ve,minZ:ve,maxX:ve,maxY:ve,maxZ:ve},toStateObject:t=>({minX:t.minX,minY:t.minY,minZ:t.minZ,maxX:t.maxX,maxY:t.maxY,maxZ:t.maxZ}),fromStateObject:t=>new ki(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)});class Bi{constructor(t){this.inclusions=t}size(){return this.inclusions.length}includes(t){return this.inclusions[t]}apply(t){return t.filter((t,e)=>this.inclusions[e])}inverted(){return new Bi(this.inclusions.map(t=>!t))}getIncludedIndices(){return _.range(0,this.size()).filter(t=>this.inclusions[t])}toString(){return`C[${this.inclusions.map(t=>t?"1":"0").join("")}]`}equals(t){return this.inclusions.length===t.inclusions.length&&_.isEqual(this.inclusions,t.inclusions)}static empty(t){return new Bi(_.range(0,t).map(()=>!1))}static full(t){return new Bi(_.range(0,t).map(()=>!0))}static combinations(t){const e=[],i=[];return function s(r){r===t?e.push(new Bi(i.slice())):(i.push(!1),s(r+1),i.pop(),i.push(!0),s(r+1),i.pop())}(0),e}static forEachCombination(t,e){const i=[];!function s(r){r===t.length?e(i):(s(r+1),i.push(t[r]),s(r+1),i.pop())}(0)}static combinationsOf(t){const e=[];return Bi.forEachCombination(t,t=>{e.push(t.slice())}),e}}ye.register("Combination",Bi);class $i{constructor(t){this.points=t.slice();for(let e=0;e<this.points.length-2;e++){const t=this.points[e],i=this.points[e+1],s=this.points[e+2];ri.arePointsCollinear(t,i,s)&&(this.points.splice(e+1,1),e--)}}findMatchingPair(t){let e=0;for(;e<this.points.length-2&&this.points[e+1].x<t;)e++;return[this.points[e],this.points[e+1]]}evaluate(t){if(1===this.points.length)return this.points[0].y;{const[e,i]=this.findMatchingPair(t);return e.x===t?e.y:i.x===t?i.y:ri.linear(e.x,i.x,e.y,i.y,t)}}getCombinedXValues(t){return $i.sortedUniqueEpsilon(this.points.map(t=>t.x).concat(t.points.map(t=>t.x)))}getIntersectedXValues(t){const e=this.getCombinedXValues(t),i=[];for(let r=0;r<e.length-1;r++){const s=e[r],n=e[r+1],h=ri.lineLineIntersection(new Ge(s,this.evaluate(s)),new Ge(n,this.evaluate(n)),new Ge(s,t.evaluate(s)),new Ge(n,t.evaluate(n)));h&&(0===r||h.x>s)&&(r===e.length-2||h.x<n)&&i.push(h.x)}const s=$i.sortedUniqueEpsilon([...e,...i]);return[s[0]-1,...s,s[s.length-1]+1]}binaryXOperation(t,e,i){return new $i(i.map(i=>new Ge(i,e(this.evaluate(i),t.evaluate(i)))))}binaryPointwiseOperation(t,e){return this.binaryXOperation(t,e,this.getCombinedXValues(t))}binaryIntersectingOperation(t,e){return this.binaryXOperation(t,e,this.getIntersectedXValues(t))}plus(t){return this.binaryPointwiseOperation(t,(t,e)=>t+e)}minus(t){return this.binaryPointwiseOperation(t,(t,e)=>t-e)}min(t){return this.binaryIntersectingOperation(t,Math.min)}max(t){return this.binaryIntersectingOperation(t,Math.max)}withXValues(t){return new $i(t.map(t=>new Ge(t,this.evaluate(t))))}inverted(){const t=this.points.map(t=>new Ge(t.y,t.x));return t.length>1&&t[0].x>t[1].x&&t.reverse(),new $i(t)}static sum(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce((t,e)=>t.plus(e))}static min(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce((t,e)=>t.min(e))}static max(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce((t,e)=>t.max(e))}static constant(t){return new $i([new Ge(0,t)])}static linear(t,e){return new $i([new Ge(0,e),new Ge(1,t+e)])}static sortedUniqueEpsilon(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-10;t=_.sortBy(t);for(let i=0;i<t.length-1;i++)Math.abs(t[i]-t[i+1])<e&&(t.splice(i,1),i--);return t}}ye.register("CompletePiecewiseLinearFunction",$i);class Hi{constructor(t,e){this.real=t,this.imaginary=e}copy(t){return t?t.set(this):new Hi(this.real,this.imaginary)}phase(){return Math.atan2(this.imaginary,this.real)}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.real*this.real+this.imaginary*this.imaginary}get magnitudeSquared(){return this.getMagnitudeSquared()}equals(t){return this.real===t.real&&this.imaginary===t.imaginary}equalsEpsilon(t,e){return e||(e=0),Math.max(Math.abs(this.real-t.real),Math.abs(this.imaginary-t.imaginary))<=e}plus(t){return new Hi(this.real+t.real,this.imaginary+t.imaginary)}minus(t){return new Hi(this.real-t.real,this.imaginary-t.imaginary)}times(t){return new Hi(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)}dividedBy(t){const e=t.magnitudeSquared;return new Hi((this.real*t.real+this.imaginary*t.imaginary)/e,(this.imaginary*t.real-this.real*t.imaginary)/e)}sqrtOf(){const t=this.magnitude;return new Hi(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))}powerByReal(t){const e=Math.pow(this.magnitude,t),i=t*this.phase();return new Hi(e*Math.cos(i),e*Math.sin(i))}sinOf(){return new Hi(Math.sin(this.real)*ri.cosh(this.imaginary),Math.cos(this.real)*ri.sinh(this.imaginary))}cosOf(){return new Hi(Math.cos(this.real)*ri.cosh(this.imaginary),-Math.sin(this.real)*ri.sinh(this.imaginary))}squared(){return this.times(this)}conjugated(){return new Hi(this.real,-this.imaginary)}exponentiated(){return Hi.createPolar(Math.exp(this.real),this.imaginary)}setRealImaginary(t,e){return this.real=t,this.imaginary=e,this}setReal(t){return this.real=t,this}setImaginary(t){return this.imaginary=t,this}set(t){return this.setRealImaginary(t.real,t.imaginary)}setPolar(t,e){return this.setRealImaginary(t*Math.cos(e),t*Math.sin(e))}add(t){return this.setRealImaginary(this.real+t.real,this.imaginary+t.imaginary)}subtract(t){return this.setRealImaginary(this.real-t.real,this.imaginary-t.imaginary)}multiply(t){return this.setRealImaginary(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)}divide(t){const e=t.magnitudeSquared;return this.setRealImaginary((this.real*t.real+this.imaginary*t.imaginary)/e,(this.imaginary*t.real-this.real*t.imaginary)/e)}exponentiate(){return this.setPolar(Math.exp(this.real),this.imaginary)}square(){return this.multiply(this)}sqrt(){const t=this.magnitude;return this.setRealImaginary(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))}sin(){return this.setRealImaginary(Math.sin(this.real)*ri.cosh(this.imaginary),Math.cos(this.real)*ri.sinh(this.imaginary))}cos(){return this.setRealImaginary(Math.cos(this.real)*ri.cosh(this.imaginary),-Math.sin(this.real)*ri.sinh(this.imaginary))}conjugate(){return this.setRealImaginary(this.real,-this.imaginary)}toString(){return`Complex(${this.real}, ${this.imaginary})`}static real(t){return new Hi(t,0)}static imaginary(t){return new Hi(0,t)}static createPolar(t,e){return new Hi(t*Math.cos(e),t*Math.sin(e))}}ye.register("Complex",Hi),Hi.ZERO=new Hi(0,0),Hi.ONE=new Hi(1,0),Hi.I=Hi.imaginary(1);const Ui={grahamScan:(t,e)=>{if(t.length<=2)return t;let i=Number.POSITIVE_INFINITY,s=null;_.each(t,t=>{t.y<=i&&(t.y===i&&s?t.x<s.x&&(s=t):(i=t.y,s=t))}),(t=_.sortBy(t,t=>t.minus(s).angle)).splice(_.indexOf(t,s),1);const r=[s];return _.each(t,t=>{if(s.x!==t.x||s.y!==t.y){for(;i();)r.pop();r.push(t)}function i(){if(r.length<2)return!1;const i=(s=r[r.length-2],n=r[r.length-1],h=t,n.minus(s).crossScalar(h.minus(s)));var s,n,h;return e?i<0:i<=0}}),r}};ye.register("ConvexHull2",Ui);class Gi extends q{}_defineProperty(Gi,"OVER_DAMPED",new Gi),_defineProperty(Gi,"UNDER_DAMPED",new Gi),_defineProperty(Gi,"CRITICALLY_DAMPED",new Gi),_defineProperty(Gi,"UNKNOWN",new Gi),_defineProperty(Gi,"enumeration",new H(Gi));class Wi{constructor(t,e,i,s,r){this.dampingConstant=e/t,this.angularFrequencySquared=i/t,this.discriminant=this.dampingConstant*this.dampingConstant-4*this.angularFrequencySquared,this.solutionType=Gi.UNKNOWN,this.c1=0,this.c2=0,Math.abs(this.discriminant)<1e-5?(this.solutionType=Gi.CRITICALLY_DAMPED,this.angularFrequency=Math.sqrt(this.angularFrequencySquared),this.c1=s,this.c2=r+this.angularFrequency*s):this.discriminant<0?(this.solutionType=Gi.UNDER_DAMPED,this.frequency=.5*Math.sqrt(-this.discriminant),this.c1=s,this.c2=this.dampingConstant*s/(2*this.frequency)+r/this.frequency):(this.solutionType=Gi.OVER_DAMPED,this.positiveRoot=.5*(-this.dampingConstant+Math.sqrt(this.discriminant)),this.negativeRoot=.5*(-this.dampingConstant-Math.sqrt(this.discriminant)),this.c2=(this.negativeRoot*s-r)/(this.negativeRoot-this.positiveRoot),this.c1=s-this.c2)}getValue(t){if(this.solutionType===Gi.CRITICALLY_DAMPED)return(this.c1+this.c2*t)*Math.exp(-this.angularFrequency*t);if(this.solutionType===Gi.UNDER_DAMPED){const e=this.frequency*t;return Math.exp(-this.dampingConstant/2*t)*(this.c1*Math.cos(e)+this.c2*Math.sin(e))}if(this.solutionType===Gi.OVER_DAMPED)return this.c1*Math.exp(this.negativeRoot*t)+this.c2*Math.exp(this.positiveRoot*t);throw new Error("Unknown solution type?")}getDerivative(t){if(this.solutionType===Gi.CRITICALLY_DAMPED)return Math.exp(-this.angularFrequency*t)*(this.c2-this.angularFrequency*(this.c1+this.c2*t));if(this.solutionType===Gi.UNDER_DAMPED){const e=this.frequency*t,i=Math.cos(e),s=Math.sin(e),r=this.frequency*(this.c2*i-this.c1*s),n=.5*this.dampingConstant*(this.c1*i+this.c2*s);return Math.exp(-.5*this.dampingConstant*t)*(r-n)}if(this.solutionType===Gi.OVER_DAMPED)return this.c1*this.negativeRoot*Math.exp(this.negativeRoot*t)+this.c2*this.positiveRoot*Math.exp(this.positiveRoot*t);throw new Error("Unknown solution type?")}}ye.register("DampedHarmonic",Wi);class Ki{constructor(t,e,i){let s;if(i=u({},i),this.points=t,this.constraints=e,this.triangles=[],this.edges=[],this.convexHull=[],0===t.length)return;for(this.vertices=t.map((t,e)=>new Qi(t,e)),s=0;s<this.constraints.length;s++){const t=this.constraints[s],e=t[0],i=t[1];this.vertices[e].constrainedVertices.push(this.vertices[i])}for(this.vertices.sort(Ki.vertexComparison),s=0;s<this.vertices.length;s++){const t=this.vertices[s];t.sortedIndex=s;for(let e=t.constrainedVertices.length-1;e>=0;e--){const i=t.constrainedVertices[e];-1===i.sortedIndex&&(i.constrainedVertices.push(t),t.constrainedVertices.splice(e,1))}}this.bottomVertex=this.vertices[0],this.remainingVertices=this.vertices.slice(1);const r=Ci.NOTHING.copy();for(s=t.length-1;s>=0;s--)r.addPoint(t[s]);this.artificialMinVertex=new Qi(new Ge(r.minX-.4*r.width,r.minY-.4*r.height),-1),this.artificialMaxVertex=new Qi(new Ge(r.maxX+.4*r.width,r.minY-.4*r.height),-2),this.edges.push(new Ji(this.artificialMinVertex,this.artificialMaxVertex)),this.edges.push(new Ji(this.artificialMaxVertex,this.bottomVertex)),this.edges.push(new Ji(this.bottomVertex,this.artificialMinVertex)),this.triangles.push(new ts(this.artificialMinVertex,this.artificialMaxVertex,this.bottomVertex,this.edges[1],this.edges[2],this.edges[0])),this.firstFrontEdge=this.edges[1],this.edges[1].connectAfter(this.edges[2]),this.firstHullEdge=this.edges[0]}step(){const t=this.remainingVertices.shift(),e=t.point.x;let i=this.firstFrontEdge;for(;i;){if(e>i.endVertex.point.x){const e=new Ji(i.startVertex,t),s=new Ji(t,i.endVertex);e.connectAfter(s),this.edges.push(e),this.edges.push(s),this.triangles.push(new ts(i.endVertex,i.startVertex,t,e,s,i)),this.reconnectFrontEdges(i,i,e,s),this.legalizeEdge(i),this.addHalfPiHeuristic(e,s),this.constrainEdges(t,e,s);break}if(e===i.endVertex.point.x){const e=i.nextEdge,s=i,r=i.endVertex,n=e.endVertex,h=s.startVertex,a=new Ji(t,n),o=new Ji(h,t),m=new Ji(r,t);o.connectAfter(a),this.edges.push(a),this.edges.push(o),this.edges.push(m),this.triangles.push(new ts(n,r,t,m,a,e)),this.triangles.push(new ts(r,h,t,o,m,s)),this.reconnectFrontEdges(s,e,o,a),this.legalizeEdge(e),this.legalizeEdge(s),this.legalizeEdge(m),this.addHalfPiHeuristic(o,a),this.constrainEdges(t,o,a);break}i=i.nextEdge}}fillBorderTriangle(t,e,i,s,r){const n=new Ji(i,r);return this.edges.push(n),this.triangles.push(new ts(r,s,i,t,n,e)),this.legalizeEdge(t),this.legalizeEdge(e),n}reconnectFrontEdges(t,e,i,s){const r=t.previousEdge,n=e.nextEdge;r?(r.disconnectAfter(),r.connectAfter(i)):this.firstFrontEdge=i,n&&(e.disconnectAfter(),s.connectAfter(n))}addHalfPiHeuristic(t,e){const i=t.endVertex;for(;t.previousEdge&&ri.triangleAreaSigned(i.point,t.startVertex.point,t.previousEdge.startVertex.point)>0&&i.point.minus(t.startVertex.point).angleBetween(t.previousEdge.startVertex.point.minus(t.startVertex.point))<Math.PI/2;){const e=t.previousEdge,s=new Ji(e.startVertex,i);this.edges.push(s),this.triangles.push(new ts(i,t.startVertex,e.startVertex,e,s,t)),this.reconnectFrontEdges(e,t,s,s),this.legalizeEdge(e),this.legalizeEdge(t),t=s}for(;e.nextEdge&&ri.triangleAreaSigned(i.point,e.nextEdge.endVertex.point,e.endVertex.point)>0&&i.point.minus(e.endVertex.point).angleBetween(e.nextEdge.endVertex.point.minus(e.endVertex.point))<Math.PI/2;){const t=e.nextEdge,s=new Ji(i,t.endVertex);this.edges.push(s),this.triangles.push(new ts(i,e.nextEdge.endVertex,e.endVertex,t,e,s)),this.reconnectFrontEdges(e,t,s,s),this.legalizeEdge(t),this.legalizeEdge(e),e=s}}constrainEdges(t,e,i){for(let s=0;s<t.constrainedVertices.length;s++){const r=t.constrainedVertices[s];if(r===e.startVertex||r===i.endVertex)break;const n=[],h=[];let a=null,o=null;const m=[],l=[];let u=Ki.vertexProduct(t,e.startVertex,r)>0,d=Ki.vertexProduct(t,i.endVertex,r)<0;if(!u&&!d){let i,s=e.startVertex;for(a=e.triangles[0];Ki.vertexProduct(t,i=a.getEdgeOppositeFromVertex(t).getOtherVertex(s),r)<0;)a=a.getEdgeOppositeFromVertex(s).getOtherTriangle(a),s=i;if(a.hasVertex(r))break;m.push(a),o=a.getEdgeOppositeFromVertex(t),l.push(o),n.push(a.getEdgeOppositeFromVertex(s)),h.push(a.getEdgeOppositeFromVertex(o.getOtherVertex(s)))}for(;!u&&!d;)if(o.triangles.length>1){const e=o.getOtherTriangle(a);if(e.hasVertex(r)){m.push(e),n.push(e.getNextEdge(o)),h.push(e.getPreviousEdge(o));break}{let i;e.aEdge!==o&&e.aEdge.intersectsConstrainedEdge(t,r)?i=e.aEdge:e.bEdge!==o&&e.bEdge.intersectsConstrainedEdge(t,r)?i=e.bEdge:e.cEdge!==o&&e.cEdge.intersectsConstrainedEdge(t,r)&&(i=e.cEdge),e.getNextEdge(i)===o?n.push(e.getPreviousEdge(i)):h.push(e.getNextEdge(i)),o=i,l.push(o),a=e,m.push(a)}}else r.point.x<t.point.x?d=!0:u=!0;for(let t=0;t<m.length;t++){const e=m[t];Z(this.triangles,e),e.remove()}for(let t=0;t<l.length;t++)Z(this.edges,l[t]);const c=new Ji(r,t);c.isConstrained=!0,this.edges.push(c),n.push(c),h.push(c),h.reverse(),window.triDebug&&window.triDebug(this),this.triangulatePolygon(n),this.triangulatePolygon(h)}}triangulatePolygon(t){for(;t.length>3;){for(let e=0;e<t.length;e++){t.length}for(let e=0;e<t.length;e++){const i=e<t.length-1?e+1:0,s=t[e],r=t[i],n=s.getSharedVertex(r),h=s.getOtherVertex(n),a=r.getOtherVertex(n);if(ri.triangleAreaSigned(h.point,n.point,a.point)<=0)continue;const o=a.point.minus(n.point),m=h.point.minus(n.point),l=o.dot(o),u=o.dot(m),d=m.dot(m),c=l*d-u*u;let p=t[0].getSharedVertex(t[t.length-1]),g=!1;for(let e=0;e<t.length;e++){const i=t[e].getOtherVertex(p);if(i!==n&&i!==h&&i!==a){const t=i.point.minus(n.point),e=o.dot(t),s=m.dot(t),r=(d*e-u*s)/c,h=(l*s-u*e)/c;if(r>=-1e-10&&h>=-1e-10&&r+h<1+1e-10){g=!0;break}}p=i}if(!g){const o=new Ji(h,a);this.edges.push(o),this.triangles.push(new ts(h,n,a,r,o,s)),i>e?t.splice(e,2,o):(t.splice(e,1,o),t.splice(i,1)),window.triDebug&&window.triDebug(this)}}}3===t.length&&(this.triangles.push(new ts(t[0].getSharedVertex(t[1]),t[1].getSharedVertex(t[2]),t[0].getSharedVertex(t[2]),t[2],t[0],t[1])),window.triDebug&&window.triDebug(this))}finalize(){const t=[];let e=this.firstFrontEdge.nextEdge;for(;e&&e.nextEdge;)t.push(e),e=e.nextEdge;const i=this.firstFrontEdge,s=e;for(let a=0;a<t.length-1;a++){const e=t[a],i=t[a+1];if(ri.triangleAreaSigned(i.endVertex.point,e.endVertex.point,e.startVertex.point)>1e-10){const s=this.fillBorderTriangle(e,i,e.startVertex,e.endVertex,i.endVertex);t.splice(a,2,s),a=Math.max(a-2,-1),window.triDebug&&window.triDebug(this)}}this.firstFrontEdge=null;const r=[],n=[i];let h=i;for(;h!==s;){const t=h.triangles[0];t.remove(),Z(this.triangles,t);const e=t.getNonArtificialEdge();if(e){r.push(e);const i=e.getSharedVertex(h);h=t.getEdgeOppositeFromVertex(i)}else n.push(t.getEdgeOppositeFromVertex(h.endVertex)),h=t.getEdgeOppositeFromVertex(h.startVertex);n.push(h)}for(let a=0;a<n.length;a++)Z(this.edges,n[a]);window.triDebug&&window.triDebug(this);for(let a=0;a<r.length-1;a++){const t=r[a+1],e=r[a],i=t.getSharedVertex(e),s=t.getOtherVertex(i),n=e.getOtherVertex(i);if(ri.triangleAreaSigned(n.point,i.point,s.point)>1e-10){const h=this.fillBorderTriangle(t,e,s,i,n);r.splice(a,2,h),a=Math.max(a-2,-1),window.triDebug&&window.triDebug(this)}}for(let a=0;a<t.length;a++)this.convexHull.push(t[a].startVertex);this.convexHull.push(t[t.length-1].endVertex);for(let a=r.length-1;a>=1;a--)this.convexHull.push(r[a].getSharedVertex(r[a-1]))}legalizeEdge(t){if(!_.includes(this.edges,t)||2!==t.triangles.length||t.isConstrained)return;const e=t.triangles[0],i=t.triangles[1],s=e.getVertexOppositeFromEdge(t),r=i.getVertexOppositeFromEdge(t);if(ri.pointInCircleFromPoints(e.aVertex.point,e.bVertex.point,e.cVertex.point,r.point)||ri.pointInCircleFromPoints(i.aVertex.point,i.bVertex.point,i.cVertex.point,s.point)){e.remove(),i.remove(),Z(this.triangles,e),Z(this.triangles,i),Z(this.edges,t);const n=new Ji(s,r);this.edges.push(n);const h=i.getEdgeOppositeFromVertex(i.getVertexBefore(r)),a=e.getEdgeOppositeFromVertex(e.getVertexAfter(s)),o=e.getEdgeOppositeFromVertex(e.getVertexBefore(s)),m=i.getEdgeOppositeFromVertex(i.getVertexAfter(r));this.triangles.push(new ts(s,r,e.getVertexBefore(s),h,a,n)),this.triangles.push(new ts(r,s,i.getVertexBefore(r),o,m,n)),this.legalizeEdge(h),this.legalizeEdge(a),this.legalizeEdge(o),this.legalizeEdge(m)}}static vertexComparison(t,e){return t=t.point,e=e.point,t.y<e.y?-1:t.y>e.y?1:t.x<e.x?-1:t.x>e.x?1:0}static vertexProduct(t,e,i){const s=e.point.minus(t.point),r=i.point.minus(t.point);return s.crossScalar(r)}}ye.register("DelaunayTriangulation",Ki);class Qi{constructor(t,e){this.point=t,this.index=e,this.sortedIndex=-1,this.constrainedVertices=[]}isArtificial(){return this.index<0}}class Ji{constructor(t,e){this.startVertex=t,this.endVertex=e,this.triangles=[],this.nextEdge=null,this.previousEdge=null,this.isConstrained=!1}isArtificial(){return this.startVertex.isArtificial()||this.endVertex.isArtificial()}connectAfter(t){this.nextEdge=t,t.previousEdge=this}disconnectAfter(){this.nextEdge.previousEdge=null,this.nextEdge=null}addTriangle(t){this.triangles.push(t)}removeTriangle(t){Z(this.triangles,t)}getSharedTriangle(t){for(let e=0;e<this.triangles.length;e++){const i=this.triangles[e];for(let e=0;e<t.triangles.length;e++)if(t.triangles[e]===i)return i}throw new Error("No common triangle")}getSharedVertex(t){return this.startVertex===t.startVertex||this.startVertex===t.endVertex?this.startVertex:this.endVertex}getOtherVertex(t){return t===this.startVertex?this.endVertex:this.startVertex}getOtherTriangle(t){return this.triangles[0]===t?this.triangles[1]:this.triangles[0]}intersectsConstrainedEdge(t,e){return ri.lineSegmentIntersection(t.point.x,t.point.y,e.point.x,e.point.y,this.startVertex.point.x,this.startVertex.point.y,this.endVertex.point.x,this.endVertex.point.y)}}class ts{constructor(t,e,i,s,r,n){this.aVertex=t,this.bVertex=e,this.cVertex=i,this.aEdge=s,this.bEdge=r,this.cEdge=n,this.aEdge.addTriangle(this),this.bEdge.addTriangle(this),this.cEdge.addTriangle(this)}hasVertex(t){return this.aVertex===t||this.bVertex===t||this.cVertex===t}getVertexOppositeFromEdge(t){return t===this.aEdge?this.aVertex:t===this.bEdge?this.bVertex:this.cVertex}getEdgeOppositeFromVertex(t){return t===this.aVertex?this.aEdge:t===this.bVertex?this.bEdge:this.cEdge}getVertexBefore(t){return t===this.aVertex?this.cVertex:t===this.bVertex?this.aVertex:this.bVertex}getVertexAfter(t){return t===this.aVertex?this.bVertex:t===this.bVertex?this.cVertex:this.aVertex}getNonArtificialEdge(){return this.aEdge.isArtificial()?this.bEdge.isArtificial()?this.cEdge.isArtificial()?null:this.cEdge:this.bEdge:this.aEdge}getNextEdge(t){if(this.aEdge===t)return this.bEdge;if(this.bEdge===t)return this.cEdge;if(this.cEdge===t)return this.aEdge;throw new Error("illegal edge")}getPreviousEdge(t){if(this.aEdge===t)return this.cEdge;if(this.bEdge===t)return this.aEdge;if(this.cEdge===t)return this.bEdge;throw new Error("illegal edge")}isArtificial(){return this.aVertex.isArtificial()||this.bVertex.isArtificial()||this.cVertex.isArtificial()}remove(){this.aEdge.removeTriangle(this),this.bEdge.removeTriangle(this),this.cEdge.removeTriangle(this)}}class es{constructor(t,e){this.width=t,this.height=e}toString(){return`[${this.width}w, ${this.height}h]`}set(t){return this.width=t.width,this.height=t.height,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}copy(t){return t?t.set(this):new es(this.width,this.height)}swapped(){return new es(this.height,this.width)}toBounds(t,e){return new Ci(t=void 0!==t?t:0,e=void 0!==e?e:0,this.width+t,this.height+e)}equals(t){return this.width===t.width&&this.height===t.height}}ye.register("Dimension2",es);const is=window.Float64Array||Array;class ss{constructor(t){let e,i,s;this.matrix=t,this.LU=t.getArrayCopy();const r=this.LU;this.m=t.getRowDimension();const n=this.m;this.n=t.getColumnDimension();const h=this.n;for(this.piv=new Uint32Array(n),e=0;e<n;e++)this.piv[e]=e;this.pivsign=1;const a=new is(n);for(i=0;i<h;i++){for(e=0;e<n;e++)a[e]=r[t.index(e,i)];for(e=0;e<n;e++){const n=Math.min(e,i);let h=0;for(s=0;s<n;s++){h+=r[t.index(e,s)]*a[s]}a[e]-=h,r[t.index(e,i)]=a[e]}let o=i;for(e=i+1;e<n;e++)Math.abs(a[e])>Math.abs(a[o])&&(o=e);if(o!==i){for(s=0;s<h;s++){const e=t.index(o,s),n=t.index(i,s),h=r[e];r[e]=r[n],r[n]=h}s=this.piv[o],this.piv[o]=this.piv[i],this.piv[i]=s,this.pivsign=-this.pivsign}if(i<n&&0!==r[this.matrix.index(i,i)])for(e=i+1;e<n;e++)r[t.index(e,i)]/=r[t.index(i,i)]}}isNonsingular(){for(let t=0;t<this.n;t++){const e=this.matrix.index(t,t);if(0===this.LU[e])return!1}return!0}getL(){const t=new cs(this.m,this.n);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++)t.entries[t.index(e,i)]=e>i?this.LU[this.matrix.index(e,i)]:e===i?1:0;return t}getU(){const t=new cs(this.n,this.n);for(let e=0;e<this.n;e++)for(let i=0;i<this.n;i++)t.entries[t.index(e,i)]=e<=i?this.LU[this.matrix.index(e,i)]:0;return t}getPivot(){const t=new Uint32Array(this.m);for(let e=0;e<this.m;e++)t[e]=this.piv[e];return t}getDoublePivot(){const t=new is(this.m);for(let e=0;e<this.m;e++)t[e]=this.piv[e];return t}det(){if(this.m!==this.n)throw new Error("Matrix must be square.");let t=this.pivsign;for(let e=0;e<this.n;e++)t*=this.LU[this.matrix.index(e,e)];return t}solve(t){let e,i,s;if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");const r=t.getColumnDimension(),n=t.getArrayRowMatrix(this.piv,0,r-1);for(s=0;s<this.n;s++)for(e=s+1;e<this.n;e++)for(i=0;i<r;i++)n.entries[n.index(e,i)]-=n.entries[n.index(s,i)]*this.LU[this.matrix.index(e,s)];for(s=this.n-1;s>=0;s--){for(i=0;i<r;i++)n.entries[n.index(s,i)]/=this.LU[this.matrix.index(s,s)];for(e=0;e<s;e++)for(i=0;i<r;i++)n.entries[n.index(e,i)]-=n.entries[n.index(s,i)]*this.LU[this.matrix.index(e,s)]}return n}}ye.register("LUDecomposition",ss);const rs=ss,ns=window.Float64Array||Array;class hs{constructor(t){this.matrix=t,this.QR=t.getArrayCopy();const e=this.QR;this.m=t.getRowDimension();const i=this.m;this.n=t.getColumnDimension();const s=this.n;let r,n,h;for(this.Rdiag=new ns(s),h=0;h<s;h++){let t=0;for(r=h;r<i;r++)t=cs.hypot(t,e[this.matrix.index(r,h)]);if(0!==t){for(e[this.matrix.index(h,h)]<0&&(t=-t),r=h;r<i;r++)e[this.matrix.index(r,h)]/=t;for(e[this.matrix.index(h,h)]+=1,n=h+1;n<s;n++){let t=0;for(r=h;r<i;r++)t+=e[this.matrix.index(r,h)]*e[this.matrix.index(r,n)];for(t=-t/e[this.matrix.index(h,h)],r=h;r<i;r++)e[this.matrix.index(r,n)]+=t*e[this.matrix.index(r,h)]}}this.Rdiag[h]=-t}}isFullRank(){for(let t=0;t<this.n;t++)if(0===this.Rdiag[t])return!1;return!0}getH(){const t=new cs(this.m,this.n);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++)t.entries[t.index(e,i)]=e>=i?this.QR[this.matrix.index(e,i)]:0;return t}getR(){const t=new cs(this.n,this.n);for(let e=0;e<this.n;e++)for(let i=0;i<this.n;i++)t.entries[t.index(e,i)]=e<i?this.QR[this.matrix.index(e,i)]:e===i?this.Rdiag[e]:0;return t}getQ(){let t,e,i;const s=new cs(this.m,this.n);for(i=this.n-1;i>=0;i--){for(t=0;t<this.m;t++)s.entries[s.index(t,i)]=0;for(s.entries[s.index(i,i)]=1,e=i;e<this.n;e++)if(0!==this.QR[this.matrix.index(i,i)]){let r=0;for(t=i;t<this.m;t++)r+=this.QR[this.matrix.index(t,i)]*s.entries[s.index(t,e)];for(r=-r/this.QR[this.matrix.index(i,i)],t=i;t<this.m;t++)s.entries[s.index(t,e)]+=r*this.QR[this.matrix.index(t,i)]}}return s}solve(t){if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw new Error("Matrix is rank deficient.");let e,i,s;const r=t.getColumnDimension(),n=t.getArrayCopy();for(s=0;s<this.n;s++)for(i=0;i<r;i++){let r=0;for(e=s;e<this.m;e++)r+=this.QR[this.matrix.index(e,s)]*n[t.index(e,i)];for(r=-r/this.QR[this.matrix.index(s,s)],e=s;e<this.m;e++)n[t.index(e,i)]+=r*this.QR[this.matrix.index(e,s)]}for(s=this.n-1;s>=0;s--){for(i=0;i<r;i++)n[t.index(s,i)]/=this.Rdiag[s];for(e=0;e<s;e++)for(i=0;i<r;i++)n[t.index(e,i)]-=n[t.index(s,i)]*this.QR[this.matrix.index(e,s)]}return new cs(this.n,r,n,!0).getMatrix(0,this.n-1,0,r-1)}}ye.register("QRDecomposition",hs);const as=hs,os=window.Float64Array||Array;class ms{constructor(t){this.matrix=t;const e=t,i=e.getArrayCopy();this.m=e.getRowDimension(),this.n=e.getColumnDimension();const s=this.m,r=this.n,n=Math.min,h=Math.max,a=Math.pow,o=Math.abs,m=n(s,r);this.s=new os(n(s+1,r));const l=this.s;this.U=new os(s*m);const u=this.U;this.V=new os(r*r);const d=this.V,c=new os(r),p=new os(s);let g,y,f,x,w,v,E;const M=cs.hypot,T=n(s-1,r),b=h(0,n(r-2,s));for(f=0;f<h(T,b);f++){if(f<T){for(l[f]=0,g=f;g<s;g++)l[f]=M(l[f],i[g*r+f]);if(0!==l[f]){for(i[f*r+f]<0&&(l[f]=-l[f]),g=f;g<s;g++)i[g*r+f]/=l[f];i[f*r+f]+=1}l[f]=-l[f]}for(y=f+1;y<r;y++){if(f<T&&0!==l[f]){for(x=0,g=f;g<s;g++)x+=i[g*r+f]*i[g*r+y];for(x=-x/i[f*r+f],g=f;g<s;g++)i[g*r+y]+=x*i[g*r+f]}c[y]=i[f*r+y]}if(f<T)for(g=f;g<s;g++)u[g*m+f]=i[g*r+f];if(f<b){for(c[f]=0,g=f+1;g<r;g++)c[f]=M(c[f],c[g]);if(0!==c[f]){for(c[f+1]<0&&(c[f]=-c[f]),g=f+1;g<r;g++)c[g]/=c[f];c[f+1]+=1}if(c[f]=-c[f],f+1<s&&0!==c[f]){for(g=f+1;g<s;g++)p[g]=0;for(y=f+1;y<r;y++)for(g=f+1;g<s;g++)p[g]+=c[y]*i[g*r+y];for(y=f+1;y<r;y++)for(x=-c[y]/c[f+1],g=f+1;g<s;g++)i[g*r+y]+=x*p[g]}for(g=f+1;g<r;g++)d[g*r+f]=c[g]}}let I=n(r,s+1);for(T<r&&(l[T]=i[T*r+T]),s<I&&(l[I-1]=0),b+1<I&&(c[b]=i[b*r+I-1]),c[I-1]=0,y=T;y<m;y++){for(g=0;g<s;g++)u[g*m+y]=0;u[y*m+y]=1}for(f=T-1;f>=0;f--)if(0!==l[f]){for(y=f+1;y<m;y++){for(x=0,g=f;g<s;g++)x+=u[g*m+f]*u[g*m+y];for(x=-x/u[f*m+f],g=f;g<s;g++)u[g*m+y]+=x*u[g*m+f]}for(g=f;g<s;g++)u[g*m+f]=-u[g*m+f];for(u[f*m+f]=1+u[f*m+f],g=0;g<f-1;g++)u[g*m+f]=0}else{for(g=0;g<s;g++)u[g*m+f]=0;u[f*m+f]=1}for(f=r-1;f>=0;f--){if(f<b&&0!==c[f])for(y=f+1;y<m;y++){for(x=0,g=f+1;g<r;g++)x+=d[g*r+f]*d[g*r+y];for(x=-x/d[(f+1)*r+f],g=f+1;g<r;g++)d[g*r+y]+=x*d[g*r+f]}for(g=0;g<r;g++)d[g*r+f]=0;d[f*r+f]=1}const P=I-1;let O=0;const V=a(2,-52),S=a(2,-966);for(;I>0;){let t;if(O>500)break;for(f=I-2;f>=-1&&-1!==f;f--)if(o(c[f])<=S+V*(o(l[f])+o(l[f+1]))){c[f]=0;break}if(f===I-2)t=4;else{let e;for(e=I-1;e>=f&&e!==f;e--)if(x=(e!==I?o(c[e]):0)+(e!==f+1?o(c[e-1]):0),o(l[e])<=S+V*x){l[e]=0;break}e===f?t=3:e===I-1?t=1:(t=2,f=e)}switch(f++,t){case 1:for(w=c[I-2],c[I-2]=0,y=I-2;y>=f;y--)for(x=M(l[y],w),v=l[y]/x,E=w/x,l[y]=x,y!==f&&(w=-E*c[y-1],c[y-1]=v*c[y-1]),g=0;g<r;g++)x=v*d[g*r+y]+E*d[g*r+I-1],d[g*r+I-1]=-E*d[g*r+y]+v*d[g*r+I-1],d[g*r+y]=x;break;case 2:for(w=c[f-1],c[f-1]=0,y=f;y<I;y++)for(x=M(l[y],w),v=l[y]/x,E=w/x,l[y]=x,w=-E*c[y],c[y]=v*c[y],g=0;g<s;g++)x=v*u[g*m+y]+E*u[g*m+f-1],u[g*m+f-1]=-E*u[g*m+y]+v*u[g*m+f-1],u[g*m+y]=x;break;case 3:{const t=h(h(h(h(o(l[I-1]),o(l[I-2])),o(c[I-2])),o(l[f])),o(c[f])),e=l[I-1]/t,i=l[I-2]/t,n=c[I-2]/t,a=l[f]/t,p=c[f]/t,T=((i+e)*(i-e)+n*n)/2,b=e*n*(e*n);let P=0;0===T&&0===b||(P=Math.sqrt(T*T+b),T<0&&(P=-P),P=b/(T+P)),w=(a+e)*(a-e)+P;let V=a*p;for(y=f;y<I-1;y++){for(x=M(w,V),v=w/x,E=V/x,y!==f&&(c[y-1]=x),w=v*l[y]+E*c[y],c[y]=v*c[y]-E*l[y],V=E*l[y+1],l[y+1]=v*l[y+1],g=0;g<r;g++)x=v*d[g*r+y]+E*d[g*r+y+1],d[g*r+y+1]=-E*d[g*r+y]+v*d[g*r+y+1],d[g*r+y]=x;if(x=M(w,V),v=w/x,E=V/x,l[y]=x,w=v*c[y]+E*l[y+1],l[y+1]=-E*c[y]+v*l[y+1],V=E*c[y+1],c[y+1]=v*c[y+1],y<s-1)for(g=0;g<s;g++)x=v*u[g*m+y]+E*u[g*m+y+1],u[g*m+y+1]=-E*u[g*m+y]+v*u[g*m+y+1],u[g*m+y]=x}c[I-2]=w,O+=1}break;case 4:if(l[f]<=0)for(l[f]=l[f]<0?-l[f]:0,g=0;g<=P;g++)d[g*r+f]=-d[g*r+f];for(;f<P&&!(l[f]>=l[f+1]);){if(x=l[f],l[f]=l[f+1],l[f+1]=x,f<r-1)for(g=0;g<r;g++)x=d[g*r+f+1],d[g*r+f+1]=d[g*r+f],d[g*r+f]=x;if(f<s-1)for(g=0;g<s;g++)x=u[g*m+f+1],u[g*m+f+1]=u[g*m+f],u[g*m+f]=x;f++}O=0,I--;break;default:throw new Error("invalid kase: "+t)}}}getU(){return new cs(this.m,Math.min(this.m+1,this.n),this.U,!0)}getV(){return new cs(this.n,this.n,this.V,!0)}getSingularValues(){return this.s}getS(){const t=new cs(this.n,this.n);for(let e=0;e<this.n;e++){for(let i=0;i<this.n;i++)t.entries[t.index(e,i)]=0;t.entries[t.index(e,e)]=this.s[e]}return t}norm2(){return this.s[0]}cond(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}rank(){const t=Math.pow(2,-23),e=Math.max(this.m,this.n)*this.s[0]*t;let i=0;for(let s=0;s<this.s.length;s++)this.s[s]>e&&i++;return i}static pseudoinverse(t){const e=new ms(t),i=cs.diagonalMatrix(e.getSingularValues().map(t=>Math.abs(t)<1e-300?0:1/t));return e.getV().times(i).times(e.getU().transpose())}}ye.register("SingularValueDecomposition",ms);const ls=ms,us=window.Float64Array||Array;class ds{constructor(t,e,i,s){this.m=t,this.n=e;const r=t*e;let n;if(this.size=r,s)this.entries=i;else if(i||(i=0),this.entries=new us(r),Ti(i))for(n=0;n<r;n++)this.entries[n]=i[n];else for(n=0;n<r;n++)this.entries[n]=i}copy(){const t=new ds(this.m,this.n);for(let e=0;e<this.size;e++)t.entries[e]=this.entries[e];return t}getArray(){return this.entries}getArrayCopy(){return new us(this.entries)}getRowDimension(){return this.m}getColumnDimension(){return this.n}index(t,e){return t*this.n+e}get(t,e){return this.entries[this.index(t,e)]}set(t,e,i){this.entries[this.index(t,e)]=i}getMatrix(t,e,i,s){const r=new ds(e-t+1,s-i+1);for(let n=t;n<=e;n++)for(let e=i;e<=s;e++)r.entries[r.index(n-t,e-i)]=this.entries[this.index(n,e)];return r}getArrayRowMatrix(t,e,i){const s=new ds(t.length,i-e+1);for(let r=0;r<t.length;r++)for(let n=e;n<=i;n++)s.entries[s.index(r,n-e)]=this.entries[this.index(t[r],n)];return s}transpose(t){t=t||new ds(this.n,this.m);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++)t.entries[t.index(i,e)]=this.entries[this.index(e,i)];return t}norm1(){let t=0;for(let e=0;e<this.n;e++){let i=0;for(let t=0;t<this.m;t++)i+=Math.abs(this.entries[this.index(t,e)]);t=Math.max(t,i)}return t}norm2(){return new ls(this).norm2()}normInf(){let t=0;for(let e=0;e<this.m;e++){let i=0;for(let t=0;t<this.n;t++)i+=Math.abs(this.entries[this.index(e,t)]);t=Math.max(t,i)}return t}normF(){let t=0;for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++)t=ds.hypot(t,this.entries[this.index(e,i)]);return t}uminus(){const t=new ds(this.m,this.n);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++)t.entries[t.index(e,i)]=-this.entries[this.index(e,i)];return t}plus(t){this.checkMatrixDimensions(t);const e=new ds(this.m,this.n);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++){const r=e.index(i,s);e.entries[r]=this.entries[r]+t.entries[r]}return e}plusEquals(t){this.checkMatrixDimensions(t);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++){const s=this.index(e,i);this.entries[s]=this.entries[s]+t.entries[s]}return this}blendEquals(t,e){this.checkMatrixDimensions(t);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++){const r=this.index(i,s),n=this.entries[r],h=t.entries[r];this.entries[r]=n+(h-n)*e}return this}minus(t){this.checkMatrixDimensions(t);const e=new ds(this.m,this.n);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++){const r=this.index(i,s);e.entries[r]=this.entries[r]-t.entries[r]}return e}minusEquals(t){this.checkMatrixDimensions(t);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++){const s=this.index(e,i);this.entries[s]=this.entries[s]-t.entries[s]}return this}arrayTimes(t){this.checkMatrixDimensions(t);const e=new ds(this.m,this.n);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++){const r=e.index(i,s);e.entries[r]=this.entries[r]*t.entries[r]}return e}arrayTimesEquals(t){this.checkMatrixDimensions(t);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++){const s=this.index(e,i);this.entries[s]=this.entries[s]*t.entries[s]}return this}arrayRightDivide(t){this.checkMatrixDimensions(t);const e=new ds(this.m,this.n);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++){const r=this.index(i,s);e.entries[r]=this.entries[r]/t.entries[r]}return e}arrayRightDivideEquals(t){this.checkMatrixDimensions(t);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++){const s=this.index(e,i);this.entries[s]=this.entries[s]/t.entries[s]}return this}arrayLeftDivide(t){this.checkMatrixDimensions(t);const e=new ds(this.m,this.n);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++){const r=this.index(i,s);e.entries[r]=t.entries[r]/this.entries[r]}return e}arrayLeftDivideEquals(t){this.checkMatrixDimensions(t);for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++){const s=this.index(e,i);this.entries[s]=t.entries[s]/this.entries[s]}return this}times(t){let e,i,s,r,n,h;if(t.isMatrix){if(h=t,h.m!==this.n)throw new Error("Matrix inner dimensions must agree.");e=new ds(this.m,h.n);const a=new us(this.n);for(s=0;s<h.n;s++){for(r=0;r<this.n;r++)a[r]=h.entries[h.index(r,s)];for(i=0;i<this.m;i++){for(n=0,r=0;r<this.n;r++)n+=this.entries[this.index(i,r)]*a[r];e.entries[e.index(i,s)]=n}}return e}for(n=t,e=new ds(this.m,this.n),i=0;i<this.m;i++)for(s=0;s<this.n;s++)e.entries[e.index(i,s)]=n*this.entries[this.index(i,s)];return e}timesEquals(t){for(let e=0;e<this.m;e++)for(let i=0;i<this.n;i++){const s=this.index(e,i);this.entries[s]=t*this.entries[s]}return this}solve(t){return this.m===this.n?new rs(this).solve(t):new as(this).solve(t)}solveTranspose(t){return this.transpose().solve(t.transpose())}inverse(){return this.solve(ds.identity(this.m,this.m))}det(){return new rs(this).det()}rank(){return new ls(this).rank()}cond(){return new ls(this).cond()}trace(){let t=0;for(let e=0;e<Math.min(this.m,this.n);e++)t+=this.entries[this.index(e,e)];return t}checkMatrixDimensions(t){if(t.m!==this.m||t.n!==this.n)throw new Error("Matrix dimensions must agree.")}toString(){let t="";t+=`dim: ${this.getRowDimension()}x${this.getColumnDimension()}\n`;for(let e=0;e<this.getRowDimension();e++){for(let i=0;i<this.getColumnDimension();i++)t+=this.get(e,i)+" ";t+="\n"}return t}extractVector2(t){return new Ge(this.get(0,t),this.get(1,t))}extractVector3(t){return new Be(this.get(0,t),this.get(1,t),this.get(2,t))}extractVector4(t){return new Ze(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))}setVectors3(t){const e=t.length;for(let i=0;i<e;i++){const s=t[i];this.entries[i]=s.x,this.entries[i+e]=s.y,this.entries[i+2*e]=s.z}return this}static hypot(t,e){let i;return Math.abs(t)>Math.abs(e)?(i=e/t,i=Math.abs(t)*Math.sqrt(1+i*i)):0!==e?(i=t/e,i=Math.abs(e)*Math.sqrt(1+i*i)):i=0,i}static identity(t,e){const i=new ds(t,e);for(let s=0;s<t;s++)for(let t=0;t<e;t++)i.entries[i.index(s,t)]=s===t?1:0;return i}static diagonalMatrix(t){const e=t.length,i=new ds(e,e);for(let s=0;s<e;s++)i.entries[i.index(s,s)]=t[s];return i}static rowVector2(t){return new ds(1,2,[t.x,t.y])}static rowVector3(t){return new ds(1,3,[t.x,t.y,t.z])}static rowVector4(t){return new ds(1,4,[t.x,t.y,t.z,t.w])}static rowVector(t){if(t.isVector2)return ds.rowVector2(t);if(t.isVector3)return ds.rowVector3(t);if(t.isVector4)return ds.rowVector4(t);throw new Error("undetected type of vector: "+t.toString())}static columnVector2(t){return new ds(2,1,[t.x,t.y])}static columnVector3(t){return new ds(3,1,[t.x,t.y,t.z])}static columnVector4(t){return new ds(4,1,[t.x,t.y,t.z,t.w])}static columnVector(t){if(t.isVector2)return ds.columnVector2(t);if(t.isVector3)return ds.columnVector3(t);if(t.isVector4)return ds.columnVector4(t);throw new Error("undetected type of vector: "+t.toString())}static fromVectors2(t){const e=t.length,i=new us(2*e);for(let s=0;s<e;s++){const r=t[s];i[s]=r.x,i[s+e]=r.y}return new ds(2,e,i,!0)}static fromVectors3(t){const e=t.length,i=new us(3*e);for(let s=0;s<e;s++){const r=t[s];i[s]=r.x,i[s+e]=r.y,i[s+2*e]=r.z}return new ds(3,e,i,!0)}static fromVectors4(t){const e=t.length,i=new us(4*e);for(let s=0;s<e;s++){const r=t[s];i[s]=r.x,i[s+e]=r.y,i[s+2*e]=r.z,i[s+3*e]=r.w}return new ds(4,e,i,!0)}}ds.prototype.isMatrix=!0,ye.register("Matrix",ds);const cs=ds,ps=window.Float64Array||Array;class gs{constructor(t){let e,i;const s=t.entries;this.n=t.getColumnDimension();const r=this.n;for(this.V=new ps(r*r),this.d=new ps(r),this.e=new ps(r),this.issymmetric=!0,i=0;i<r&&this.issymmetric;i++)for(e=0;e<r&&this.issymmetric;e++)this.issymmetric=s[e*this.n+i]===s[i*this.n+e];if(this.issymmetric){for(e=0;e<r;e++)for(i=0;i<r;i++)this.V[e*this.n+i]=s[e*this.n+i];this.tred2(),this.tql2()}else{for(this.H=new ps(r*r),this.ort=new ps(r),i=0;i<r;i++)for(e=0;e<r;e++)this.H[e*this.n+i]=s[e*this.n+i];this.orthes(),this.hqr2()}}getV(){return this.V.copy()}getRealEigenvalues(){return this.d}getImagEigenvalues(){return this.e}getD(){const t=this.n,e=this.d,i=this.e,s=new cs(t,t),r=s.entries;for(let n=0;n<t;n++){for(let e=0;e<t;e++)r[n*this.n+e]=0;r[n*this.n+n]=e[n],i[n]>0?r[n*this.n+n+1]=i[n]:i[n]<0&&(r[n*this.n+n-1]=i[n])}return s}tred2(){const t=this.n,e=this.V,i=this.d,s=this.e;let r,n,h,a,o,m;for(n=0;n<t;n++)i[n]=e[(t-1)*t+n];for(r=t-1;r>0;r--){let l=0;for(m=0,h=0;h<r;h++)l+=Math.abs(i[h]);if(0===l)for(s[r]=i[r-1],n=0;n<r;n++)i[n]=e[(r-1)*t+n],e[r*this.n+n]=0,e[n*this.n+r]=0;else{for(h=0;h<r;h++)i[h]/=l,m+=i[h]*i[h];for(a=i[r-1],o=Math.sqrt(m),a>0&&(o=-o),s[r]=l*o,m-=a*o,i[r-1]=a-o,n=0;n<r;n++)s[n]=0;for(n=0;n<r;n++){for(a=i[n],e[n*this.n+r]=a,o=s[n]+e[n*t+n]*a,h=n+1;h<=r-1;h++)o+=e[h*t+n]*i[h],s[h]+=e[h*t+n]*a;s[n]=o}for(a=0,n=0;n<r;n++)s[n]/=m,a+=s[n]*i[n];const u=a/(m+m);for(n=0;n<r;n++)s[n]-=u*i[n];for(n=0;n<r;n++){for(a=i[n],o=s[n],h=n;h<=r-1;h++)e[h*t+n]-=a*s[h]+o*i[h];i[n]=e[(r-1)*t+n],e[r*this.n+n]=0}}i[r]=m}for(r=0;r<t-1;r++){if(e[(t-1)*t+r]=e[r*t+r],e[r*t+r]=1,m=i[r+1],0!==m){for(h=0;h<=r;h++)i[h]=e[h*t+(r+1)]/m;for(n=0;n<=r;n++){for(o=0,h=0;h<=r;h++)o+=e[h*t+(r+1)]*e[h*t+n];for(h=0;h<=r;h++)e[h*t+n]-=o*i[h]}}for(h=0;h<=r;h++)e[h*t+(r+1)]=0}for(n=0;n<t;n++)i[n]=e[(t-1)*t+n],e[(t-1)*t+n]=0;e[(t-1)*t+(t-1)]=1,s[0]=0}tql2(){const t=this.n,e=this.V,i=this.d,s=this.e;let r,n,h,a,o,m,l;for(r=1;r<t;r++)s[r-1]=s[r];s[t-1]=0;let u=0,d=0;const c=Math.pow(2,-52);for(a=0;a<t;a++){d=Math.max(d,Math.abs(i[a])+Math.abs(s[a]));let n=a;for(;n<t&&!(Math.abs(s[n])<=c*d);)n++;if(n>a){l=0;do{l+=1,o=i[a],m=(i[a+1]-o)/(2*s[a]);let d=cs.hypot(m,1);m<0&&(d=-d),i[a]=s[a]/(m+d),i[a+1]=s[a]*(m+d);const c=i[a+1];let p=o-i[a];for(r=a+2;r<t;r++)i[r]-=p;u+=p,m=i[n];let g=1,y=g,f=g;const x=s[a+1];let w=0,v=0;for(r=n-1;r>=a;r--)for(f=y,y=g,v=w,o=g*s[r],p=g*m,d=cs.hypot(m,s[r]),s[r+1]=w*d,w=s[r]/d,g=m/d,m=g*i[r]-w*o,i[r+1]=p+w*(g*o+w*i[r]),h=0;h<t;h++)p=e[h*t+(r+1)],e[h*t+(r+1)]=w*e[h*t+r]+g*p,e[h*t+r]=g*e[h*t+r]-w*p;m=-w*v*f*x*s[a]/c,s[a]=w*m,i[a]=g*m}while(Math.abs(s[a])>c*d)}i[a]=i[a]+u,s[a]=0}for(r=0;r<t-1;r++){for(h=r,m=i[r],n=r+1;n<t;n++)i[n]<m&&(h=n,m=i[n]);if(h!==r)for(i[h]=i[r],i[r]=m,n=0;n<t;n++)m=e[n*this.n+r],e[n*this.n+r]=e[n*t+h],e[n*t+h]=m}}orthes(){const t=this.n,e=this.V,i=this.H,s=this.ort;let r,n,h,a,o;const m=t-1;for(h=1;h<=m-1;h++){let e=0;for(r=h;r<=m;r++)e+=Math.abs(i[r*t+(h-1)]);if(0!==e){let l=0;for(r=m;r>=h;r--)s[r]=i[r*t+(h-1)]/e,l+=s[r]*s[r];for(o=Math.sqrt(l),s[h]>0&&(o=-o),l-=s[h]*o,s[h]=s[h]-o,n=h;n<t;n++){for(a=0,r=m;r>=h;r--)a+=s[r]*i[r*this.n+n];for(a/=l,r=h;r<=m;r++)i[r*this.n+n]-=a*s[r]}for(r=0;r<=m;r++){for(a=0,n=m;n>=h;n--)a+=s[n]*i[r*this.n+n];for(a/=l,n=h;n<=m;n++)i[r*this.n+n]-=a*s[n]}s[h]=e*s[h],i[h*t+(h-1)]=e*o}}for(r=0;r<t;r++)for(n=0;n<t;n++)e[r*this.n+n]=r===n?1:0;for(h=m-1;h>=1;h--)if(0!==i[h*t+(h-1)]){for(r=h+1;r<=m;r++)s[r]=i[r*t+(h-1)];for(n=h;n<=m;n++){for(o=0,r=h;r<=m;r++)o+=s[r]*e[r*this.n+n];for(o=o/s[h]/i[h*t+(h-1)],r=h;r<=m;r++)e[r*this.n+n]+=o*s[r]}}}cdiv(t,e,i,s){let r,n;Math.abs(i)>Math.abs(s)?(r=s/i,n=i+r*s,this.cdivr=(t+r*e)/n,this.cdivi=(e-r*t)/n):(r=i/s,n=s+r*i,this.cdivr=(r*t+e)/n,this.cdivi=(r*e-t)/n)}hqr2(){let t;const e=this.V,i=this.d,s=this.e,r=this.H;let n,h,a,o,m,l;const u=this.n;t=u-1;const d=u-1,c=Math.pow(2,-52);let p,g,y,f,x=0,w=0,v=0,E=0,M=0,T=0,b=0;for(n=0;n<u;n++)for((n<0||n>d)&&(i[n]=r[n*t+n],s[n]=0),h=Math.max(n-1,0);h<u;h++)b+=Math.abs(r[n*this.n+h]);for(l=0;t>=0;){for(o=t;o>0&&(M=Math.abs(r[(o-1)*t+(o-1)])+Math.abs(r[o*t+o]),0===M&&(M=b),!(Math.abs(r[o*t+(o-1)])<c*M));)o--;if(o===t)r[t*t+t]=r[t*t+t]+x,i[t]=r[t*t+t],s[t]=0,t--,l=0;else if(o===t-1){if(g=r[t*t+t-1]*r[(t-1)*t+t],w=(r[(t-1)*t+(t-1)]-r[t*t+t])/2,v=w*w+g,T=Math.sqrt(Math.abs(v)),r[t*t+t]=r[t*t+t]+x,r[(t-1)*t+(t-1)]=r[(t-1)*t+(t-1)]+x,y=r[t*t+t],v>=0){for(T=w>=0?w+T:w-T,i[t-1]=y+T,i[t]=i[t-1],0!==T&&(i[t]=y-g/T),s[t-1]=0,s[t]=0,y=r[t*t+t-1],M=Math.abs(y)+Math.abs(T),w=y/M,v=T/M,E=Math.sqrt(w*w+v*v),w/=E,v/=E,h=t-1;h<u;h++)T=r[(t-1)*t+h],r[(t-1)*t+h]=v*T+w*r[t*t+h],r[t*t+h]=v*r[t*t+h]-w*T;for(n=0;n<=t;n++)T=r[n*t+t-1],r[n*t+t-1]=v*T+w*r[n*t+t],r[n*t+t]=v*r[n*t+t]-w*T;for(n=0;n<=d;n++)T=e[n*t+t-1],e[n*t+t-1]=v*T+w*e[n*t+t],e[n*t+t]=v*e[n*t+t]-w*T}else i[t-1]=y+w,i[t]=y+w,s[t-1]=T,s[t]=-T;t-=2,l=0}else{if(y=r[t*t+t],f=0,g=0,o<t&&(f=r[(t-1)*t+(t-1)],g=r[t*t+t-1]*r[(t-1)*t+t]),10===l){for(x+=y,n=0;n<=t;n++)r[n*t+n]-=y;M=Math.abs(r[t*t+t-1])+Math.abs(r[(t-1)*t+t-2]),y=f=.75*M,g=-.4375*M*M}if(30===l&&(M=(f-y)/2,M=M*M+g,M>0)){for(M=Math.sqrt(M),f<y&&(M=-M),M=y-g/((f-y)/2+M),n=0;n<=t;n++)r[n*t+n]-=M;x+=M,y=f=g=.964}for(l+=1,m=t-2;m>=o&&(T=r[m*t+m],E=y-T,M=f-T,w=(E*M-g)/r[(m+1)*t+m]+r[m*t+m+1],v=r[(m+1)*t+m+1]-T-E-M,E=r[(m+2)*t+m+1],M=Math.abs(w)+Math.abs(v)+Math.abs(E),w/=M,v/=M,E/=M,m!==o)&&!(Math.abs(r[m*t+(m-1)])*(Math.abs(v)+Math.abs(E))<c*(Math.abs(w)*(Math.abs(r[(m-1)*t+m-1])+Math.abs(T)+Math.abs(r[(m+1)*t+m+1]))));)m--;for(n=m+2;n<=t;n++)r[n*t+n-2]=0,n>m+2&&(r[n*t+n-3]=0);for(a=m;a<=t-1;a++){const i=a!==t-1;if(a!==m&&(w=r[a*t+a-1],v=r[(a+1)*t+a-1],E=i?r[(a+2)*t+a-1]:0,y=Math.abs(w)+Math.abs(v)+Math.abs(E),0!==y&&(w/=y,v/=y,E/=y)),0===y)break;if(M=Math.sqrt(w*w+v*v+E*E),w<0&&(M=-M),0!==M){for(a!==m?r[a*t+a-1]=-M*y:o!==m&&(r[a*t+a-1]=-r[a*t+a-1]),w+=M,y=w/M,f=v/M,T=E/M,v/=w,E/=w,h=a;h<u;h++)w=r[a*t+h]+v*r[(a+1)*t+h],i&&(w+=E*r[(a+2)*t+h],r[(a+2)*t+h]=r[(a+2)*t+h]-w*T),r[a*t+h]=r[a*t+h]-w*y,r[(a+1)*t+h]=r[(a+1)*t+h]-w*f;for(n=0;n<=Math.min(t,a+3);n++)w=y*r[n*t+a]+f*r[n*t+a+1],i&&(w+=T*r[n*t+a+2],r[n*t+a+2]=r[n*t+a+2]-w*E),r[n*t+a]=r[n*t+a]-w,r[n*t+a+1]=r[n*t+a+1]-w*v;for(n=0;n<=d;n++)w=y*e[n*t+a]+f*e[n*t+a+1],i&&(w+=T*e[n*t+a+2],e[n*t+a+2]=e[n*t+a+2]-w*E),e[n*t+a]=e[n*t+a]-w,e[n*t+a+1]=e[n*t+a+1]-w*v}}}}if(0!==b){for(t=u-1;t>=0;t--)if(w=i[t],v=s[t],0===v)for(o=t,r[t*t+t]=1,n=t-1;n>=0;n--){for(g=r[n*t+n]-w,E=0,h=o;h<=t;h++)E+=r[n*this.n+h]*r[h*t+t];if(s[n]<0)T=g,M=E;else if(o=n,0===s[n]?r[n*t+t]=0!==g?-E/g:-E/(c*b):(y=r[n*t+n+1],f=r[(n+1)*t+n],v=(i[n]-w)*(i[n]-w)+s[n]*s[n],p=(y*M-T*E)/v,r[n*t+t]=p,Math.abs(y)>Math.abs(T)?r[(n+1)*t+t]=(-E-g*p)/y:r[(n+1)*t+t]=(-M-f*p)/T),p=Math.abs(r[n*t+t]),c*p*p>1)for(h=n;h<=t;h++)r[h*t+t]=r[h*t+t]/p}else if(v<0)for(o=t-1,Math.abs(r[t*t+t-1])>Math.abs(r[(t-1)*t+t])?(r[(t-1)*t+(t-1)]=v/r[t*t+t-1],r[(t-1)*t+t]=-(r[t*t+t]-w)/r[t*t+t-1]):(this.cdiv(0,-r[(t-1)*t+t],r[(t-1)*t+(t-1)]-w,v),r[(t-1)*t+(t-1)]=this.cdivr,r[(t-1)*t+t]=this.cdivi),r[t*t+t-1]=0,r[t*t+t]=1,n=t-2;n>=0;n--){let e,a,m,l;for(e=0,a=0,h=o;h<=t;h++)e+=r[n*this.n+h]*r[h*t+t-1],a+=r[n*this.n+h]*r[h*t+t];if(g=r[n*t+n]-w,s[n]<0)T=g,E=e,M=a;else if(o=n,0===s[n]?(this.cdiv(-e,-a,g,v),r[n*t+t-1]=this.cdivr,r[n*t+t]=this.cdivi):(y=r[n*t+n+1],f=r[(n+1)*t+n],m=(i[n]-w)*(i[n]-w)+s[n]*s[n]-v*v,l=2*(i[n]-w)*v,0===m&&0===l&&(m=c*b*(Math.abs(g)+Math.abs(v)+Math.abs(y)+Math.abs(f)+Math.abs(T))),this.cdiv(y*E-T*e+v*a,y*M-T*a-v*e,m,l),r[n*t+t-1]=this.cdivr,r[n*t+t]=this.cdivi,Math.abs(y)>Math.abs(T)+Math.abs(v)?(r[(n+1)*t+t-1]=(-e-g*r[n*t+t-1]+v*r[n*t+t])/y,r[(n+1)*t+t]=(-a-g*r[n*t+t]-v*r[n*t+t-1])/y):(this.cdiv(-E-f*r[n*t+t-1],-M-f*r[n*t+t],T,v),r[(n+1)*t+t-1]=this.cdivr,r[(n+1)*t+t]=this.cdivi)),p=Math.max(Math.abs(r[n*t+t-1]),Math.abs(r[n*t+t])),c*p*p>1)for(h=n;h<=t;h++)r[h*t+t-1]=r[h*t+t-1]/p,r[h*t+t]=r[h*t+t]/p}for(n=0;n<u;n++)if(n<0||n>d)for(h=n;h<u;h++)e[n*this.n+h]=r[n*this.n+h];for(h=u-1;h>=0;h--)for(n=0;n<=d;n++){for(T=0,a=0;a<=Math.min(h,d);a++)T+=e[n*t+a]*r[a*t+h];e[n*this.n+h]=T}}}}ye.register("EigenvalueDecomposition",gs);const ys=(t,e,i,s,r,n)=>{let h=ri.linear(t,e,i,s,r);if(n){const t=Math.max(i,s),e=Math.min(i,s);h=ri.clamp(h,e,t)}return h};ye.register("LinearFunction",class{constructor(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.a1=t,this.a2=e,this.b1=i,this.b2=s,this.clamp=r}evaluate(t){return ys(this.a1,this.a2,this.b1,this.b2,t,this.clamp)}inverse(t){return ys(this.b1,this.b2,this.a1,this.a2,t,this.clamp)}});const fs=window.Float32Array||Array;class xs{constructor(t,e,i,s,r,n,h,a,o,m,l,u,d,c,p,g,y){this.entries=new fs(16),this.type=ws.OTHER,this.rowMajor(void 0!==t?t:1,void 0!==e?e:0,void 0!==i?i:0,void 0!==s?s:0,void 0!==r?r:0,void 0!==n?n:1,void 0!==h?h:0,void 0!==a?a:0,void 0!==o?o:0,void 0!==m?m:0,void 0!==l?l:1,void 0!==u?u:0,void 0!==d?d:0,void 0!==c?c:0,void 0!==p?p:0,void 0!==g?g:1,y)}rowMajor(t,e,i,s,r,n,h,a,o,m,l,u,d,c,p,g,y){return this.entries[0]=t,this.entries[1]=r,this.entries[2]=o,this.entries[3]=d,this.entries[4]=e,this.entries[5]=n,this.entries[6]=m,this.entries[7]=c,this.entries[8]=i,this.entries[9]=h,this.entries[10]=l,this.entries[11]=p,this.entries[12]=s,this.entries[13]=a,this.entries[14]=u,this.entries[15]=g,this.type=void 0===y?0===d&&0===c&&0===p&&1===g?ws.AFFINE:ws.OTHER:y,this}columnMajor(t,e,i,s,r,n,h,a,o,m,l,u,d,c,p,g,y){return this.rowMajor(t,r,o,d,e,n,m,c,i,h,l,p,s,a,u,g,y)}set(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m03(),t.m10(),t.m11(),t.m12(),t.m13(),t.m20(),t.m21(),t.m22(),t.m23(),t.m30(),t.m31(),t.m32(),t.m33(),t.type)}m00(){return this.entries[0]}m01(){return this.entries[4]}m02(){return this.entries[8]}m03(){return this.entries[12]}m10(){return this.entries[1]}m11(){return this.entries[5]}m12(){return this.entries[9]}m13(){return this.entries[13]}m20(){return this.entries[2]}m21(){return this.entries[6]}m22(){return this.entries[10]}m23(){return this.entries[14]}m30(){return this.entries[3]}m31(){return this.entries[7]}m32(){return this.entries[11]}m33(){return this.entries[15]}isFinite(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m03())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m13())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())&&isFinite(this.m23())&&isFinite(this.m30())&&isFinite(this.m31())&&isFinite(this.m32())&&isFinite(this.m33())}getTranslation(){return new Be(this.m03(),this.m13(),this.m23())}get translation(){return this.getTranslation()}getScaleVector(){const t=this.m00()+this.m03(),e=this.m10()+this.m13(),i=this.m20()+this.m23(),s=this.m30()+this.m33(),r=this.m01()+this.m03(),n=this.m11()+this.m13(),h=this.m21()+this.m23(),a=this.m31()+this.m33(),o=this.m02()+this.m03(),m=this.m12()+this.m13(),l=this.m22()+this.m23(),u=this.m32()+this.m33();return new Be(Math.sqrt(t*t+e*e+i*i+s*s),Math.sqrt(r*r+n*n+h*h+a*a),Math.sqrt(o*o+m*m+l*l+u*u))}get scaleVector(){return this.getScaleVector()}getCSSTransform(){return`matrix3d(${this.entries[0].toFixed(20)},${this.entries[1].toFixed(20)},${this.entries[2].toFixed(20)},${this.entries[3].toFixed(20)},${this.entries[4].toFixed(20)},${this.entries[5].toFixed(20)},${this.entries[6].toFixed(20)},${this.entries[7].toFixed(20)},${this.entries[8].toFixed(20)},${this.entries[9].toFixed(20)},${this.entries[10].toFixed(20)},${this.entries[11].toFixed(20)},${this.entries[12].toFixed(20)},${this.entries[13].toFixed(20)},${this.entries[14].toFixed(20)},${this.entries[15].toFixed(20)})`}get cssTransform(){return this.getCSSTransform()}equals(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m03()===t.m03()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m13()===t.m13()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()&&this.m23()===t.m23()&&this.m30()===t.m30()&&this.m31()===t.m31()&&this.m32()===t.m32()&&this.m33()===t.m33()}equalsEpsilon(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m03()-t.m03())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m13()-t.m13())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e&&Math.abs(this.m23()-t.m23())<e&&Math.abs(this.m30()-t.m30())<e&&Math.abs(this.m31()-t.m31())<e&&Math.abs(this.m32()-t.m32())<e&&Math.abs(this.m33()-t.m33())<e}copy(){return new xs(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33(),this.type)}plus(t){return new xs(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())}minus(t){return new xs(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())}transposed(){return new xs(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())}negated(){return new xs(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())}inverted(){let t;switch(this.type){case ws.IDENTITY:return this;case ws.TRANSLATION_3D:return new xs(1,0,0,-this.m03(),0,1,0,-this.m13(),0,0,1,-this.m23(),0,0,0,1,ws.TRANSLATION_3D);case ws.SCALING:return new xs(1/this.m00(),0,0,0,0,1/this.m11(),0,0,0,0,1/this.m22(),0,0,0,0,1/this.m33(),ws.SCALING);case ws.AFFINE:case ws.OTHER:if(t=this.getDeterminant(),0!==t)return new xs((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix4.inverted with unknown type: "+this.type)}}timesMatrix(t){if(this.type===ws.IDENTITY||t.type===ws.IDENTITY)return this.type===ws.IDENTITY?t:this;if(this.type===t.type){if(this.type===ws.TRANSLATION_3D)return new xs(1,0,0,this.m03()+t.m02(),0,1,0,this.m13()+t.m12(),0,0,1,this.m23()+t.m23(),0,0,0,1,ws.TRANSLATION_3D);if(this.type===ws.SCALING)return new xs(this.m00()*t.m00(),0,0,0,0,this.m11()*t.m11(),0,0,0,0,this.m22()*t.m22(),0,0,0,0,1,ws.SCALING)}return this.type!==ws.OTHER&&t.type!==ws.OTHER?new xs(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23(),0,0,0,1,ws.AFFINE):new xs(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33())}timesVector4(t){const e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,i=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,r=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new Ze(e,i,s,r)}timesVector3(t){return this.timesVector4(t.toVector4()).toVector3()}timesTransposeVector4(t){const e=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,i=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,s=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,r=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new Ze(e,i,s,r)}timesTransposeVector3(t){return this.timesTransposeVector4(t.toVector4()).toVector3()}timesRelativeVector3(t){const e=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,i=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,s=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new Be(e,i,s)}getDeterminant(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()}get determinant(){return this.getDeterminant()}toString(){return`${this.m00()} ${this.m01()} ${this.m02()} ${this.m03()}\n${this.m10()} ${this.m11()} ${this.m12()} ${this.m13()}\n${this.m20()} ${this.m21()} ${this.m22()} ${this.m23()}\n${this.m30()} ${this.m31()} ${this.m32()} ${this.m33()}`}makeImmutable(){return this}copyToArray(t){return t[0]=this.m00(),t[1]=this.m10(),t[2]=this.m20(),t[3]=this.m30(),t[4]=this.m01(),t[5]=this.m11(),t[6]=this.m21(),t[7]=this.m31(),t[8]=this.m02(),t[9]=this.m12(),t[10]=this.m22(),t[11]=this.m32(),t[12]=this.m03(),t[13]=this.m13(),t[14]=this.m23(),t[15]=this.m33(),t}static identity(){return new xs(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,ws.IDENTITY)}static translation(t,e,i){return new xs(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1,ws.TRANSLATION_3D)}static translationFromVector(t){return xs.translation(t.x,t.y,t.z)}static scaling(t,e,i){return new xs(t,0,0,0,0,e=void 0===e?t:e,0,0,0,0,i=void 0===i?t:i,0,0,0,0,1,ws.SCALING)}static rotationAxisAngle(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i;return new xs(t.x*t.x*r+i,t.x*t.y*r-t.z*s,t.x*t.z*r+t.y*s,0,t.y*t.x*r+t.z*s,t.y*t.y*r+i,t.y*t.z*r-t.x*s,0,t.z*t.x*r-t.y*s,t.z*t.y*r+t.x*s,t.z*t.z*r+i,0,0,0,0,1,ws.AFFINE)}static rotationX(t){const e=Math.cos(t),i=Math.sin(t);return new xs(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1,ws.AFFINE)}static rotationY(t){const e=Math.cos(t),i=Math.sin(t);return new xs(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1,ws.AFFINE)}static rotationZ(t){const e=Math.cos(t),i=Math.sin(t);return new xs(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1,ws.AFFINE)}static gluPerspective(t,e,i,s){const r=Math.cos(t)/Math.sin(t);return new xs(r/e,0,0,0,0,r,0,0,0,0,(s+i)/(i-s),2*s*i/(i-s),0,0,-1,0)}}ye.register("Matrix4",xs);const ws=w.byKeys(["OTHER","IDENTITY","TRANSLATION_3D","SCALING","AFFINE"]);xs.Types=ws,xs.IDENTITY=(new xs).makeImmutable();const vs=xs;function Es(t){return t.toFixed(20)}ye.register("toSVGNumber",Es);const Ms=Es;class Ts extends q{}_defineProperty(Ts,"OTHER",new Ts),_defineProperty(Ts,"IDENTITY",new Ts),_defineProperty(Ts,"TRANSLATION_2D",new Ts),_defineProperty(Ts,"SCALING",new Ts),_defineProperty(Ts,"AFFINE",new Ts),_defineProperty(Ts,"enumeration",new H(Ts));class bs{constructor(){this.entries=[1,0,0,0,1,0,0,0,1],this.type=Ts.IDENTITY}m00(){return this.entries[0]}m01(){return this.entries[3]}m02(){return this.entries[6]}m10(){return this.entries[1]}m11(){return this.entries[4]}m12(){return this.entries[7]}m20(){return this.entries[2]}m21(){return this.entries[5]}m22(){return this.entries[8]}isIdentity(){return this.type===Ts.IDENTITY||this.equals(bs.IDENTITY)}isFastIdentity(){return this.type===Ts.IDENTITY}isTranslation(){return this.type===Ts.TRANSLATION_2D||1===this.m00()&&1===this.m11()&&1===this.m22()&&0===this.m01()&&0===this.m10()&&0===this.m20()&&0===this.m21()}isAffine(){return this.type===Ts.AFFINE||0===this.m20()&&0===this.m21()&&1===this.m22()}isAligned(){return this.isAffine()&&0===this.m01()&&0===this.m10()}isAxisAligned(){return this.isAffine()&&(0===this.m01()&&0===this.m10()||0===this.m00()&&0===this.m11())}isFinite(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())}getDeterminant(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()}get determinant(){return this.getDeterminant()}getTranslation(){return new Ge(this.m02(),this.m12())}get translation(){return this.getTranslation()}getScaleVector(){return new Ge(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}get scaleVector(){return this.getScaleVector()}getRotation(){return Math.atan2(this.m10(),this.m00())}get rotation(){return this.getRotation()}toMatrix4(){return new vs(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)}toAffineMatrix4(){return new vs(this.m00(),this.m01(),0,this.m02(),this.m10(),this.m11(),0,this.m12(),0,0,1,0,0,0,0,1)}toString(){return`${this.m00()} ${this.m01()} ${this.m02()}\n${this.m10()} ${this.m11()} ${this.m12()}\n${this.m20()} ${this.m21()} ${this.m22()}`}toSVGMatrix(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t}getCSSTransform(){return`matrix(${this.entries[0].toFixed(20)},${this.entries[1].toFixed(20)},${this.entries[3].toFixed(20)},${this.entries[4].toFixed(20)},${this.entries[6].toFixed(20)},${this.entries[7].toFixed(20)})`}get cssTransform(){return this.getCSSTransform()}getSVGTransform(){switch(this.type){case Ts.IDENTITY:return"";case Ts.TRANSLATION_2D:return`translate(${Ms(this.entries[6])},${Ms(this.entries[7])})`;case Ts.SCALING:return`scale(${Ms(this.entries[0])}${this.entries[0]===this.entries[4]?"":","+Ms(this.entries[4])})`;default:return`matrix(${Ms(this.entries[0])},${Ms(this.entries[1])},${Ms(this.entries[3])},${Ms(this.entries[4])},${Ms(this.entries[6])},${Ms(this.entries[7])})`}}get svgTransform(){return this.getSVGTransform()}getCSSTransformStyles(){const t=this.getCSSTransform();return{"-webkit-perspective":"1000","-webkit-backface-visibility":"hidden","-webkit-transform":t+" translateZ(0)","-moz-transform":t+" translateZ(0)","-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}}get cssTransformStyles(){return this.getCSSTransformStyles()}equals(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()}equalsEpsilon(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e}copy(){return Is(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)}plus(t){return Is(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())}minus(t){return Is(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())}transposed(){return Is(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===Ts.IDENTITY||this.type===Ts.SCALING?this.type:void 0)}negated(){return Is(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())}inverted(){let t;switch(this.type){case Ts.IDENTITY:return this;case Ts.TRANSLATION_2D:return Is(1,0,-this.m02(),0,1,-this.m12(),0,0,1,Ts.TRANSLATION_2D);case Ts.SCALING:return Is(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),Ts.SCALING);case Ts.AFFINE:if(t=this.getDeterminant(),0!==t)return Is((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,Ts.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case Ts.OTHER:if(t=this.getDeterminant(),0!==t)return Is((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,Ts.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}}timesMatrix(t){if(this.type===Ts.IDENTITY||t.type===Ts.IDENTITY)return this.type===Ts.IDENTITY?t:this;if(this.type===t.type){if(this.type===Ts.TRANSLATION_2D)return Is(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,Ts.TRANSLATION_2D);if(this.type===Ts.SCALING)return Is(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,Ts.SCALING)}return this.type!==Ts.OTHER&&t.type!==Ts.OTHER?Is(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,Ts.AFFINE):Is(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())}timesVector2(t){const e=this.m00()*t.x+this.m01()*t.y+this.m02(),i=this.m10()*t.x+this.m11()*t.y+this.m12();return new Ge(e,i)}timesVector3(t){const e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,i=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new Be(e,i,s)}timesTransposeVector2(t){const e=this.m00()*t.x+this.m10()*t.y,i=this.m01()*t.x+this.m11()*t.y;return new Ge(e,i)}timesRelativeVector2(t){const e=this.m00()*t.x+this.m01()*t.y,i=this.m10()*t.y+this.m11()*t.y;return new Ge(e,i)}rowMajor(t,e,i,s,r,n,h,a,o,m){return this.entries[0]=t,this.entries[1]=s,this.entries[2]=h,this.entries[3]=e,this.entries[4]=r,this.entries[5]=a,this.entries[6]=i,this.entries[7]=n,this.entries[8]=o,this.type=void 0===m?0===h&&0===a&&1===o?Ts.AFFINE:Ts.OTHER:m,this}set(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),t.m20(),t.m21(),t.m22(),t.type)}setArray(t){return this.rowMajor(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}set00(t){return this.entries[0]=t,this}set01(t){return this.entries[3]=t,this}set02(t){return this.entries[6]=t,this}set10(t){return this.entries[1]=t,this}set11(t){return this.entries[4]=t,this}set12(t){return this.entries[7]=t,this}set20(t){return this.entries[2]=t,this}set21(t){return this.entries[5]=t,this}set22(t){return this.entries[8]=t,this}makeImmutable(){return this}columnMajor(t,e,i,s,r,n,h,a,o,m){return this.rowMajor(t,s,h,e,r,a,i,n,o,m)}add(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())}subtract(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())}transpose(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===Ts.IDENTITY||this.type===Ts.SCALING?this.type:void 0)}negate(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())}invert(){let t;switch(this.type){case Ts.IDENTITY:return this;case Ts.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,Ts.TRANSLATION_2D);case Ts.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),Ts.SCALING);case Ts.AFFINE:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,Ts.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case Ts.OTHER:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,Ts.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}}multiplyMatrix(t){if(t.type===Ts.IDENTITY)return this;if(this.type===Ts.IDENTITY)return this.set(t);if(this.type===t.type){if(this.type===Ts.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,Ts.TRANSLATION_2D);if(this.type===Ts.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,Ts.SCALING)}return this.type!==Ts.OTHER&&t.type!==Ts.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,Ts.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())}prependTranslation(t,e){return this.set02(this.m02()+t),this.set12(this.m12()+e),this.type===Ts.IDENTITY||this.type===Ts.TRANSLATION_2D?this.type=Ts.TRANSLATION_2D:this.type===Ts.OTHER?this.type=Ts.OTHER:this.type=Ts.AFFINE,this}setToIdentity(){return this.rowMajor(1,0,0,0,1,0,0,0,1,Ts.IDENTITY)}setToTranslation(t,e){return this.rowMajor(1,0,t,0,1,e,0,0,1,Ts.TRANSLATION_2D)}setToScale(t,e){return e=void 0===e?t:e,this.rowMajor(t,0,0,0,e,0,0,0,1,Ts.SCALING)}setToAffine(t,e,i,s,r,n){return this.rowMajor(t,e,i,s,r,n,0,0,1,Ts.AFFINE)}setToRotationAxisAngle(t,e){let i=Math.cos(e),s=Math.sin(e);Math.abs(i)<1e-15&&(i=0),Math.abs(s)<1e-15&&(s=0);const r=1-i;return this.rowMajor(t.x*t.x*r+i,t.x*t.y*r-t.z*s,t.x*t.z*r+t.y*s,t.y*t.x*r+t.z*s,t.y*t.y*r+i,t.y*t.z*r-t.x*s,t.z*t.x*r-t.y*s,t.z*t.y*r+t.x*s,t.z*t.z*r+i,Ts.OTHER)}setToRotationX(t){let e=Math.cos(t),i=Math.sin(t);return Math.abs(e)<1e-15&&(e=0),Math.abs(i)<1e-15&&(i=0),this.rowMajor(1,0,0,0,e,-i,0,i,e,Ts.OTHER)}setToRotationY(t){let e=Math.cos(t),i=Math.sin(t);return Math.abs(e)<1e-15&&(e=0),Math.abs(i)<1e-15&&(i=0),this.rowMajor(e,0,i,0,1,0,-i,0,e,Ts.OTHER)}setToRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return Math.abs(e)<1e-15&&(e=0),Math.abs(i)<1e-15&&(i=0),this.rowMajor(e,-i,0,i,e,0,0,0,1,Ts.AFFINE)}setToTranslationRotation(t,e,i){let s=Math.cos(i),r=Math.sin(i);return Math.abs(s)<1e-15&&(s=0),Math.abs(r)<1e-15&&(r=0),this.rowMajor(s,-r,t,r,s,e,0,0,1,Ts.AFFINE)}setToTranslationRotationPoint(t,e){return this.setToTranslationRotation(t.x,t.y,e)}setToSVGMatrix(t){return this.rowMajor(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,Ts.AFFINE)}setRotationAToB(t,e){const i=t,s=e;let r=i.cross(s);const n=i.dot(s);if((n<0?-n:n)>.9999){let t=new Be(i.x>0?i.x:-i.x,i.y>0?i.y:-i.y,i.z>0?i.z:-i.z);t=t.x<t.y?t.x<t.z?Be.X_UNIT:Be.Z_UNIT:t.y<t.z?Be.Y_UNIT:Be.Z_UNIT;const e=t.minus(i);r=t.minus(s);const n=2/e.dot(e),h=2/r.dot(r),a=n*h*e.dot(r);return this.rowMajor(-n*e.x*e.x-h*r.x*r.x+a*r.x*e.x+1,-n*e.x*e.y-h*r.x*r.y+a*r.x*e.y,-n*e.x*e.z-h*r.x*r.z+a*r.x*e.z,-n*e.y*e.x-h*r.y*r.x+a*r.y*e.x,-n*e.y*e.y-h*r.y*r.y+a*r.y*e.y+1,-n*e.y*e.z-h*r.y*r.z+a*r.y*e.z,-n*e.z*e.x-h*r.z*r.x+a*r.z*e.x,-n*e.z*e.y-h*r.z*r.y+a*r.z*e.y,-n*e.z*e.z-h*r.z*r.z+a*r.z*e.z+1)}{const t=1/(1+n),e=t*r.x,i=t*r.z,s=e*r.y,h=e*r.z,a=i*r.y;return this.rowMajor(n+e*r.x,s-r.z,h+r.y,s+r.z,n+t*r.y*r.y,a-r.x,h-r.y,a+r.x,n+i*r.z)}}multiplyVector2(t){return t.setXY(this.m00()*t.x+this.m01()*t.y+this.m02(),this.m10()*t.x+this.m11()*t.y+this.m12())}multiplyVector3(t){return t.setXYZ(this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,this.m20()*t.x+this.m21()*t.y+this.m22()*t.z)}multiplyTransposeVector2(t){return t.setXY(this.m00()*t.x+this.m10()*t.y,this.m01()*t.x+this.m11()*t.y)}multiplyRelativeVector2(t){return t.setXY(this.m00()*t.x+this.m01()*t.y,this.m10()*t.y+this.m11()*t.y)}canvasSetTransform(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}canvasAppendTransform(t){this.type!==Ts.IDENTITY&&t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}copyToArray(t){return t[0]=this.m00(),t[1]=this.m10(),t[2]=this.m20(),t[3]=this.m01(),t[4]=this.m11(),t[5]=this.m21(),t[6]=this.m02(),t[7]=this.m12(),t[8]=this.m22(),t}freeToPool(){bs.pool.freeToPool(this)}static identity(){return Ps().setToIdentity()}static translation(t,e){return Ps().setToTranslation(t,e)}static translationFromVector(t){return bs.translation(t.x,t.y)}static scaling(t,e){return Ps().setToScale(t,e)}static scale(t,e){return bs.scaling(t,e)}static affine(t,e,i,s,r,n){return Ps().setToAffine(t,e,i,s,r,n)}static rowMajor(t,e,i,s,r,n,h,a,o,m){return Ps().rowMajor(t,e,i,s,r,n,h,a,o,m)}static rotationAxisAngle(t,e){return Ps().setToRotationAxisAngle(t,e)}static rotationX(t){return Ps().setToRotationX(t)}static rotationY(t){return Ps().setToRotationY(t)}static rotationZ(t){return Ps().setToRotationZ(t)}static translationRotation(t,e,i){return Ps().setToTranslationRotation(t,e,i)}static rotation2(t){return Ps().setToRotationZ(t)}static rotationAround(t,e,i){return bs.translation(e,i).timesMatrix(bs.rotation2(t)).timesMatrix(bs.translation(-e,-i))}static rotationAroundPoint(t,e){return bs.rotationAround(t,e.x,e.y)}static fromSVGMatrix(t){return Ps().setToSVGMatrix(t)}static rotateAToB(t,e){return Ps().setRotationAToB(t,e)}static translationTimesMatrix(t,e,i){let s;return i.type===Ts.IDENTITY||i.type===Ts.TRANSLATION_2D?Is(1,0,i.m02()+t,0,1,i.m12()+e,0,0,1,Ts.TRANSLATION_2D):(s=i.type===Ts.OTHER?Ts.OTHER:Ts.AFFINE,Is(i.m00(),i.m01(),i.m02()+t,i.m10(),i.m11(),i.m12()+e,i.m20(),i.m21(),i.m22(),s))}static toStateObject(t){return{entries:t.entries,type:t.type.name}}static fromStateObject(t){const e=bs.identity();return e.entries=t.entries,e.type=Ts.enumeration.getValue(t.type),e}}_defineProperty(bs,"pool",new Ce(bs,{initialize:bs.prototype.rowMajor,useDefaultConstruction:!0,maxSize:300})),ye.register("Matrix3",bs);const Is=bs.pool.create.bind(bs.pool);ye.register("m3",Is);const Ps=bs.pool.fetch.bind(bs.pool);bs.IDENTITY=bs.identity().makeImmutable(),bs.X_REFLECTION=Is(-1,0,0,0,1,0,0,0,1,Ts.AFFINE).makeImmutable(),bs.Y_REFLECTION=Is(1,0,0,0,-1,0,0,0,1,Ts.AFFINE).makeImmutable(),bs.Matrix3IO=new X("Matrix3IO",{valueType:bs,documentation:"A 3x3 matrix often used for holding transform data.",toStateObject:t=>bs.toStateObject(t),fromStateObject:bs.fromStateObject,stateSchema:{entries:Dt(ve),type:K(Ts)}});const Os=Math.sqrt(.5),Vs={Array:ye.FastArray,index3:(t,e)=>3*t+e,set3(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]},transpose3(t,e){const i=t[3],s=t[6],r=t[1],n=t[7],h=t[2],a=t[5];e[0]=t[0],e[1]=i,e[2]=s,e[3]=r,e[4]=t[4],e[5]=n,e[6]=h,e[7]=a,e[8]=t[8]},det3:t=>t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6]-t[1]*t[3]*t[8]-t[0]*t[5]*t[7],mult3(t,e,i){const s=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],r=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],n=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],h=t[3]*e[0]+t[4]*e[3]+t[5]*e[6],a=t[3]*e[1]+t[4]*e[4]+t[5]*e[7],o=t[3]*e[2]+t[4]*e[5]+t[5]*e[8],m=t[6]*e[0]+t[7]*e[3]+t[8]*e[6],l=t[6]*e[1]+t[7]*e[4]+t[8]*e[7],u=t[6]*e[2]+t[7]*e[5]+t[8]*e[8];i[0]=s,i[1]=r,i[2]=n,i[3]=h,i[4]=a,i[5]=o,i[6]=m,i[7]=l,i[8]=u},mult3LeftTranspose(t,e,i){const s=t[0]*e[0]+t[3]*e[3]+t[6]*e[6],r=t[0]*e[1]+t[3]*e[4]+t[6]*e[7],n=t[0]*e[2]+t[3]*e[5]+t[6]*e[8],h=t[1]*e[0]+t[4]*e[3]+t[7]*e[6],a=t[1]*e[1]+t[4]*e[4]+t[7]*e[7],o=t[1]*e[2]+t[4]*e[5]+t[7]*e[8],m=t[2]*e[0]+t[5]*e[3]+t[8]*e[6],l=t[2]*e[1]+t[5]*e[4]+t[8]*e[7],u=t[2]*e[2]+t[5]*e[5]+t[8]*e[8];i[0]=s,i[1]=r,i[2]=n,i[3]=h,i[4]=a,i[5]=o,i[6]=m,i[7]=l,i[8]=u},mult3RightTranspose(t,e,i){const s=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],r=t[0]*e[3]+t[1]*e[4]+t[2]*e[5],n=t[0]*e[6]+t[1]*e[7]+t[2]*e[8],h=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[3]*e[3]+t[4]*e[4]+t[5]*e[5],o=t[3]*e[6]+t[4]*e[7]+t[5]*e[8],m=t[6]*e[0]+t[7]*e[1]+t[8]*e[2],l=t[6]*e[3]+t[7]*e[4]+t[8]*e[5],u=t[6]*e[6]+t[7]*e[7]+t[8]*e[8];i[0]=s,i[1]=r,i[2]=n,i[3]=h,i[4]=a,i[5]=o,i[6]=m,i[7]=l,i[8]=u},mult3BothTranspose(t,e,i){const s=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],r=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],n=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],h=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],a=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],o=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],m=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],l=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],u=t[2]*e[6]+t[5]*e[7]+t[8]*e[8];i[0]=s,i[1]=r,i[2]=n,i[3]=h,i[4]=a,i[5]=o,i[6]=m,i[7]=l,i[8]=u},mult3Vector3(t,e,i){const s=t[0]*e.x+t[1]*e.y+t[2]*e.z,r=t[3]*e.x+t[4]*e.y+t[5]*e.z,n=t[6]*e.x+t[7]*e.y+t[8]*e.z;i.x=s,i.y=r,i.z=n},swapNegateColumn(t,e,i){const s=t[e],r=t[e+3],n=t[e+6];t[e]=t[i],t[e+3]=t[i+3],t[e+6]=t[i+6],t[i]=-s,t[i+3]=-r,t[i+6]=-n},setIdentity3(t){t[0]=t[4]=t[8]=1,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0},setGivens3(t,e,i,s,r){this.setIdentity3(t),t[this.index3(s,s)]=e,t[this.index3(r,r)]=e,t[this.index3(s,r)]=i,t[this.index3(r,s)]=-i},preMult3Givens(t,e,i,s,r){const n=3*s,h=3*r,a=e*t[n+0]+i*t[h+0],o=e*t[h+0]-i*t[n+0],m=e*t[n+1]+i*t[h+1],l=e*t[h+1]-i*t[n+1],u=e*t[n+2]+i*t[h+2],d=e*t[h+2]-i*t[n+2];t[n+0]=a,t[h+0]=o,t[n+1]=m,t[h+1]=l,t[n+2]=u,t[h+2]=d},postMult3Givens(t,e,i,s,r){const n=e*t[s+0]+i*t[r+0],h=e*t[r+0]-i*t[s+0],a=e*t[s+3]+i*t[r+3],o=e*t[r+3]-i*t[s+3],m=e*t[s+6]+i*t[r+6],l=e*t[r+6]-i*t[s+6];t[s+0]=n,t[r+0]=h,t[s+3]=a,t[r+3]=o,t[s+6]=m,t[r+6]=l},applyJacobi3(t,e,i,s){const r=t[3*i+i],n=t[3*i+s],h=t[3*s+s],a=n*n;let o=r-h;o*=o;const m=a<o,l=1/Math.sqrt(a+o),u=m?l*(r-h):Os,d=m?l*n:Os;this.preMult3Givens(t,u,d,i,s),this.postMult3Givens(t,u,d,i,s),this.preMult3Givens(e,u,d,i,s)},jacobiIteration3(t,e,i){for(let s=0;s<i;s++)this.applyJacobi3(t,e,0,1),this.applyJacobi3(t,e,0,2),this.applyJacobi3(t,e,1,2)},qrAnnihilate3(t,e,i,s){let r,n;const h=e[this.index3(s,s)],a=e[this.index3(i,s)],o=h*h,m=a*a;if(o+m<1e-10)r=h>0?1:0,n=0;else{const t=1/Math.sqrt(o+m);r=t*h,n=t*a}this.preMult3Givens(e,r,n,s,i),this.postMult3Givens(t,r,n,s,i)},svd3(t,e,i,s,r){const n=i,h=r,a=s;this.mult3LeftTranspose(t,t,a),this.setIdentity3(n),this.jacobiIteration3(a,n,e),this.transpose3(n,h),this.mult3(t,h,a);let o,m=a[0]*a[0]+a[3]*a[3]+a[6]*a[6],l=a[1]*a[1]+a[4]*a[4]+a[7]*a[7],u=a[2]*a[2]+a[5]*a[5]+a[8]*a[8];m<l&&(o=m,m=l,l=o,this.swapNegateColumn(a,0,1),this.swapNegateColumn(h,0,1)),m<u&&(o=m,m=u,u=o,this.swapNegateColumn(a,0,2),this.swapNegateColumn(h,0,2)),l<u&&(this.swapNegateColumn(a,1,2),this.swapNegateColumn(h,1,2)),this.setIdentity3(n),this.qrAnnihilate3(n,a,1,0),this.qrAnnihilate3(n,a,2,0),this.qrAnnihilate3(n,a,2,1);n[0]*n[0]+n[1]*n[1]+n[2]*n[2]<.001&&(n[0]=1),n[3]*n[3]+n[4]*n[4]+n[5]*n[5]<.001&&(n[4]=1),n[6]*n[6]+n[7]*n[7]+n[8]*n[8]<.001&&(n[8]=1)},setVectors3(t,e){const i=t.length;for(let s=0;s<i;s++){const r=t[s];e[s]=r.x,e[s+i]=r.y,e[s+2*i]=r.z}},getColumnVector3(t,e,i,s,r){r.x=i[s],r.y=i[s+e],r.z=i[s+2*e]},index:(t,e,i,s)=>e*i+s,transpose(t,e,i,s){for(let r=0;r<t;r++)for(let n=0;n<e;n++)s[t*n+r]=i[e*r+n]},mult(t,e,i,s,r,n){for(let h=0;h<t;h++)for(let a=0;a<i;a++){let o=0;for(let n=0;n<e;n++)o+=s[this.index(t,e,h,n)]*r[this.index(e,i,n,a)];n[this.index(t,i,h,a)]=o}},multRightTranspose(t,e,i,s,r,n){for(let h=0;h<t;h++)for(let a=0;a<i;a++){let o=0;for(let n=0;n<e;n++)o+=s[this.index(t,e,h,n)]*r[this.index(i,e,a,n)];n[this.index(t,i,h,a)]=o}},permuteColumns(t,e,i,s,r){for(let n=0;n<e;n++){const h=s.indices[n];for(let s=0;s<t;s++)r[this.index(t,e,s,n)]=i[this.index(t,e,s,h)]}}};ye.register("MatrixOps3",Vs);class Ss{constructor(t){this.indices=t}size(){return this.indices.length}apply(t){if("number"==typeof t)return this.indices[t];{if(t.length!==this.size())throw new Error(`Permutation length ${this.size()} not equal to list length ${t.length}`);const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[this.indices[i]];return e}}inverted(){const t=new Array(this.size());for(let e=0;e<this.size();e++)t[this.indices[e]]=e;return new Ss(t)}withIndicesPermuted(t){const e=[];return Ss.forEachPermutation(t,i=>{const s=this.indices,r=s.slice(0);for(let e=0;e<t.length;e++)r[t[e]]=s[i[e]];e.push(new Ss(r))}),e}toString(){return`P[${this.indices.join(", ")}]`}equals(t){return this.indices.length===t.indices.length&&_.isEqual(this.indices,t.indices)}static identity(t){const e=new Array(t);for(let i=0;i<t;i++)e[i]=i;return new Ss(e)}static permutations(t){const e=[];return Ss.forEachPermutation(ri.rangeInclusive(0,t-1),t=>{e.push(new Ss(t.slice()))}),e}static forEachPermutation(t,e){!function t(e,i,s){if(0===e.length)s(i);else for(let r=0;r<e.length;r++){const n=e[r],h=e.slice(0);h.splice(r,1);const a=i.slice(0);a.push(n),t(h,a,s)}}(t,[],e)}static permutationsOf(t){const e=[];return Ss.forEachPermutation(t,t=>{e.push(t.slice())}),e}}ye.register("Permutation",Ss);class As{constructor(t,e){this.normal=t,this.distance=e}intersectWithRay(t){return t.pointAtDistance(t.distanceToPlane(this))}static fromTriangle(t,e,i){const s=i.minus(t).cross(e.minus(t));return 0===s.magnitude?null:(s.normalize(),new As(s,s.dot(t)))}}_defineProperty(As,"XY",new As(new Be(0,0,1),0)),_defineProperty(As,"XZ",new As(new Be(0,1,0),0)),_defineProperty(As,"YZ",new As(new Be(1,0,0),0)),ye.register("Plane3",As);class Ns{constructor(t,e,i,s){this.setXYZW(t,e,i,s)}setXYZW(t,e,i,s){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==i?i:0,this.w=void 0!==s?s:1}plus(t){return new Ns(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}timesScalar(t){return new Ns(this.x*t,this.y*t,this.z*t,this.w*t)}timesQuaternion(t){return new Ns(this.x*t.w-this.z*t.y+this.y*t.z+this.w*t.x,-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w)}timesVector3(t){return 0===t.magnitude?new Be(0,0,0):new Be(this.w*this.w*t.x+2*this.y*this.w*t.z-2*this.z*this.w*t.y+this.x*this.x*t.x+2*this.y*this.x*t.y+2*this.z*this.x*t.z-this.z*this.z*t.x-this.y*this.y*t.x,2*this.x*this.y*t.x+this.y*this.y*t.y+2*this.z*this.y*t.z+2*this.w*this.z*t.x-this.z*this.z*t.y+this.w*this.w*t.y-2*this.x*this.w*t.z-this.x*this.x*t.y,2*this.x*this.z*t.x+2*this.y*this.z*t.y+this.z*this.z*t.z-2*this.w*this.y*t.x-this.y*this.y*t.z+2*this.w*this.x*t.y-this.x*this.x*t.z+this.w*this.w*t.z)}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get magnitudeSquared(){return this.getMagnitudeSquared()}normalized(){const t=this.magnitude;return this.timesScalar(1/t)}negated(){return new Ns(-this.x,-this.y,-this.z,-this.w)}toRotationMatrix(){const t=this.magnitudeSquared,e=1===t?2:t>0?2/t:0,i=this.x*this.x*e,s=this.x*this.y*e,r=this.x*this.z*e,n=this.w*this.x*e,h=this.y*this.y*e,a=this.y*this.z*e,o=this.w*this.y*e,m=this.z*this.z*e,l=this.w*this.z*e;return bs.pool.fetch().columnMajor(1-(h+m),s+l,r-o,s-l,1-(i+m),a+n,r+o,a-n,1-(i+h))}static fromEulerAngles(t,e,i){const s=Math.sin(.5*i),r=Math.cos(.5*i),n=Math.sin(.5*e),h=Math.cos(.5*e),a=Math.sin(.5*t),o=Math.cos(.5*t),m=h*r,l=n*s,u=h*s,d=n*r;return new Ns(m*a+l*o,d*o+u*a,u*o-d*a,m*o-l*a)}static fromRotationMatrix(t){const e=t.m00(),i=t.m01(),s=t.m02(),r=t.m10(),n=t.m11(),h=t.m12(),a=t.m20(),o=t.m21(),m=t.m22(),l=e+n+m;let u;return l>=0?(u=Math.sqrt(l+1),new Ns(.5*(o-h)/u,.5*(s-a)/u,.5*(r-i)/u,.5*u)):e>n&&e>m?(u=Math.sqrt(1+e-n-m),new Ns(.5*u,.5*(r+i)/u,.5*(s+a)/u,.5*(o-h)/u)):n>m?(u=Math.sqrt(1+n-e-m),new Ns(.5*(r+i)/u,.5*u,.5*(o+h)/u,.5*(s-a)/u)):(u=Math.sqrt(1+m-e-n),new Ns(.5*(s+a)/u,.5*(o+h)/u,.5*u,.5*(r-i)/u))}static getRotationQuaternion(t,e){return Ns.fromRotationMatrix(bs.rotateAToB(t,e))}static slerp(t,e,i){if(t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w)return t;let s=t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w;s<0&&(e=e.negated(),s=-s);let r=1-i,n=i;if(1-s>.1){const t=Math.acos(s),e=1/Math.sin(t);r=Math.sin((1-i)*t)*e,n=Math.sin(i*t)*e}return new Ns(r*t.x+n*e.x,r*t.y+n*e.y,r*t.z+n*e.z,r*t.w+n*e.w)}}Ns.prototype.isQuaternion=!0,ye.register("Quaternion",Ns),Ri.mixInto(Ns,{initialize:Ns.prototype.setXYZW});class Ds{constructor(t){t=u({seed:null},t),this.seed=null,this.seedrandom=null,this.setSeed(t.seed),this.numberOfCalls=0,Ds.allRandomInstances.add(this)}dispose(){Ds.allRandomInstances.delete(this)}getSeed(){return this.seed}nextBoolean(){return this.nextDouble()>=.5}nextInt(t){const e=this.nextDouble()*t;return Math.floor(e)}nextIntBetween(t,e){const i=e-t;return this.nextInt(i+1)+t}sample(t){return t[this.nextIntBetween(0,t.length-1)]}shuffle(t){let e=-1;const i=new Array(t.length);return _.forEach(t,t=>{const s=this.nextIntBetween(0,++e);i[e]=i[s],i[s]=t}),i}nextDouble(){return this.numberOfCalls++,this.seedrandom()}nextDoubleBetween(t,e){const i=t+this.nextDouble()*(e-t);return i}nextGaussian(){return ri.boxMullerTransform(0,1,this)}nextDoubleInRange(t){return t.min<t.max?this.nextDoubleBetween(t.min,t.max):t.min}setSeed(t){"number"==typeof t||(t=Math.random()),this.seed=t,this.seedrandom=Math.seedrandom?new Math.seedrandom(""+t):()=>Math.random()}sampleProbabilities(t){const e=_.sum(t)*this.nextDouble();let i=0;for(let s=0;s<t.length;s++)if(i+=t[s],i>=e)return s;return t.length-1}}Ds.allRandomInstances=new Set,Ds.isNormalized=t=>{},ye.register("Random",Ds);class Ys{constructor(t,e){this.position=t,this.direction=e}shifted(t){return new Ys(this.pointAtDistance(t),this.direction)}pointAtDistance(t){return this.position.plus(this.direction.timesScalar(t))}toString(){return`${this.position.toString()} => ${this.direction.toString()}`}}ye.register("Ray2",Ys);class _s{constructor(t,e){this.position=t,this.direction=e}shifted(t){return new _s(this.pointAtDistance(t),this.direction)}pointAtDistance(t){return this.position.plus(this.direction.timesScalar(t))}distanceToPlane(t){return(t.distance-this.position.dot(t.normal))/this.direction.dot(t.normal)}toString(){return`${this.position.toString()} => ${this.direction.toString()}`}}ye.register("Ray3",_s);class Xs extends Ci{constructor(t,e,i,s){super(t,e,t+i,e+s)}}ye.register("Rectangle",Xs);class zs{constructor(t,e){this.center=t,this.radius=e}intersect(t,e){const i=t.direction,s=t.position,r=s.minus(this.center),n=i.dot(r),h=4*n*n-4*(r.magnitudeSquared-this.radius*this.radius);if(h<e)return null;const a=i.dot(this.center)-i.dot(s),o=Math.sqrt(h)/2,m=a-o,l=a+o;if(l<e)return null;const u=t.pointAtDistance(l),d=u.minus(this.center).normalized();if(m<e)return{distance:l,hitPoint:u,normal:d.negated(),fromOutside:!1};{const e=t.pointAtDistance(m),i=e.minus(this.center).normalized();return{distance:m,hitPoint:e,normal:i,fromOutside:!0}}}intersections(t,e){const i=t.direction,s=t.position,r=s.minus(this.center),n=i.dot(r),h=4*n*n-4*(r.magnitudeSquared-this.radius*this.radius);if(h<e)return[];const a=i.dot(this.center)-i.dot(s),o=Math.sqrt(h)/2,m=a-o,l=a+o;if(l<e)return[];const u=t.pointAtDistance(l),d=u.minus(this.center).normalized(),c=t.pointAtDistance(m),p=c.minus(this.center).normalized(),g={distance:l,hitPoint:u,normal:d.negated(),fromOutside:!1},y={distance:m,hitPoint:c,normal:p,fromOutside:!0};return m<e?[g,y]:[y,g]}}ye.register("Sphere3",zs);const Fs=new bs;class Rs{constructor(t){this.matrix=bs.IDENTITY.copy(),this.inverse=bs.IDENTITY.copy(),this.matrixTransposed=bs.IDENTITY.copy(),this.inverseTransposed=bs.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,this.changeEmitter=new n,t&&this.setMatrix(t)}setMatrix(t){this.matrix.set(t),this.invalidate()}validateMatrix(t){}invalidate(){this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.changeEmitter.emit()}prepend(t){Fs.set(this.matrix),this.matrix.set(t),this.matrix.multiplyMatrix(Fs),this.invalidate()}prependTranslation(t,e){this.matrix.prependTranslation(t,e),this.invalidate()}append(t){this.matrix.multiplyMatrix(t),this.invalidate()}prependTransform(t){this.prepend(t.matrix)}appendTransform(t){this.append(t.matrix)}applyToCanvasContext(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())}copy(){const t=new Rs(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed,t.inverseValid=this.inverseValid,t.transposeValid=this.transposeValid,t.inverseTransposeValid=this.inverseTransposeValid}getMatrix(){return this.matrix}getInverse(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse}getMatrixTransposed(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed}getInverseTransposed(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed}isIdentity(){return this.matrix.isFastIdentity()}isFinite(){return this.matrix.isFinite()}transformPosition2(t){return this.matrix.timesVector2(t)}transformDelta2(t){const e=this.getMatrix();return new Ge(e.m00()*t.x+e.m01()*t.y,e.m10()*t.x+e.m11()*t.y)}transformNormal2(t){return this.getInverse().timesTransposeVector2(t).normalize()}transformX(t){const e=this.getMatrix();return e.m00()*t+e.m02()}transformY(t){const e=this.getMatrix();return e.m11()*t+e.m12()}transformDeltaX(t){return this.getMatrix().m00()*t}transformDeltaY(t){return this.getMatrix().m11()*t}transformBounds2(t){return t.transformed(this.matrix)}transformShape(t){return t.transformed(this.matrix)}transformRay2(t){return new Ys(this.transformPosition2(t.position),this.transformDelta2(t.direction).normalized())}inversePosition2(t){return this.getInverse().timesVector2(t)}inverseDelta2(t){const e=this.getInverse();return new Ge(e.m00()*t.x+e.m01()*t.y,e.m10()*t.x+e.m11()*t.y)}inverseNormal2(t){return this.matrix.timesTransposeVector2(t).normalize()}inverseX(t){const e=this.getInverse();return e.m00()*t+e.m02()}inverseY(t){const e=this.getInverse();return e.m11()*t+e.m12()}inverseDeltaX(t){const e=this.getInverse();return e.m00()*t}inverseDeltaY(t){const e=this.getInverse();return e.m11()*t}inverseBounds2(t){return t.transformed(this.getInverse())}inverseShape(t){return t.transformed(this.getInverse())}inverseRay2(t){return new Ys(this.inversePosition2(t.position),this.inverseDelta2(t.direction).normalized())}}ye.register("Transform3",Rs);const Ls=new vs;class Cs{constructor(t){this.matrix=vs.IDENTITY.copy(),this.inverse=vs.IDENTITY.copy(),this.matrixTransposed=vs.IDENTITY.copy(),this.inverseTransposed=vs.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,this.changeEmitter=new n,t&&this.setMatrix(t)}setMatrix(t){this.matrix.set(t),this.invalidate()}invalidate(){this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.changeEmitter.emit()}prepend(t){Ls.set(this.matrix),this.matrix.set(t),this.matrix.multiplyMatrix(Ls),this.invalidate()}append(t){this.matrix.multiplyMatrix(t),this.invalidate()}prependTransform(t){this.prepend(t.matrix)}appendTransform(t){this.append(t.matrix)}applyToCanvasContext(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())}copy(){const t=new Cs(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed,t.inverseValid=this.inverseValid,t.transposeValid=this.transposeValid,t.inverseTransposeValid=this.inverseTransposeValid}getMatrix(){return this.matrix}getInverse(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse}getMatrixTransposed(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed}getInverseTransposed(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed}isIdentity(){return this.matrix.type===vs.Types.IDENTITY}isFinite(){return this.matrix.isFinite()}transformPosition3(t){return this.matrix.timesVector3(t)}transformDelta3(t){return this.matrix.timesRelativeVector3(t)}transformNormal3(t){return this.getInverse().timesTransposeVector3(t)}transformDeltaX(t){return this.transformDelta3(new Be(t,0,0)).x}transformDeltaY(t){return this.transformDelta3(new Be(0,t,0)).y}transformDeltaZ(t){return this.transformDelta3(new Be(0,0,t)).z}transformRay(t){return new _s(this.transformPosition3(t.position),this.transformPosition3(t.position.plus(t.direction)).minus(this.transformPosition3(t.position)))}inversePosition3(t){return this.getInverse().timesVector3(t)}inverseDelta3(t){return this.inversePosition3(t).minus(this.inversePosition3(Be.ZERO))}inverseNormal3(t){return this.matrix.timesTransposeVector3(t)}inverseDeltaX(t){return this.inverseDelta3(new Be(t,0,0)).x}inverseDeltaY(t){return this.inverseDelta3(new Be(0,t,0)).y}inverseDeltaZ(t){return this.inverseDelta3(new Be(0,0,t)).z}inverseRay(t){return new _s(this.inversePosition3(t.position),this.inversePosition3(t.position.plus(t.direction)).minus(this.inversePosition3(t.position)))}}ye.register("Transform4",Cs);if(!window.hasOwnProperty("_"))throw new Error("Underscore/Lodash not found: _")})()})()}();